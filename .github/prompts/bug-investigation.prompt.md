---
description: Issue番号を指定してバグの根本原因を調査し、修正方針を提案するプロンプト
mode: agent
tools:
  - read
  - search
  - execute
  - usages
  - githubRepo
  - fetch
  - todo
---

# バグ調査

報告されたバグの根本原因を調査し、修正方針を提案してください。

## バグ情報

バグの内容: ${{bug_description}}

## 調査プロセス

### 1. 情報収集
- エラーメッセージやスタックトレースからファイル・行番号を特定
- 関連するAPIエンドポイントのリクエスト/レスポンスフローを追跡
- マイクロサービス間の通信を確認（BFF → Auth/User/Todo Service）

### 2. コード追跡
- Controller → Service → DbContext の呼び出しチェーンを辿る
- `usages` ツールで関連コードの参照先を調査
- 認証フロー: JWT発行 → ヘッダ転送 → Claims取得

### 3. 根本原因の分析観点

| 分類 | チェック項目 |
|------|------------|
| ロジック | 条件分岐の漏れ、境界値の見落とし |
| データ | NULL参照、FK制約違反、並行更新の不整合 |
| 認証/認可 | JWT検証不備、権限チェック漏れ |
| 非同期 | デッドロック、競合条件 |
| 設定 | appsettings.json の誤り、環境変数の未設定 |

### 4. 結果レポート

```markdown
## 🔍 バグ調査レポート

### 問題の概要
{問題の簡潔な説明}

### 再現手順
1. {手順}

### 根本原因
{原因の詳細説明}

### 関連コード
- {ファイルパス} L{行番号}: {問題のコード}

### 修正方針
1. {修正項目と具体的な修正内容}

### 影響範囲
- {影響を受けるサービス/機能}

### 回帰テスト
- {確認すべきテストケース}
```

## 注意事項
- **コードの変更は行わない**（調査と分析のみ）
- 修正方針は具体的なファイル名・行番号を含める
- 日本語で報告
