# 要求仕様書: 高機能ToDoアプリケーション

**文書ID**: SRS-001  
**バージョン**: 2.0  
**作成日**: 2025-01-30  
**最終更新日**: 2025-01-30  
**ステータス**: Review

---

## 1. はじめに

### 1.1 目的

本文書は、高機能ToDoアプリケーション（以下、todo-app）の要求仕様を定義するものである。本文書は、ISO/IEC/IEEE 29148:2018の国際標準に準拠し、システムのビジネス要件、ユーザー要件、システム要件（機能要件・非機能要件）を明確化する。

本文書の目的は以下の通り：
- ステークホルダー間での要求事項の共通理解の確立
- 開発チームに対する実装ガイドラインの提供
- 受け入れテストの基準設定
- 要求のトレーサビリティ確保

### 1.2 範囲

本文書は、todo-appの以下の範囲をカバーする：

**対象範囲：**
- ToDo管理機能（作成、読取、更新、削除）
- ステータス管理機能
- ラベル管理機能
- 絞込・検索機能
- フロントエンドWebアプリケーション（Angular）
- バックエンドRESTful API（ASP.NET Core）
- データベース（SQL Database）

**対象外：**
- ユーザー認証・認可機能（将来フェーズで検討）
- マルチテナント対応
- モバイルネイティブアプリケーション
- リアルタイム同期・コラボレーション機能
- 通知機能（メール、プッシュ通知等）

### 1.3 定義・略語・略称

| 用語 | 定義 |
|---|---|
| ToDo | ユーザーが管理するタスク・やるべきことの単位 |
| ラベル | ToDoを分類・整理するためのタグ。色とラベル名を持つ |
| ステータス | ToDoの進捗状態。DB保存値: NotStarted（未着手）, InProgress（着手中）, Completed（完了）, Abandoned（放棄）。UI表示は多言語対応（i18n） |
| 絞込 | 一覧表示時に条件を指定してToDoを抽出する機能 |
| todo-app | 本高機能ToDoアプリケーションの総称 |
| SPA | Single Page Application |
| REST API | REpresentational State Transfer API |
| CRUD | Create, Read, Update, Delete |
| UTC | Coordinated Universal Time（協定世界時）。すべての日時データはUTCで保存し、UI表示時にローカルタイムゾーンに変換 |

### 1.4 参照資料

- ISO/IEC/IEEE 29148:2018 - Systems and software engineering — Life cycle processes — Requirements engineering
- Angular公式ドキュメント（https://angular.io/）
- ASP.NET Core公式ドキュメント（https://docs.microsoft.com/aspnet/core/）
- プロジェクト構成: `docs/repo-layout.md`

---

## 2. ビジネスコンテキスト

### 2.1 ビジネス目的

**ビジネス価値：**
個人および小規模チームのタスク管理において、シンプルながら柔軟なカスタマイズが可能なToDoアプリケーションを提供することで、以下のビジネス価値を実現する：

1. **生産性向上**: タスクの可視化とステータス管理により、作業効率を向上
2. **柔軟な分類**: ラベル機能により、プロジェクト・カテゴリーに応じた柔軟な分類が可能
3. **迅速な情報検索**: 強力な絞込機能により、必要なToDoを素早く発見
4. **進捗の可視化**: ステータス管理により、タスクの進行状況を一目で把握

**期待される効果：**
- タスク管理時間の30%削減
- タスクの完了率20%向上
- タスクの見落とし・失念の50%削減

**ビジネス要件定義：**

| 要件ID | ビジネス要件 | 説明 | ビジネス価値 |
|---|---|---|---|
| BR-001 | タスク管理の効率化 | ユーザーがToDoを簡単に作成・編集・削除できること | タスク管理時間の30%削減 |
| BR-002 | 柔軟な分類機能 | ラベルを使用してToDoを柔軟に分類・整理できること | プロジェクト横断的な管理が可能 |
| BR-003 | ステータスによる進捗管理 | ToDoの進捗状況を視覚的に把握できること | タスク完了率20%向上 |
| BR-004 | 迅速な情報検索 | 必要なToDoを素早く検索・絞込できること | 情報検索時間の50%削減 |
| BR-005 | システムの安定性 | システムが安定稼働し、ユーザーの業務を妨げないこと | ユーザー継続率80%の達成 |
| BR-006 | データの保護 | ユーザーデータが安全に保護されること | ユーザー信頼性の確保 |
| BR-007 | 将来の拡張性 | 将来的な機能追加に柔軟に対応できること | 長期的な製品価値の維持 |

**ビジネスKPI：**
| KPI | 目標値 | 測定方法 |
|---|---|---|
| 日次アクティブユーザー数 | 初期リリース後3ヶ月で100名 | アクセスログ分析 |
| ユーザー継続率 | 1ヶ月後80% | ユーザー分析 |
| ToDo完了率 | 平均70%以上 | システム内データ分析 |
| ユーザー満足度 | 4.0/5.0以上 | ユーザーアンケート |

### 2.2 ステークホルダー

| ステークホルダー | 役割 | 関心事項 |
|---|---|---|
| エンドユーザー | システムの主利用者 | 使いやすさ、レスポンス速度、機能の充実度 |
| プロダクトオーナー | ビジネス要求の定義 | ビジネス価値の実現、ROI |
| 開発チーム | システムの設計・実装 | 技術的実現可能性、保守性、拡張性 |
| QAチーム | 品質保証 | テスト容易性、バグの少なさ |
| 運用チーム | システムの運用・保守 | 運用容易性、監視可能性 |
| アーキテクト | システムアーキテクチャ | 技術スタック適合性、将来拡張性 |

### 2.3 ビジネスプロセス

#### 現行業務フロー（手作業・既存ツール）
```
タスク発生 → メモ・付箋に記録 → 記憶に頼った管理 → 完了時に削除
```
**問題点：**
- タスクの見落とし・失念が発生
- 優先順位付けが困難
- 進捗状況の把握が困難
- 過去のタスク履歴が残らない

#### 改善後のフロー（todo-app使用）
```
タスク発生 
  ↓
ToDoとして登録（タイトル・内容・ラベル設定）
  ↓
ステータス管理（未着手→着手中→完了/放棄）
  ↓
絞込機能で必要なToDoを素早く検索
  ↓
完了後も履歴として保持・参照可能
```
**改善効果：**
- タスクの確実な記録と追跡
- ステータスによる進捗の可視化
- ラベルによる柔軟な分類と検索
- 履歴の保持による振り返り可能性

---

## 3. システム要件

### 3.1 機能要件

#### 3.1.1 ToDo管理機能

##### REQ-FUNC-001: ToDo作成
- **説明**: ユーザーは新しいToDoを作成できる
- **入力**: 
  - タイトル（必須、最大200文字）
  - 内容（任意、最大5000文字）
  - ステータス（デフォルト: 未着手）
  - ラベル（任意、複数選択可能）
- **処理**: 
  - 入力値のバリデーション実行
  - 投稿日時を現在日時で自動設定
  - データベースに保存
  - 一意のToDoIDを採番
- **出力**: 
  - 作成されたToDoの詳細情報
  - 成功メッセージ
- **優先度**: Essential
- **受け入れ基準**: 
  - タイトル未入力時はエラーメッセージを表示
  - 作成後、一覧画面に新しいToDoが表示される
  - 投稿日時が自動設定される
  - レスポンス時間が500ms以内
- **エラーハンドリング（M-003対応）**:
  - タイトル長超過（200文字超）: "タイトルは200文字以内で入力してください"
  - 内容長超過（5000文字超）: "内容は5000文字以内で入力してください"
  - ネットワークエラー: "接続エラーが発生しました。ネットワークを確認してください"
  - サーバーエラー（500番台）: "サーバーエラーが発生しました。しばらく待ってから再度お試しください"
  - タイムアウト: "処理がタイムアウトしました。再度お試しください"

##### REQ-FUNC-002: ToDo一覧表示
- **説明**: ユーザーは登録されているToDoの一覧を閲覧できる
- **入力**: 
  - 絞込条件（任意）
  - ソート順（デフォルト: 投稿日時降順）
  - ページネーション情報（ページ番号、表示件数）
- **処理**: 
  - 絞込条件に合致するToDoを抽出
  - 指定されたソート順で並び替え
  - ページネーション処理
- **出力**: 
  - ToDoリスト（タイトル、ステータス、ラベル、投稿日時）
  - 総件数
  - ページネーション情報
- **優先度**: Essential
- **受け入れ基準**: 
  - 一覧には最低限タイトル、ステータス、ラベル、投稿日時が表示される
  - デフォルトで投稿日時の新しい順に表示される
  - 1ページあたりのデフォルト表示件数は20件
  - ユーザーが表示件数を変更可能（20/50/100件）
  - レスポンス時間が1秒以内

##### REQ-FUNC-003: ToDo詳細表示
- **説明**: ユーザーは特定のToDoの詳細情報を閲覧できる
- **入力**: ToDoID
- **処理**: 
  - 指定されたToDoIDでデータベースを検索
  - ToDo情報を取得
- **出力**: 
  - ToDoの全情報（タイトル、内容、投稿日時、ステータス、ラベル）
- **優先度**: Essential
- **受け入れ基準**: 
  - すべての項目が正確に表示される
  - 存在しないToDoIDの場合は404エラー
  - レスポンス時間が300ms以内

##### REQ-FUNC-004: ToDo更新
- **説明**: ユーザーは既存のToDoを更新できる
- **入力**: 
  - ToDoID
  - 更新後のタイトル（必須）
  - 更新後の内容（任意）
  - 更新後のステータス
  - 更新後のラベル
- **処理**: 
  - 入力値のバリデーション実行
  - データベース上の該当ToDoを更新
  - 更新日時を記録
- **出力**: 
  - 更新されたToDoの詳細情報
  - 成功メッセージ
- **優先度**: Essential
- **受け入れ基準**: 
  - タイトル未入力時はエラーメッセージを表示
  - 更新後、一覧・詳細画面に更新内容が反映される
  - 存在しないToDoIDの場合は404エラー
  - レスポンス時間が500ms以内
- **エラーハンドリング（M-003対応）**:
  - ToDoが存在しない: "指定されたToDoが見つかりません"
  - タイトル長超過: "タイトルは200文字以内で入力してください"
  - 内容長超過: "内容は5000文字以内で入力してください"
  - 楽観的ロック競合: "他のユーザーにより更新されています。再読み込みしてください"
  - ネットワークエラー: "接続エラーが発生しました"
  - サーバーエラー: "サーバーエラーが発生しました"

##### REQ-FUNC-005: ToDo削除
- **説明**: ユーザーは不要なToDoを削除できる（論理削除）
- **入力**: ToDoID
- **処理**: 
  - 削除確認ダイアログを表示
  - ユーザーの確認後、IsDeletedフラグをTrueに設定（論理削除）
  - 削除日時を記録
- **出力**: 
  - 削除成功メッセージ
  - 一覧画面へリダイレクト
- **優先度**: Essential
- **受け入れ基準**: 
  - 削除前に確認ダイアログが表示される
  - 削除後、一覧画面から該当ToDoが非表示になる
  - データは物理削除されず、IsDeletedフラグで管理される（論理削除）
  - データ損失ゼロ要件（REQ-REL-002）を満たす
  - 存在しないToDoIDの場合は404エラー
  - レスポンス時間が300ms以内
- **エラーハンドリング（M-003対応）**:
  - ToDoが存在しない: "指定されたToDoが見つかりません"
  - 既に削除済み: "このToDoは既に削除されています"
  - ネットワークエラー: "接続エラーが発生しました"
  - サーバーエラー: "削除処理に失敗しました。再度お試しください"

#### 3.1.2 ステータス管理機能

##### REQ-FUNC-006: ステータス設定
- **説明**: ユーザーはToDoのステータスを設定できる
- **入力**: 
  - ToDoID
  - 新しいステータス（未着手 / 着手中 / 完了 / 放棄）
- **処理**: 
  - ステータス値のバリデーション
  - データベース上のステータスを更新
  - ステータス変更日時を記録
- **出力**: 
  - 更新されたToDo情報
  - 成功メッセージ
- **優先度**: Essential
- **受け入れ基準**: 
  - 4つのステータスから選択可能
  - ステータス変更が即座に画面に反映される
  - 無効なステータス値の場合はエラー
  - レスポンス時間が300ms以内

##### REQ-FUNC-007: ステータス表示
- **説明**: ToDoのステータスが視覚的に分かりやすく表示される
- **入力**: ToDo情報
- **処理**: ステータスに応じた色・アイコンで表示
- **出力**: 視覚的に識別可能なステータス表示
- **優先度**: Essential
- **受け入れ基準**: 
  - 未着手: グレー系の色
  - 着手中: 青系の色
  - 完了: 緑系の色
  - 放棄: 赤系の色
  - 色覚異常者にも識別可能（アイコン併用）

#### 3.1.3 ラベル管理機能

##### REQ-FUNC-008: ラベル作成
- **説明**: ユーザーは新しいラベルを作成できる
- **入力**: 
  - ラベル名（必須、最大50文字）
  - 色（必須、カラーコードまたはプリセットから選択）
- **処理**: 
  - 入力値のバリデーション実行
  - 重複ラベル名のチェック
  - データベースに保存
  - 一意のラベルIDを採番
- **出力**: 
  - 作成されたラベル情報
  - 成功メッセージ
- **優先度**: Conditional (Phase 2)
- **受け入れ基準**: 
  - ラベル名未入力時はエラーメッセージを表示
  - 同名のラベルは作成不可
  - 作成後、ラベル選択リストに表示される
  - 最低8色のプリセットカラーが用意されている
  - レスポンス時間が300ms以内

##### REQ-FUNC-009: ラベル一覧表示
- **説明**: ユーザーは登録されているラベルの一覧を閲覧できる
- **入力**: なし
- **処理**: 全ラベルをデータベースから取得
- **出力**: 
  - ラベルリスト（ラベル名、色、使用中のToDo件数）
- **優先度**: Conditional (Phase 2)
- **受け入れ基準**: 
  - 全ラベルがラベル名の昇順で表示される
  - 各ラベルに紐づくToDo件数が表示される
  - レスポンス時間が500ms以内

##### REQ-FUNC-010: ラベル更新
- **説明**: ユーザーは既存のラベルを更新できる
- **入力**: 
  - ラベルID
  - 更新後のラベル名
  - 更新後の色
- **処理**: 
  - 入力値のバリデーション実行
  - 重複ラベル名のチェック（自身を除く）
  - データベース上の該当ラベルを更新
- **出力**: 
  - 更新されたラベル情報
  - 成功メッセージ
- **優先度**: Conditional (Phase 2)
- **受け入れ基準**: 
  - ラベル名未入力時はエラーメッセージを表示
  - 更新後、すべてのToDoに反映される
  - レスポンス時間が300ms以内

##### REQ-FUNC-011: ラベル削除
- **説明**: ユーザーは不要なラベルを削除できる
- **入力**: ラベルID
- **処理**: 
  - 使用中のToDoがある場合は警告表示
  - ユーザーの確認後、データベースから削除
  - ToDoとの紐付けも削除
- **出力**: 
  - 削除成功メッセージ
  - ラベル一覧画面へリダイレクト
- **優先度**: Conditional (Phase 2)
- **受け入れ基準**: 
  - 削除前に確認ダイアログが表示される
  - 使用中のラベルの場合は警告メッセージを表示
  - 削除後、ToDoから該当ラベルが除去される
  - レスポンス時間が500ms以内

##### REQ-FUNC-012: ToDoへのラベル設定
- **説明**: ユーザーはToDoに複数のラベルを設定できる（最大10個）
- **入力**: 
  - ToDoID
  - ラベルIDリスト（複数選択可能、最大10個）
- **処理**: 
  - ラベル数のバリデーション（10個以内）
  - 既存のラベル紐付けを削除
  - 新しいラベル紐付けを登録
- **出力**: 
  - 更新されたToDo情報
  - 成功メッセージ
- **優先度**: Conditional (Phase 2)
- **受け入れ基準**: 
  - 複数ラベルの設定が可能（最大10個）
  - 10個を超える場合はエラーメッセージを表示
  - ラベルなしも設定可能
  - 即座に画面に反映される
  - レスポンス時間が500ms以内

#### 3.1.4 絞込・検索機能

##### REQ-FUNC-013: ラベルによる絞込
- **説明**: ユーザーはラベルを指定してToDoを絞り込める
- **入力**: 
  - ラベルIDリスト（複数選択可能、OR条件）
- **処理**: 
  - 指定されたラベルが設定されているToDoを抽出
- **出力**: 
  - 絞り込まれたToDoリスト
  - ヒット件数
- **優先度**: Conditional (Phase 3)
- **受け入れ基準**: 
  - 複数ラベル指定時はOR条件で絞込
  - 絞込条件がクリアボタンで解除可能
  - レスポンス時間が1秒以内

##### REQ-FUNC-014: 日時による絞込
- **説明**: ユーザーは日時範囲を指定してToDoを絞り込める
- **入力**: 
  - 開始日時（任意）
  - 終了日時（任意）
- **処理**: 
  - 投稿日時が指定範囲内のToDoを抽出
- **出力**: 
  - 絞り込まれたToDoリスト
  - ヒット件数
- **優先度**: Conditional (Phase 3)
- **受け入れ基準**: 
  - 開始日時のみ指定で「以降」の絞込が可能
  - 終了日時のみ指定で「以前」の絞込が可能
  - 両方指定で範囲絞込が可能
  - 日付ピッカーUIが提供される
  - レスポンス時間が1秒以内

##### REQ-FUNC-015: ステータスによる絞込
- **説明**: ユーザーはステータスを指定してToDoを絞り込める
- **入力**: 
  - ステータスリスト（複数選択可能、OR条件）
- **処理**: 
  - 指定されたステータスのToDoを抽出
- **出力**: 
  - 絞り込まれたToDoリスト
  - ヒット件数
- **優先度**: Conditional (Phase 3)
- **受け入れ基準**: 
  - 複数ステータス指定が可能
  - デフォルトで全ステータスが選択状態
  - レスポンス時間が1秒以内

##### REQ-FUNC-016: キーワード検索
- **説明**: ユーザーはキーワードを入力してToDoを検索できる
- **入力**: 
  - 検索キーワード（自由記入、最大100文字）
- **処理**: 
  - タイトルと内容に対して部分一致検索
  - 大文字小文字を区別しない
- **出力**: 
  - 検索結果のToDoリスト
  - ヒット件数
  - 該当箇所のハイライト表示
- **優先度**: Conditional (Phase 3)
- **受け入れ基準**: 
  - タイトルと内容の両方が検索対象
  - 部分一致で検索可能
  - 検索結果のキーワードがハイライト表示される
  - レスポンス時間が1秒以内
  - 100万件のToDo存在時でも2秒以内に応答（M-006対応）

##### REQ-FUNC-017: 複合絞込
- **説明**: ユーザーは複数の絞込条件を組み合わせて使用できる
- **入力**: 
  - ラベル、日時、ステータス、キーワードの任意の組み合わせ
- **処理**: 
  - すべての条件をAND条件で絞込
- **出力**: 
  - 絞り込まれたToDoリスト
  - 適用中の絞込条件の表示
  - ヒット件数
- **優先度**: Conditional (Phase 3)
- **受け入れ基準**: 
  - すべての絞込条件を同時に適用可能
  - 適用中の条件が画面上に明示される
  - 条件ごとに個別に解除可能
  - レスポンス時間が1.5秒以内

### 3.2 非機能要件

#### 3.2.1 性能要件

| 要件ID | 説明 | 目標値 | 測定条件（M-002対応） |
|---|---|---|---|
| REQ-PERF-001 | API応答時間（単一ToDo操作） | 500ms以内 | 同時接続数10ユーザー、データ量1万件以下、95パーセンタイル |
| REQ-PERF-002 | API応答時間（一覧取得） | 1秒以内 | 同時接続数10ユーザー、データ量1000件取得、95パーセンタイル |
| REQ-PERF-003 | 画面初期表示時間 | 2秒以内 | 初回アクセス、通常ネットワーク環境（10Mbps）、データ量20件表示 |
| REQ-PERF-004 | 画面遷移時間 | 500ms以内 | SPA内遷移、キャッシュ有効時 |
| REQ-PERF-005 | 同時接続ユーザー数 | 100ユーザー | レスポンスタイム劣化20%以内 |
| REQ-PERF-006 | データベーステーブルサイズ | 100万レコード | 性能劣化20%以内 |
| REQ-PERF-007 | 検索処理時間 | 1秒以内 | 全文検索、データ量10万件以下、95パーセンタイル |
| REQ-PERF-008 | 大規模データ検索 | 2秒以内 | 全文検索、データ量100万件、95パーセンタイル（M-006対応） |

#### 3.2.2 ユーザビリティ要件

| 要件ID | 説明 | 基準（C-002対応：測定可能な基準） |
|---|---|---|
| REQ-USE-001 | レスポンシブデザイン | デスクトップ、タブレット、スマートフォンで使用可能。画面幅320px～4K解像度に対応 |
| REQ-USE-002 | ブラウザ対応 | Chrome（最新版）、Edge（最新版）、Firefox（最新版）、Safari（最新版）で動作検証済み |
| REQ-USE-003 | 画面解像度 | 最小1280x720、推奨1920x1080。モバイルは320x568以上 |
| REQ-USE-004 | 学習容易性 | ユーザビリティテストで初回利用者の80%以上が、チュートリアルなしで5分以内にToDo作成・編集・削除を実行可能 |
| REQ-USE-005 | エラーメッセージ | すべてのエラーに対して、原因と対処法を含むメッセージを表示。ユーザビリティテストで90%以上のユーザーがエラー内容を理解可能 |
| REQ-USE-006 | 入力補助 | 必須項目の明示（*マーク）、入力形式のヒント表示、リアルタイムバリデーション実装 |
| REQ-USE-007 | キーボードショートカット | ToDo作成（Ctrl+N）、検索（Ctrl+F）、保存（Ctrl+S）の提供。ヘルプ画面で一覧表示 |
| REQ-USE-008 | アクセシビリティ | WCAG 2.1 Level AA準拠。自動テストツール（axe、Lighthouse）でスコア90点以上 |

#### 3.2.3 信頼性要件

| 要件ID | 説明 | 目標値 |
|---|---|---|
| REQ-REL-001 | システム稼働率 | 99.0%以上（月間） |
| REQ-REL-002 | データ損失 | ゼロ（バックアップからの復旧可能） |
| REQ-REL-003 | バックアップ頻度 | 日次自動バックアップ |
| REQ-REL-004 | エラーハンドリング | すべての予見可能なエラーに対する適切な処理 |
| REQ-REL-005 | ログ記録 | エラー、警告、操作ログの記録 |

#### 3.2.4 保守性要件

| 要件ID | 説明 | 基準 |
|---|---|---|
| REQ-MAIN-001 | コード品質 | コーディング規約準拠、静的解析エラーゼロ |
| REQ-MAIN-002 | テストカバレッジ | ユニットテスト80%以上 |
| REQ-MAIN-003 | ドキュメント | API仕様書、システム設計書の整備 |
| REQ-MAIN-004 | バージョン管理 | Gitによるソースコード管理 |
| REQ-MAIN-005 | デプロイ | CI/CDパイプラインの構築 |

#### 3.2.5 セキュリティ要件（C-003対応：具体的実装方法を明記）

| 要件ID | 説明 | カテゴリ | 具体的実装方法 |
|---|---|---|---|
| REQ-SEC-001 | SQLインジェクション対策 | データ保護 | Entity Framework Coreのパラメータ化クエリを使用。生SQLは原則禁止。必要な場合はFromSqlRawでパラメータ化 |
| REQ-SEC-002 | XSS対策 | データ保護 | Angularの自動エスケープ機能を使用。動的HTML生成時はDomSanitizerでサニタイズ。innerHTML使用禁止、代わりにtextContentまたはAngularバインディングを使用 |
| REQ-SEC-003 | CSRF対策 | データ保護 | Anti-Forgeryトークンの実装（ASP.NET CoreのValidateAntiForgeryToken）。Cookie設定にSameSite=Strict属性を付与 |
| REQ-SEC-004 | HTTPS通信 | 通信保護 | すべての通信をHTTPS化。HSTSヘッダー（max-age=31536000）の設定。HTTP→HTTPSリダイレクトの実装 |
| REQ-SEC-005 | 入力値検証 | データ保護 | サーバー側での厳密なバリデーション（DataAnnotations、FluentValidation）。クライアント側検証は補助的な位置づけ |
| REQ-SEC-006 | APIレート制限 | 可用性保護 | AspNetCoreRateLimitライブラリを使用。IP単位で1分間に100リクエストまで制限 |

#### 3.2.6 拡張性要件

| 要件ID | 説明 | 基準 |
|---|---|---|
| REQ-EXT-001 | データ量増加への対応 | 1000万レコードまでスケール可能な設計 |
| REQ-EXT-002 | 機能追加の容易性 | プラグイン的な機能追加が可能な設計 |
| REQ-EXT-003 | APIバージョニング | 後方互換性を保ったAPI拡張 |
| REQ-EXT-004 | データベース変更 | マイグレーション管理の実装 |

#### 3.2.7 互換性要件

| 要件ID | 説明 | 基準 |
|---|---|---|
| REQ-COMP-001 | Angular バージョン | Angular 17以降 |
| REQ-COMP-002 | ASP.NET Core バージョン | .NET 8以降 |
| REQ-COMP-003 | データベース | SQL Server 2019以降 / Azure SQL Database |
| REQ-COMP-004 | データ形式 | JSON（REST API） |

---

## 4. 制約条件

### 4.1 技術制約

- **TC-001**: フロントエンドはAngular（latest）を使用すること
- **TC-002**: バックエンドはASP.NET Core（latest）を使用すること
- **TC-003**: データベースはSQL Database Projectとして管理すること
- **TC-004**: プロジェクト構成は以下のディレクトリ構造に従うこと:
  - Frontend: `/src/todo-app/front`
  - Backend: `/src/todo-app/api`
  - Database: `/src/todo-app/database`
- **TC-005**: REST APIアーキテクチャを採用すること
- **TC-006**: シングルページアプリケーション（SPA）として実装すること

### 4.2 ビジネス制約

- **BC-001**: 初期リリースは3ヶ月以内に実施すること
- **BC-002**: 運用コストを最小限に抑えること
- **BC-003**: 初期フェーズではシングルユーザーモードで実装すること（認証機能なし）

### 4.3 法規制・コンプライアンス

- **LC-001**: 個人情報保護法に準拠すること（将来的なユーザー管理機能追加時）
- **LC-002**: アクセシビリティガイドライン（WCAG 2.1 Level AA）に準拠すること

---

## 5. 前提条件

- **AS-001**: 開発環境は既に構築されていること
- **AS-002**: Git リポジトリが利用可能であること
- **AS-003**: 開発チームはAngular、ASP.NET Core、SQL Serverの知識を有すること
- **AS-004**: 開発・ステージング・本番環境が分離されていること
- **AS-005**: 初期フェーズではインターネット接続環境での使用を想定すること

---

## 6. 依存関係

| 依存先 | 内容 | 影響 |
|---|---|---|
| Angular Framework | フロントエンド開発基盤 | バージョンアップデートに追従が必要 |
| ASP.NET Core | バックエンド開発基盤 | セキュリティパッチ適用が必要 |
| SQL Server | データ永続化 | データベースメンテナンス時間の考慮 |
| npm パッケージ | フロントエンド依存ライブラリ | 脆弱性管理が必要 |
| NuGet パッケージ | バックエンド依存ライブラリ | 脆弱性管理が必要 |
| ホスティング環境 | アプリケーション実行環境 | インフラ障害時の影響 |

---

## 7. トレーサビリティ

### 7.1 ビジネス要件→システム要件マッピング

| ビジネス要件 | システム要件（機能要件） | システム要件（非機能要件） |
|---|---|---|
| BR-001: タスク管理の効率化 | REQ-FUNC-001, 002, 003, 004, 005 | REQ-PERF-001, 002, REQ-USE-001, 004 |
| BR-002: 柔軟な分類機能 | REQ-FUNC-008, 009, 010, 011, 012 | REQ-USE-004, 005 |
| BR-003: ステータスによる進捗管理 | REQ-FUNC-006, 007 | REQ-USE-007 |
| BR-004: 迅速な情報検索 | REQ-FUNC-013, 014, 015, 016, 017 | REQ-PERF-007 |
| BR-005: システムの安定性 | - | REQ-REL-001, 002, 003, 004, 005 |
| BR-006: データの保護 | - | REQ-SEC-001, 002, 003, 004, 005 |
| BR-007: 将来の拡張性 | - | REQ-EXT-001, 002, 003, 004 |

### 7.2 ステークホルダー要件→システム要件マッピング

| ステークホルダー | 関心事項 | 対応する要件 |
|---|---|---|
| エンドユーザー | 使いやすさ | REQ-USE-001～008 |
| エンドユーザー | レスポンス速度 | REQ-PERF-001～007 |
| エンドユーザー | 機能の充実度 | REQ-FUNC-001～017 |
| プロダクトオーナー | ビジネス価値の実現 | BR-001～004 |
| 開発チーム | 保守性 | REQ-MAIN-001～005 |
| 開発チーム | 拡張性 | REQ-EXT-001～004 |
| QAチーム | テスト容易性 | REQ-MAIN-002, REQ-FUNC-xxx受け入れ基準 |
| 運用チーム | 運用容易性 | REQ-REL-003, 005, REQ-MAIN-005 |
| アーキテクト | 技術スタック適合性 | TC-001～006, REQ-COMP-001～004 |

### 7.3 要件間の依存関係

| 要件ID | 依存する要件 | 依存理由 |
|---|---|---|
| REQ-FUNC-002 | REQ-FUNC-001 | ToDoが作成されていないと一覧表示できない |
| REQ-FUNC-003 | REQ-FUNC-001 | ToDoが作成されていないと詳細表示できない |
| REQ-FUNC-004 | REQ-FUNC-001 | ToDoが作成されていないと更新できない |
| REQ-FUNC-005 | REQ-FUNC-001 | ToDoが作成されていないと削除できない |
| REQ-FUNC-006 | REQ-FUNC-001 | ToDoが作成されていないとステータス変更できない |
| REQ-FUNC-012 | REQ-FUNC-001, 008 | ToDoとラベルが作成されていないと紐付けできない |
| REQ-FUNC-013 | REQ-FUNC-008, 012 | ラベルが設定されていないと絞込できない |
| REQ-FUNC-017 | REQ-FUNC-013, 014, 015, 016 | 個別絞込機能が実装されていないと複合絞込できない |

---

## 8. データモデル概要

### 8.1 エンティティ定義（C-004対応：削除フラグ、インデックス、外部キー制約を追加）

#### ToDo エンティティ
| 項目名 | データ型 | 制約 | 説明 |
|---|---|---|---|
| ToDoID | INT / BIGINT | PK, AUTO INCREMENT | ToDo識別子 |
| Title | VARCHAR(200) | NOT NULL | タイトル |
| Content | TEXT(5000) | NULL | 内容 |
| Status | VARCHAR(20) | NOT NULL, DEFAULT 'NotStarted' | ステータス（NotStarted/InProgress/Completed/Abandoned） |
| IsDeleted | BIT | NOT NULL, DEFAULT 0 | 削除フラグ（論理削除用、M-008対応） |
| DeletedAt | DATETIME | NULL | 削除日時（IsDeleted=1の場合に設定） |
| CreatedAt | DATETIME | NOT NULL, DEFAULT CURRENT_TIMESTAMP | 投稿日時（UTC、M-007対応） |
| UpdatedAt | DATETIME | NOT NULL, DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP | 更新日時（UTC、M-007対応） |

**インデックス定義:**
- PRIMARY KEY: ToDoID
- INDEX idx_status: Status（ステータス絞込用）
- INDEX idx_created_at: CreatedAt DESC（投稿日時ソート用）
- INDEX idx_is_deleted: IsDeleted（論理削除フィルター用）
- INDEX idx_title_content: FULLTEXT(Title, Content)（全文検索用、M-006対応）

#### Label エンティティ
| 項目名 | データ型 | 制約 | 説明 |
|---|---|---|---|
| LabelID | INT | PK, AUTO INCREMENT | ラベル識別子 |
| LabelName | VARCHAR(50) | NOT NULL, UNIQUE | ラベル名 |
| Color | VARCHAR(7) | NOT NULL | 色（カラーコード） |
| CreatedAt | DATETIME | NOT NULL, DEFAULT CURRENT_TIMESTAMP | 作成日時（UTC） |

**インデックス定義:**
- PRIMARY KEY: LabelID
- UNIQUE INDEX idx_label_name: LabelName（重複チェック用）

#### ToDoLabel エンティティ（中間テーブル）
| 項目名 | データ型 | 制約 | 説明 |
|---|---|---|---|
| ToDoID | INT / BIGINT | PK, FK → ToDo.ToDoID ON DELETE CASCADE | ToDo識別子 |
| LabelID | INT | PK, FK → Label.LabelID ON DELETE CASCADE | ラベル識別子 |
| CreatedAt | DATETIME | NOT NULL, DEFAULT CURRENT_TIMESTAMP | 紐付け日時（UTC） |

**外部キー制約:**
- FK_ToDoLabel_ToDo: ToDoID → ToDo.ToDoID ON DELETE CASCADE（ToDoが削除されたら紐付けも削除）
- FK_ToDoLabel_Label: LabelID → Label.LabelID ON DELETE CASCADE（ラベルが削除されたら紐付けも削除）

**インデックス定義:**
- PRIMARY KEY: (ToDoID, LabelID)
- INDEX idx_label_id: LabelID（ラベルからのToDo検索用）

### 8.2 エンティティ関連図（ER図）

```
┌──────────────────┐
│      ToDo        │
├──────────────────┤
│ ToDoID (PK)      │
│ Title            │
│ Content          │
│ Status           │
│ IsDeleted        │←追加（論理削除用）
│ DeletedAt        │←追加
│ CreatedAt (UTC)  │
│ UpdatedAt (UTC)  │
└──────────────────┘
         │
         │ 1
         │
         │ * (ON DELETE CASCADE)
┌──────────────────┐
│   ToDoLabel      │
├──────────────────┤
│ ToDoID (PK,FK)   │
│ LabelID (PK,FK)  │
│ CreatedAt (UTC)  │
└──────────────────┘
         │
         │ * (ON DELETE CASCADE)
         │
         │ 1
┌──────────────────┐
│     Label        │
├──────────────────┤
│ LabelID (PK)     │
│ LabelName (UQ)   │
│ Color            │
│ CreatedAt (UTC)  │
└──────────────────┘
```

---

## 9. ユースケース

### 9.1 主要ユースケース一覧

| UC-ID | ユースケース名 | アクター | 関連要件 |
|---|---|---|---|
| UC-001 | ToDoを作成する | ユーザー | REQ-FUNC-001 |
| UC-002 | ToDoを閲覧する | ユーザー | REQ-FUNC-002, 003 |
| UC-003 | ToDoを更新する | ユーザー | REQ-FUNC-004 |
| UC-004 | ToDoを削除する | ユーザー | REQ-FUNC-005 |
| UC-005 | ステータスを変更する | ユーザー | REQ-FUNC-006 |
| UC-006 | ラベルを管理する | ユーザー | REQ-FUNC-008, 009, 010, 011 |
| UC-007 | ToDoにラベルを設定する | ユーザー | REQ-FUNC-012 |
| UC-008 | ToDoを絞り込む | ユーザー | REQ-FUNC-013, 014, 015, 016, 017 |

### 9.2 ユースケース詳細例: UC-001 ToDoを作成する

**アクター**: ユーザー

**事前条件**: 
- ユーザーがアプリケーションにアクセスしている

**基本フロー**:
1. ユーザーが「新規作成」ボタンをクリック
2. システムがToDo作成フォームを表示
3. ユーザーがタイトルを入力（必須）
4. ユーザーが内容を入力（任意）
5. ユーザーがラベルを選択（任意、複数選択可能）
6. ユーザーが「作成」ボタンをクリック
7. システムが入力値を検証
8. システムがToDoを保存（投稿日時は自動設定、ステータスは「未着手」）
9. システムが成功メッセージを表示
10. システムがToDo一覧画面へ遷移

**代替フロー**:
- 7a. タイトルが未入力の場合
  - システムがエラーメッセージを表示
  - 基本フロー3へ戻る
- 7b. タイトルが200文字を超える場合
  - システムがエラーメッセージを表示
  - 基本フロー3へ戻る
- 7c. 内容が5000文字を超える場合
  - システムがエラーメッセージを表示
  - 基本フロー4へ戻る

**事後条件**: 
- 新しいToDoがデータベースに保存されている
- ToDo一覧に新しいToDoが表示される

---

## 10. 受け入れ基準

### 10.1 全体受け入れ基準

本システムが受け入れられるためには、以下の基準をすべて満たす必要がある：

1. **機能完全性**: すべてのEssential優先度の機能要件が実装されている
2. **性能基準達成**: すべての性能要件が目標値を達成している
3. **品質基準達成**: ユニットテストカバレッジ80%以上、静的解析エラーゼロ
4. **ユーザビリティ**: 対象ブラウザすべてで正常に動作する
5. **セキュリティ**: すべてのセキュリティ要件が実装されている
6. **ドキュメント**: API仕様書、システム設計書が整備されている

### 10.2 機能別受け入れ基準

各機能要件に定義された「受け入れ基準」をすべて満たすこと。

---

## 11. リスク分析

### 11.1 技術リスク

| リスクID | リスク内容 | 影響度 | 発生確率 | 軽減策 |
|---|---|---|---|---|
| TR-001 | Angularバージョンアップによる互換性問題 | 中 | 低 | 定期的なバージョン追従、移行計画の策定 |
| TR-002 | データベースパフォーマンス劣化 | 高 | 中 | インデックス最適化、クエリチューニング |
| TR-003 | ブラウザ互換性問題 | 中 | 中 | クロスブラウザテストの実施 |
| TR-004 | セキュリティ脆弱性の発見 | 高 | 低 | セキュリティスキャン、ペネトレーションテスト |

### 11.2 ビジネスリスク

| リスクID | リスク内容 | 影響度 | 発生確率 | 軽減策 |
|---|---|---|---|---|
| BR-001 | ユーザー要求の変化 | 中 | 中 | アジャイル開発、定期的なフィードバック収集 |
| BR-002 | 競合サービスの出現 | 中 | 低 | 差別化機能の追加、ユーザー体験の向上 |
| BR-003 | 予算・スケジュール超過 | 高 | 中 | MVP範囲の明確化、段階的リリース |

### 11.3 運用リスク

| リスクID | リスク内容 | 影響度 | 発生確率 | 軽減策 |
|---|---|---|---|---|
| OR-001 | データ損失 | 高 | 低 | 日次バックアップ、復旧手順の整備 |
| OR-002 | サーバー障害 | 中 | 低 | 監視体制の構築、復旧手順の整備 |
| OR-003 | データ移行失敗 | 高 | 低 | 移行リハーサル、ロールバック計画 |

---

## 12. 用語集

| 用語 | 定義 |
|---|---|
| ToDo | ユーザーが管理するタスク・やるべきことの単位。タイトル、内容、ステータス、ラベルなどの情報を持つ |
| ラベル | ToDoを分類・整理するためのタグ。色とラベル名で構成される |
| ステータス | ToDoの進捗状態。未着手、着手中、完了、放棄の4つの状態を持つ |
| 絞込 | 一覧表示時に条件を指定してToDoを抽出する機能 |
| SPA（Single Page Application） | 単一のHTMLページで動作するWebアプリケーション。ページ遷移時にサーバーから全ページを再読み込みせず、必要なデータのみを取得して動的に画面を更新する |
| REST API | HTTPプロトコルを使用したWebサービスのアーキテクチャスタイル。リソース指向でステートレスな設計 |
| CRUD | Create（作成）、Read（読取）、Update（更新）、Delete（削除）の4つの基本操作 |
| バリデーション | 入力値が正しい形式・範囲であるかを検証する処理 |
| サニタイゼーション | 悪意のあるコードや不正な文字列を無害化する処理 |
| レスポンシブデザイン | 画面サイズに応じて表示を最適化するデザイン手法 |
| パーセンタイル | データを小さい順に並べたときの位置を示す統計値。95パーセンタイルは、全体の95%がそれ以下の値 |

---

## 13. 成果物

### 13.1 開発成果物

| 成果物 | 説明 | 格納場所 |
|---|---|---|
| フロントエンドアプリケーション | Angular SPA | `/src/todo-app/front` |
| バックエンドAPI | ASP.NET Core Web API | `/src/todo-app/api` |
| データベースプロジェクト | SQL Database Project | `/src/todo-app/database` |
| ユニットテスト | 各レイヤーのユニットテスト | 各プロジェクト内 |
| E2Eテスト | エンドツーエンドテスト | `/tests/e2e` |

### 13.2 ドキュメント成果物

| 成果物 | 説明 | 格納場所 |
|---|---|---|
| 要求仕様書 | 本文書 | `/docs/todo-app/要求定義/` |
| システム設計書 | アーキテクチャ、詳細設計 | `/docs/todo-app/設計/` |
| API仕様書 | REST API仕様 | `/docs/todo-app/API/` |
| データベース設計書 | ER図、テーブル定義 | `/docs/todo-app/データベース/` |
| テスト計画書 | テスト戦略、テストケース | `/docs/todo-app/テスト/` |
| 運用手順書 | デプロイ、保守手順 | `/docs/todo-app/運用/` |

---

## 14. 開発ロードマップ

### 14.1 フェーズ計画

#### Phase 1: MVP（最小実行可能製品）- Week 1-6
- **目標**: 基本的なToDo管理機能の実装
- **対象要件**: 
  - REQ-FUNC-001, 002, 003, 004, 005（ToDo CRUD）
  - REQ-FUNC-006, 007（ステータス管理）
  - 基本的なUI/UX
- **成果物**: デモ可能なプロトタイプ

#### Phase 2: ラベル機能 - Week 7-9
- **目標**: ラベル管理機能の実装
- **対象要件**: 
  - REQ-FUNC-008, 009, 010, 011, 012（ラベル機能）
- **成果物**: ラベル機能を含むベータ版

#### Phase 3: 検索・絞込機能 - Week 10-11
- **目標**: 高度な検索・絞込機能の実装
- **対象要件**: 
  - REQ-FUNC-013, 014, 015, 016, 017（絞込機能）
- **成果物**: 全機能を含むRC（リリース候補）版

#### Phase 4: 品質向上・最適化 - Week 12
- **目標**: 性能最適化、バグ修正、ドキュメント整備
- **対象要件**: 
  - すべての非機能要件
  - ドキュメント整備
- **成果物**: 本番リリース版

### 14.2 マイルストーン

| マイルストーン | 日付目安 | 判定基準 |
|---|---|---|
| MS-1: MVP完成 | Week 6 | ToDo CRUDとステータス管理が動作 |
| MS-2: ラベル機能完成 | Week 9 | ラベル管理とToDo紐付けが動作 |
| MS-3: 全機能完成 | Week 11 | すべてのEssential要件が実装済み |
| MS-4: リリース判定 | Week 12 | 受け入れ基準をすべて満たす |

---

## 15. 改訂履歴

| バージョン | 日付 | 変更内容 | 作成者 | レビュー |
|---|---|---|---|---|
| 1.0 | 2025-01-30 | 初版作成 | AI Agent | 不合格（Critical 5件、Major 8件、Minor 4件） |
| 2.0 | 2025-01-30 | レビュー指摘事項対応（2回目）<br>- C-001: BR-001～BR-007のビジネス要件を明示的に定義<br>- C-002: 非機能要件の受け入れ基準を測定可能に変更<br>- C-003: セキュリティ要件の具体的実装方法を記載<br>- C-004: データモデルに削除フラグ、インデックス、外部キー制約を追加<br>- C-005: 機能要件の優先度をPhase計画と整合<br>- M-001: ステータス定義の多言語対応を明記<br>- M-002: 性能要件の測定条件を具体化<br>- M-003: 主要機能にエラーハンドリング要件を追加<br>- M-004: ページネーション仕様を明確化<br>- M-005: ラベルの最大設定数を定義（10個）<br>- M-006: 大規模データ検索の性能要件を追加<br>- M-007: 日時のUTC保存方針を明記<br>- M-008: 削除機能を論理削除に統一<br>- Minor: 用語の表記統一 | AI Agent | 再レビュー待ち |

---

## 16. 承認

| 役割 | 氏名 | 承認日 | 署名 |
|---|---|---|---|
| プロダクトオーナー | | | |
| アーキテクト | | | |
| 開発リーダー | | | |
| QAリーダー | | | |

---

**文書の終わり**
