# CodeQL é™çš„è§£æãƒ¬ãƒãƒ¼ãƒˆ

**è§£ææ—¥æ™‚**: 2026-02-23  
**CodeQL ãƒãƒ¼ã‚¸ãƒ§ãƒ³**: 2.24.2  
**ã‚¯ã‚¨ãƒªã‚¹ã‚¤ãƒ¼ãƒˆ**: security-extended (C# + JavaScript/TypeScript)  
**å¯¾è±¡**: `vulnerability-site/src/`

---

## ã‚µãƒãƒªãƒ¼

| è¨€èª | å¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ«æ•° | æ¤œå‡ºæ•° | Critical | High | Medium |
|------|---------------|--------|----------|------|--------|
| C# (API) | 7 | 9 | 5 | 2 | 2 |
| JavaScript/TypeScript (Frontend) | 12 | 2 | 2 | 0 | 0 |
| **åˆè¨ˆ** | **19** | **11** | **7** | **2** | **2** |

---

## æ¤œå‡ºçµæœä¸€è¦§

### ğŸ”´ Criticalï¼ˆCVSS â‰¥ 9.0ï¼‰

#### CVE-CWE-502: å®‰å…¨ã§ãªã„ãƒ‡ã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚ºï¼ˆCVSS 9.8ï¼‰

| é …ç›® | å†…å®¹ |
|------|------|
| **ãƒ«ãƒ¼ãƒ«** | `cs/unsafe-deserialization-untrusted-input` |
| **ãƒ•ã‚¡ã‚¤ãƒ«** | `VulnApi/Controllers/FileController.cs:61` |
| **CWE** | CWE-502: Deserialization of Untrusted Data |
| **ç²¾åº¦** | high |

**èª¬æ˜**: `Newtonsoft.Json` ã® `TypeNameHandling.All` ã‚’ä½¿ç”¨ã—ã¦ãƒ¦ãƒ¼ã‚¶ãƒ¼å…¥åŠ›ã‚’ç›´æ¥ãƒ‡ã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚ºã—ã¦ã„ã‚‹ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€æ”»æ’ƒè€…ãŒä»»æ„ã® .NET å‹ã‚’ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹åŒ–ã§ãã€ãƒªãƒ¢ãƒ¼ãƒˆã‚³ãƒ¼ãƒ‰å®Ÿè¡Œï¼ˆRCEï¼‰ã«ç¹‹ãŒã‚‹ã€‚

**ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼**:
```
[FromBody] object data â†’ data.ToString() â†’ json â†’ JsonConvert.DeserializeObject(json, settings)
```

**ä¿®æ­£æ¡ˆ**: `TypeNameHandling.None` ã‚’ä½¿ç”¨ã—ã€å‹æŒ‡å®šãŒå¿…è¦ãªå ´åˆã¯ `SerializationBinder` ã§ãƒ›ãƒ¯ã‚¤ãƒˆãƒªã‚¹ãƒˆåˆ¶å¾¡ã™ã‚‹ã€‚

---

#### CVE-CWE-089: SQLã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³ Ã— 4ä»¶ï¼ˆCVSS 8.8ï¼‰

| # | ãƒ•ã‚¡ã‚¤ãƒ« | è¡Œ | ã‚¨ãƒ³ãƒˆãƒªãƒã‚¤ãƒ³ãƒˆ |
|---|---------|-----|-----------------|
| 1 | `VulnApi/Controllers/AuthController.cs` | L41 | `Login([FromBody] LoginRequest)` |
| 2 | `VulnApi/Controllers/UsersController.cs` | L44 | `GetAll([FromQuery] string? search)` |
| 3 | `VulnApi/Controllers/UsersController.cs` | L108 | `Create([FromBody] User user)` |
| 4 | `VulnApi/Controllers/UsersController.cs` | L146 | `Update(int id, [FromBody] User user)` |

**ãƒ«ãƒ¼ãƒ«**: `cs/sql-injection`  
**CWE**: CWE-089: SQL Injection  
**ç²¾åº¦**: high

**èª¬æ˜**: ã™ã¹ã¦ã®SQLæ–‡ãŒãƒ¦ãƒ¼ã‚¶ãƒ¼å…¥åŠ›ã®æ–‡å­—åˆ—è£œé–“ï¼ˆ`$"... '{request.Username}' ..."`ï¼‰ã§æ§‹ç¯‰ã•ã‚Œã¦ãŠã‚Šã€ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿åŒ–ã‚¯ã‚¨ãƒªã‚’ä½¿ç”¨ã—ã¦ã„ãªã„ã€‚èªè¨¼ãƒã‚¤ãƒ‘ã‚¹ã€ãƒ‡ãƒ¼ã‚¿æ¼æ´©ã€ãƒ‡ãƒ¼ã‚¿æ”¹ã–ã‚“ãƒ»å‰Šé™¤ãŒå¯èƒ½ã€‚

**å…·ä½“ä¾‹ï¼ˆAuthController.cs:40ï¼‰**:
```csharp
// è„†å¼±ãªã‚³ãƒ¼ãƒ‰
var sql = $"SELECT ... WHERE username = '{request.Username}' AND password = '{request.Password}'";

// ä¿®æ­£ä¾‹
var sql = "SELECT ... WHERE username = @username AND password = @password";
cmd.Parameters.AddWithValue("@username", request.Username);
cmd.Parameters.AddWithValue("@password", request.Password);
```

---

### ğŸŸ  Highï¼ˆCVSS 7.0â€“8.9ï¼‰

#### CVE-CWE-022: ãƒ‘ã‚¹ãƒˆãƒ©ãƒãƒ¼ã‚µãƒ« Ã— 2ä»¶ï¼ˆCVSS 7.5ï¼‰

| # | ãƒ•ã‚¡ã‚¤ãƒ« | è¡Œ | ã‚·ãƒ³ã‚¯ |
|---|---------|-----|--------|
| 1 | `VulnApi/Controllers/FileController.cs` | L33 | `File.Exists(fullPath)` |
| 2 | `VulnApi/Controllers/FileController.cs` | L37 | `File.ReadAllBytes(fullPath)` |

**ãƒ«ãƒ¼ãƒ«**: `cs/path-injection`  
**CWE**: CWE-022, CWE-023, CWE-036, CWE-073, CWE-099  
**ç²¾åº¦**: high

**èª¬æ˜**: `filePath` ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãŒæœªæ¤œè¨¼ã®ã¾ã¾ `Path.Combine("/app/uploads", filePath)` ã«æ¸¡ã•ã‚Œã‚‹ã€‚`../../etc/passwd` ã®ã‚ˆã†ãªå…¥åŠ›ã§ã‚µãƒ¼ãƒãƒ¼ä¸Šã®ä»»æ„ãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿å–ã‚Šå¯èƒ½ã€‚

**ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼**:
```
[HttpGet("files/{*filePath}")] â†’ Path.Combine("/app/uploads", filePath) â†’ File.Exists() / File.ReadAllBytes()
```

**ä¿®æ­£æ¡ˆ**:
```csharp
var fullPath = Path.GetFullPath(Path.Combine("/app/uploads", filePath));
if (!fullPath.StartsWith("/app/uploads/"))
    return Forbid();
```

---

### ğŸŸ¡ Mediumï¼ˆCVSS 6.0â€“6.9ï¼‰

#### CVE-CWE-285/CWE-862: ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡ã®æ¬ å¦‚ï¼ˆCVSS 7.5ï¼‰

| é …ç›® | å†…å®¹ |
|------|------|
| **ãƒ«ãƒ¼ãƒ«** | `cs/web/missing-function-level-access-control` |
| **ãƒ•ã‚¡ã‚¤ãƒ«** | `VulnApi/Controllers/UsersController.cs:167` |
| **CWE** | CWE-285, CWE-284, CWE-862 |
| **ç²¾åº¦** | medium |

**èª¬æ˜**: `Delete` ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã«èªè¨¼ãƒ»èªå¯ãƒã‚§ãƒƒã‚¯ãŒãªã„ã€‚åŒ¿åãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒä»»æ„ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’å‰Šé™¤å¯èƒ½ã€‚

**ä¿®æ­£æ¡ˆ**: `[Authorize(Roles = "admin")]` å±æ€§ã‚’è¿½åŠ ã€‚

---

#### CVE-CWE-639: å®‰å…¨ã§ãªã„ç›´æ¥ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆå‚ç…§ï¼ˆCVSS 7.5ï¼‰

| é …ç›® | å†…å®¹ |
|------|------|
| **ãƒ«ãƒ¼ãƒ«** | `cs/web/insecure-direct-object-reference` |
| **ãƒ•ã‚¡ã‚¤ãƒ«** | `VulnApi/Controllers/UsersController.cs:167` |
| **CWE** | CWE-639 |
| **ç²¾åº¦** | medium |

**èª¬æ˜**: `Delete(int id)` ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã§ã€ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒå¯¾è±¡ãƒªã‚½ãƒ¼ã‚¹ã®æ‰€æœ‰è€…ã§ã‚ã‚‹ã‹ã®æ¤œè¨¼ãŒãªã„ã€‚

---

### ğŸŸ  Frontend æ¤œå‡º

#### CVE-CWE-079: ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚µã‚¤ãƒ‰ XSSï¼ˆCVSS 7.8ï¼‰

| é …ç›® | å†…å®¹ |
|------|------|
| **ãƒ«ãƒ¼ãƒ«** | `js/xss` |
| **ãƒ•ã‚¡ã‚¤ãƒ«** | `src/pages/UserList.tsx:16` |
| **CWE** | CWE-079, CWE-116 |
| **ç²¾åº¦** | high |

**èª¬æ˜**: URL ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ `redirect` ã®å€¤ã‚’ `window.location.href` ã«ç›´æ¥ä»£å…¥ã€‚`javascript:alert(1)` ã®ã‚ˆã†ãªãƒšã‚¤ãƒ­ãƒ¼ãƒ‰ã§ XSS ãŒæˆç«‹ã™ã‚‹ã€‚

---

#### CVE-CWE-601: ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚µã‚¤ãƒ‰ URLãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆï¼ˆCVSS 6.1ï¼‰

| é …ç›® | å†…å®¹ |
|------|------|
| **ãƒ«ãƒ¼ãƒ«** | `js/client-side-unvalidated-url-redirection` |
| **ãƒ•ã‚¡ã‚¤ãƒ«** | `src/pages/UserList.tsx:16` |
| **CWE** | CWE-601 |
| **ç²¾åº¦** | high |

**èª¬æ˜**: åŒç®‡æ‰€ã€‚å¤–éƒ¨ãƒ‰ãƒ¡ã‚¤ãƒ³ã¸ã®ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆãŒå¯èƒ½ã§ã€ãƒ•ã‚£ãƒƒã‚·ãƒ³ã‚°æ”»æ’ƒã«æ‚ªç”¨ã•ã‚Œã‚‹ã€‚

**ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼**:
```
window.location.search â†’ URLSearchParams â†’ params.get('redirect') â†’ window.location.href = redirect
```

**ä¿®æ­£æ¡ˆ**:
```typescript
if (redirect && redirect.startsWith('/')) {
  window.location.href = redirect;
}
```

---

## CodeQL ãŒæ¤œå‡ºã—ãªã‹ã£ãŸæ—¢çŸ¥ã®è„†å¼±æ€§

ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã®ã‚³ãƒ¡ãƒ³ãƒˆã«è¨˜è¼‰ã•ã‚Œã¦ã„ã‚‹ãŒã€CodeQL security-extended ã‚¹ã‚¤ãƒ¼ãƒˆã§ã¯æ¤œå‡ºã•ã‚Œãªã‹ã£ãŸã‚‚ã®ï¼š

| è„†å¼±æ€§ | ç®‡æ‰€ | ç†ç”± |
|--------|------|------|
| ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å¹³æ–‡ä¿å­˜ (A-03) | AuthController / UsersController | ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒãƒƒã‚·ãƒ¥åŒ–ã®æ¬ å¦‚ã¯ã‚»ãƒãƒ³ãƒ†ã‚£ãƒƒã‚¯è§£æã§ã¯æ¤œå‡ºå›°é›£ |
| è©³ç´°ã‚¨ãƒ©ãƒ¼æƒ…å ±ã®éœ²å‡º (A-04) | å…¨Controller ã®catchå¥ | `ex.StackTrace` ã®è¿”å´ã¯æ¤œå‡ºå¯¾è±¡å¤– |
| Mass Assignment (A-06) | UsersController.Create | `[FromBody] User` ã§ role ãŒç›´æ¥ãƒã‚¤ãƒ³ãƒ‰ã•ã‚Œã‚‹ãŒã€CodeQL ã¯æ§‹é€ çš„ã«æ¤œå‡ºã—ãªã„ |
| HTTPãƒ˜ãƒƒãƒ€ã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³ (A-08) | AuthController L56-57 | DBå€¤ã‚’ãƒ˜ãƒƒãƒ€ã«è¨­å®šã™ã‚‹é–“æ¥çš„ãªçµŒè·¯ã¯è¿½è·¡å¯¾è±¡å¤– |
| ãƒ¬ãƒ¼ãƒˆåˆ¶é™ã®æ¬ å¦‚ (A-09) | AuthController | ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ä¸Šã®å•é¡Œã¯SASTå¯¾è±¡å¤– |

---

## å‡ºåŠ›ãƒ•ã‚¡ã‚¤ãƒ«

| ãƒ•ã‚¡ã‚¤ãƒ« | èª¬æ˜ |
|---------|------|
| `reports/codeql/codeql-results-csharp.sarif` | C# è§£æçµæœ (SARIFå½¢å¼) |
| `reports/codeql/codeql-results-js.sarif` | JS/TS è§£æçµæœ (SARIFå½¢å¼) |
| `reports/codeql/codeql-analysis-report.md` | æœ¬ãƒ¬ãƒãƒ¼ãƒˆ |

---

## ç·åˆè©•ä¾¡

**ğŸ”´ CRITICAL** â€” 11ä»¶ã®è„†å¼±æ€§ãŒæ¤œå‡ºã•ã‚Œã€ã†ã¡5ä»¶ãŒCVSS 8.8ä»¥ä¸Šï¼ˆSQLã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³ + RCEï¼‰ã€‚æœ¬ç•ªç’°å¢ƒã¸ã®ãƒ‡ãƒ—ãƒ­ã‚¤å‰ã«å…¨ä»¶ä¿®æ­£ãŒå¿…é ˆã€‚
