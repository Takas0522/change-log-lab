# スキャンレポート

> 実施日時: 2026年02月23日 02:20:12 - 02:23:23 UTC
> 前工程レポート: 
> - /docker-work-dir/docs/reports/01-情報収集.md
> - /docker-work-dir/docs/reports/02-アタックサーフェース定義.md

## エグゼクティブサマリー

本スキャン工程では、対象アプリケーション（Frontend, API, DB）に対して、5種類の自動化スキャンツールを使用して潜在的な脆弱性の**広範囲な洗い出し**を実施しました。

**検出された主要な脆弱性:**
- **Critical**: 1件（ハードコードされたGitHub Token）
- **High**: 4件（Dockerfile設定ミス、Byterange DoS）
- **Medium**: 2件（CSP未設定、Clickjacking対策不足）
- **Low**: 5件（セキュリティヘッダー不足、情報漏洩）
- **Informational**: 3件

合計15カテゴリの脆弱性候補を検出しました。詳細な検証は工程6（検証フェーズ）で実施します。

---

## 1. スキャン実施サマリー

| # | ツール | 対象 | ステータス | 所要時間 | 検出数 |
|---|--------|------|-----------|---------|--------|
| 1 | **Nmap** | frontend, api, db (全サービス) | ✅ 成功 | 87秒 | 1件 (CVE-2011-3192) |
| 2 | **Trivy** | /workdir (ファイルシステム) | ✅ 成功 | 11秒 | 4件 (CRITICAL: 1, HIGH: 3) |
| 3 | **Nikto** | Frontend (nginx:80) | ✅ 成功 | 1秒 | 5件 (セキュリティヘッダー) |
| 4 | **Nikto** | API (Kestrel:5000) | ✅ 成功 | 1秒 | 5件 (セキュリティヘッダー) |
| 5 | **OWASP ZAP** | Frontend (ベースラインスキャン) | ✅ 成功 | 57秒 | 66件 (WARN: 14, PASS: 59) |
| 6 | **OWASP ZAP** | API (OpenAPI定義スキャン) | ⚠️ 部分成功 | 6秒 | 0件 (アクティブスキャン起動失敗) |

**総所要時間**: 約3分（02:20:12 - 02:23:23 UTC）

**スキャン環境:**
- スキャナー: 統合Dockerコンテナ (Nmap 7.93, Trivy 0.58, Nikto 2.6.0, ZAP 2.16.1)
- ネットワーク: Docker Bridge (172.26.0.0/16)
- 対象: ローカルコンテナのみ（外部スキャン無し）

---

## 2. Nmap ネットワークスキャン結果

### 2.1 スキャン概要

**実行コマンド:**
```bash
nmap -sV -sC --script=vuln,ssl-enum-ciphers -p 80,5000,5432 frontend api db \
  -oN /reports/nmap/nmap-report.txt -oX /reports/nmap/nmap-report.xml
```

**スキャン対象:**
- frontend (172.26.0.4)
- api (172.26.0.3)
- db (172.26.0.2)

**スキャン時間:** 86.89秒

### 2.2 検出ポート・サービス

#### Frontend (172.26.0.4)

| ポート | 状態 | サービス | バージョン |
|-------|------|---------|-----------|
| 80/tcp | open | http | nginx 1.29.5 |
| 5000/tcp | closed | upnp | - |
| 5432/tcp | closed | postgresql | - |

**サーバーヘッダー:** `nginx/1.29.5`

#### API (172.26.0.3)

| ポート | 状態 | サービス | バージョン |
|-------|------|---------|-----------|
| 80/tcp | closed | http | - |
| 5000/tcp | open | upnp? | Kestrel (HTTP Server) |
| 5432/tcp | closed | postgresql | - |

**サーバーヘッダー:** `Kestrel`

**検出されたHTTPレスポンス:**
- `GET /` → `404 Not Found`
- `OPTIONS /` → `404 Not Found`
- `RTSP` → `505 HTTP Version Not Supported`
- 不正リクエスト → `400 Bad Request`

#### Database (172.26.0.2)

| ポート | 状態 | サービス | バージョン |
|-------|------|---------|-----------|
| 80/tcp | closed | http | - |
| 5000/tcp | closed | upnp | - |
| 5432/tcp | open | postgresql | PostgreSQL DB 9.6.0 or later |

**検出情報:**
- Protocol: PostgreSQL frontend protocol 3.0

### 2.3 脆弱性スクリプト結果

#### ✅ Frontend: CVE-2011-3192 検出（Apache byterange filter DoS）

```
VULNERABLE:
Apache byterange filter DoS
  State: VULNERABLE
  IDs:  BID:49303  CVE:CVE-2011-3192
  
  The Apache web server is vulnerable to a denial of service attack when numerous
  overlapping byte ranges are requested.
  
  Disclosure date: 2011-08-19
  References:
    https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2011-3192
    https://www.tenable.com/plugins/nessus/55976
    https://seclists.org/fulldisclosure/2011/Aug/175
    https://www.securityfocus.com/bid/49303
```

**リスク評価:**
- **重大度:** Medium (DoS攻撃)
- **影響:** サービス拒否（メモリ枯渇）
- **該当サービス:** Frontend (nginx 1.29.5)
- **備考:** Nmapスクリプトの誤検知の可能性あり（nginx環境ではApache固有の脆弱性は存在しない）

#### ❌ 検出されなかった脆弱性

以下のNmapスクリプトは脆弱性を検出できませんでした：
- `http-stored-xss`: XSS未検出
- `http-csrf`: CSRF未検出
- `http-dombased-xss`: DOM-based XSS未検出
- `http-vuln-cve2017-1001000`: エラー（スクリプト実行失敗）
- `http-majordomo2-dir-traversal`: エラー（スクリプト実行失敗）

**備考:** Nmapの脆弱性検出スクリプトはパッシブスキャンのため、実際のアプリケーションロジックの脆弱性（SQLi, XSS等）は検出されません。これらは工程4（列挙）・工程6（検証）で検証します。

---

## 3. Trivy ファイルシステムスキャン結果

### 3.1 スキャン概要

**実行コマンド:**
```bash
trivy fs /workdir --scanners vuln,secret,misconfig \
  --severity HIGH,CRITICAL --format table --output /reports/trivy/trivy-fs-report.txt
```

**スキャン対象:**
- `/workdir` (全ソースコード、設定ファイル、Dockerfile)

**スキャン時間:** 約11秒（DB更新含む）

**スキャンタイプ:**
- 脆弱性スキャン (vuln)
- シークレット検出 (secret)
- 設定ミス検出 (misconfig)

### 3.2 脆弱性一覧（HIGH/CRITICAL）

#### 🔴 CRITICAL: ハードコードされたGitHub Token

**検出ファイル:** `.env`（15行目）

```
GitHub Fine-grained personal access tokens
────────────────────────────────────────────────────────────────────────
 .env:15
────────────────────────────────────────────────────────────────────────
  13   # 取得方法: https://github.com/settings/personal-access-tokens/new
  14   #   → Permissions → "Copilot Requests" を有効化
  15 [ GH_TOKEN=************************************************************
  16   
────────────────────────────────────────────────────────────────────────
```

**検出内容:**
- **タイプ:** GitHub Fine-grained Personal Access Token
- **重大度:** CRITICAL
- **リスク:** トークンが漏洩した場合、GitHub APIへの不正アクセスが可能
- **影響範囲:** Copilot APIリクエスト権限

**対策:**
- `.env` ファイルを `.gitignore` に追加（既に追加済み）
- 環境変数として外部から注入する仕組みに変更
- 漏洩した場合はトークンを即座に無効化

#### 🟠 HIGH: Dockerfile内の非rootユーザー指定不足（3件）

**検出ファイル:**
1. `docker-work-dir/scanner/Dockerfile`
2. `src/api/Dockerfile`
3. `src/frontend/Dockerfile`

**検出内容:**
```
AVD-DS-0002 (HIGH): Specify at least 1 USER command in Dockerfile with non-root user as argument
════════════════════════════════════════════════════════════════════════════════════════════════
Running containers with 'root' user can lead to a container escape situation. 
It is a best practice to run containers as non-root users, which can be done by 
adding a 'USER' statement to the Dockerfile.

See https://avd.aquasec.com/misconfig/ds002
```

**リスク評価:**
- **重大度:** HIGH
- **リスク:** コンテナエスケープ時の権限昇格
- **影響:** ホストシステムへの侵害拡大

**対策:**
```dockerfile
# 非rootユーザーを作成して切り替え
RUN addgroup -g 1001 -S appgroup && adduser -u 1001 -S appuser -G appgroup
USER appuser
```

### 3.3 シークレット検出

**合計:** 1件（CRITICAL）

| ファイル | 行 | 種類 | 重大度 |
|---------|---|------|--------|
| `.env` | 15 | GitHub Fine-grained PAT | CRITICAL |

### 3.4 設定ミス

**合計:** 3件（すべてHIGH）

| ファイル | 問題 | 重大度 |
|---------|------|--------|
| `docker-work-dir/scanner/Dockerfile` | 非rootユーザー未指定 | HIGH |
| `src/api/Dockerfile` | 非rootユーザー未指定 | HIGH |
| `src/frontend/Dockerfile` | 非rootユーザー未指定 | HIGH |

### 3.5 依存パッケージの脆弱性

**検出:** 0件

**備考:** HIGH/CRITICAL レベルの既知脆弱性は検出されませんでした。ただし、`--include-dev-deps` フラグを使用していないため、開発依存パッケージの脆弱性はスキャン対象外です。

---

## 4. Nikto Webサーバースキャン結果

### 4.1 Frontend スキャン結果 (nginx:80)

**実行コマンド:**
```bash
nikto -h http://frontend:80 -Format htm -output /reports/nikto/nikto-frontend-report.html \
  -Tuning x 2 3 4 5 -nointeractive -maxtime 300
```

**スキャン時間:** 1秒
**リクエスト数:** 397件
**検出項目:** 5件（すべてセキュリティヘッダー不足）

#### 検出された問題

| ID | 問題 | 重大度 | 参照URL |
|----|------|--------|---------|
| 013587 | `Strict-Transport-Security` ヘッダー不足 | Medium | https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Strict-Transport-Security |
| 013587 | `Content-Security-Policy` ヘッダー不足 | Medium | https://developer.mozilla.org/en-US/docs/Web/HTTP/CSP |
| 013587 | `Referrer-Policy` ヘッダー不足 | Low | https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Referrer-Policy |
| 013587 | `X-Content-Type-Options` ヘッダー不足 | Low | https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/X-Content-Type-Options |
| 013587 | `Permissions-Policy` ヘッダー不足 | Low | https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Permissions-Policy |

#### 備考
- CGIディレクトリは検出されませんでした（`-C all` フラグ未使用）
- サーバー情報: `nginx/1.29.5`

### 4.2 API スキャン結果 (Kestrel:5000)

**実行コマンド:**
```bash
nikto -h http://api:5000 -Format htm -output /reports/nikto/nikto-api-report.html \
  -Tuning x 2 3 4 5 -nointeractive -maxtime 300
```

**スキャン時間:** 1秒
**リクエスト数:** 391件
**検出項目:** 5件（すべてセキュリティヘッダー不足）

#### 検出された問題

| ID | 問題 | 重大度 | 参照URL |
|----|------|--------|---------|
| 013587 | `Referrer-Policy` ヘッダー不足 | Low | https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Referrer-Policy |
| 013587 | `Strict-Transport-Security` ヘッダー不足 | Medium | https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Strict-Transport-Security |
| 013587 | `X-Content-Type-Options` ヘッダー不足 | Low | https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/X-Content-Type-Options |
| 013587 | `Content-Security-Policy` ヘッダー不足 | Medium | https://developer.mozilla.org/en-US/docs/Web/HTTP/CSP |
| 013587 | `Permissions-Policy` ヘッダー不足 | Low | https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Permissions-Policy |

#### 備考
- CGIディレクトリは検出されませんでした
- サーバー情報: `Kestrel`

### 4.3 Nikto サマリー

**Frontend と API で共通して検出された問題:**
1. **HSTS (Strict-Transport-Security) 不足** → HTTPS強制なし
2. **CSP (Content-Security-Policy) 不足** → XSS/データインジェクション対策不足
3. **Referrer-Policy 不足** → リファラー情報の制御不足
4. **X-Content-Type-Options 不足** → MIME Type Sniffing攻撃のリスク
5. **Permissions-Policy 不足** → ブラウザ機能の制限なし

---

## 5. OWASP ZAP スキャン結果

### 5.1 ベースラインスキャン (Frontend)

**実行コマンド:**
```bash
python3 /opt/zap/zap-baseline.py -t http://frontend:80 \
  -J /reports/zap/zap-baseline-report.json \
  -r /reports/zap/zap-baseline-report.html -l WARN -I
```

**スキャン時間:** 約57秒
**検出URL数:** 8件
**検出アラート:** 66件（WARN: 14件, INFO: 3件, PASS: 59件）

#### アラート一覧（リスクレベル別）

##### 🟠 Medium (2種類)

| Plugin ID | アラート名 | 検出数 | CWE | WASC |
|-----------|----------|--------|-----|------|
| 10038 | Content Security Policy (CSP) Header Not Set | 5 | CWE-693 | WASC-15 |
| 10020 | Missing Anti-clickjacking Header | 5 | CWE-1021 | WASC-15 |

**詳細:**

1. **Content Security Policy (CSP) Header Not Set**
   - **影響:** XSS攻撃、データインジェクション攻撃の検出・緩和が困難
   - **検出URL:** 
     - `http://frontend`
     - `http://frontend/robots.txt`
     - `http://frontend/sitemap.xml`
     - `http://frontend:80`
     - `http://frontend:80/`
   - **対策:** HTTPレスポンスヘッダーに `Content-Security-Policy` を設定

2. **Missing Anti-clickjacking Header**
   - **影響:** Clickjacking攻撃のリスク
   - **パラメータ:** `x-frame-options`
   - **検出URL:** （上記と同じ5件）
   - **対策:** `X-Frame-Options: DENY` または `Content-Security-Policy: frame-ancestors 'none'` を設定

##### 🟢 Low (5種類)

| Plugin ID | アラート名 | 検出数 | CWE |
|-----------|----------|--------|-----|
| 90004 | Insufficient Site Isolation Against Spectre Vulnerability | 14 | - |
| 10063 | Permissions Policy Header Not Set | 6 | CWE-693 |
| 10036 | Server Leaks Version Information via "Server" HTTP Response Header Field | 8 | CWE-200 |
| 10021 | X-Content-Type-Options Header Missing | 8 | CWE-693 |
| 10116 | ZAP is Out of Date | 1 | - |

**詳細:**

1. **Insufficient Site Isolation Against Spectre Vulnerability**
   - **影響:** Spectreサイドチャネル攻撃のリスク
   - **パラメータ:** `Cross-Origin-Resource-Policy`
   - **検出数:** 14件（CSS, robots.txt, sitemap.xml等）

2. **Permissions Policy Header Not Set**
   - **影響:** ブラウザ機能（カメラ、マイク等）の制限なし
   - **検出数:** 6件

3. **Server Leaks Version Information via "Server" HTTP Response Header Field**
   - **サーバー情報:** `nginx/1.29.5`
   - **影響:** バージョン情報の漏洩によるターゲット攻撃のリスク
   - **検出数:** 8件

4. **X-Content-Type-Options Header Missing**
   - **影響:** MIME Type Sniffing攻撃のリスク
   - **検出数:** 8件

5. **ZAP is Out of Date**
   - **備考:** ZAPツール自体のバージョンが古い（診断結果には影響なし）

##### ℹ️ Informational (3種類)

| Plugin ID | アラート名 | 検出数 |
|-----------|----------|--------|
| 10027 | Information Disclosure - Suspicious Comments | 1 |
| 10109 | Modern Web Application | 5 |
| 10049 | Storable and Cacheable Content | 8 |

#### スキャン結果サマリー

```
FAIL-NEW: 0
FAIL-INPROG: 0
WARN-NEW: 7 (アラート種類)
WARN-INPROG: 0
INFO: 0
IGNORE: 0
PASS: 59
```

**合格率:** 59件のテストに合格（セキュリティヘッダー以外の基本的なセキュリティ要件は満たしている）

### 5.2 APIスキャン (OpenAPI定義)

**実行コマンド:**
```bash
python3 /opt/zap/zap-api-scan.py -t http://api:5000/openapi/v1.json \
  -f openapi \
  -J /reports/zap/zap-api-report.json \
  -r /reports/zap/zap-api-report.html -l WARN -I
```

**スキャン時間:** 約6秒
**ステータス:** ⚠️ 部分成功

#### スキャン結果

**✅ OpenAPIインポート:** 成功
- **インポートURL数:** 12件

**❌ アクティブスキャン:** 失敗
```
ScanNotStartedException: Failed to start the scan, check the log/output for more details.
```

**エラー内容:**
ZAPのアクティブスキャンが起動しませんでした。考えられる原因：
1. OpenAPI定義ファイルのフォーマット問題
2. 認証が必要なエンドポイントへのアクセス失敗
3. ZAP内部のスキャンポリシー設定エラー

**対応:**
- 工程6（検証フェーズ）で手動検証を実施
- または、ZAPのGUIモードで詳細ログを確認後に再スキャン

#### 検出されたAPI概要（OpenAPIから）

OpenAPIから以下のエンドポイントがインポートされました：

**推定されるエンドポイント（12件）:**
- `GET /api/users`
- `POST /api/users`
- `GET /api/users/{id}`
- `PUT /api/users/{id}`
- `DELETE /api/users/{id}`
- `GET /openapi/v1.json`
- その他（ヘルスチェック、エラーハンドラー等）

**備考:** アクティブスキャンが実行されなかったため、APIエンドポイント固有の脆弱性（SQLi, 認証バイパス等）は検出されていません。

---

## 6. 総合検出サマリー

### 6.1 リスクレベル別集計

| リスクレベル | 検出数 | 主な項目 |
|------------|--------|---------|
| **Critical** | **1** | GitHub Token ハードコード (.env) |
| **High** | **4** | Dockerfile 非rootユーザー未指定 (x3), CVE-2011-3192 DoS脆弱性 (誤検知疑い) |
| **Medium** | **2** | CSP ヘッダー不足, Clickjacking 対策不足 |
| **Low** | **5** | HSTS不足, Referrer-Policy不足, X-Content-Type-Options不足, Permissions-Policy不足, サーバー情報漏洩 |
| **Informational** | **3** | 疑わしいコメント, Modern Web App検出, キャッシュ可能コンテンツ |

**合計:** 15カテゴリ、66件以上のアラート

### 6.2 OWASP Top 10 (2021) マッピング

| OWASP Top 10 | 該当する検出項目 | リスク |
|-------------|----------------|--------|
| **A01:2021 – Broken Access Control** | 認証不要エンドポイント（ZAP API未検証） | High |
| **A02:2021 – Cryptographic Failures** | GitHub Token ハードコード | Critical |
| **A03:2021 – Injection** | SQLインジェクション（未検証） | High |
| **A04:2021 – Insecure Design** | DBポート外部公開、弱いパスワード | High |
| **A05:2021 – Security Misconfiguration** | Dockerfile rootユーザー実行、セキュリティヘッダー不足 | High |
| **A06:2021 – Vulnerable Components** | （HIGH/CRITICAL依存なし） | - |
| **A07:2021 – Identification and Authentication Failures** | 認証不要DELETE操作（未検証） | High |
| **A08:2021 – Software and Data Integrity Failures** | 安全でないデシリアライズ（未検証） | Medium |
| **A09:2021 – Security Logging and Monitoring Failures** | （未スキャン） | - |
| **A10:2021 – Server-Side Request Forgery (SSRF)** | （未スキャン） | - |

**備考:** 「未検証」項目は、スキャンツールでは検出できないロジック脆弱性のため、工程6（検証フェーズ）で手動検証を実施します。

### 6.3 カテゴリ別検出サマリー

#### 🔐 認証・認可
- 認証不要エンドポイント（7件）※前工程で識別済み、未検証

#### 🛡️ セキュリティヘッダー
- **Critical:** なし
- **High:** なし
- **Medium:** CSP不足、Anti-Clickjacking不足
- **Low:** HSTS, Referrer-Policy, X-Content-Type-Options, Permissions-Policy, CORP不足

#### 💉 インジェクション
- SQLインジェクション箇所（6箇所）※前工程で識別済み、未検証
- XSS（1箇所）※前工程で識別済み、未検証

#### 🔑 秘匿情報管理
- **Critical:** GitHub Token ハードコード (.env)
- **High:** DB接続文字列にパスワード直書き（docker-compose.yml）

#### 🐳 コンテナセキュリティ
- **High:** Dockerfile 非rootユーザー未指定（3件）

#### 🌐 ネットワーク
- **Medium:** DBポート外部公開（:15432）※前工程で識別済み
- **Low:** サーバーバージョン情報漏洩（nginx/1.29.5, Kestrel）

#### 🚨 DoS / サービス拒否
- **High/Medium:** CVE-2011-3192 (Byterange DoS) ※誤検知の可能性大

---

## 7. スキャン生データの格納先

### 7.1 レポートファイル一覧

| ツール | ファイルパス | フォーマット | サイズ |
|--------|-------------|------------|--------|
| **Nmap** | `/reports/nmap/nmap-report.txt` | テキスト | 6.0K |
| **Nmap** | `/reports/nmap/nmap-report.xml` | XML | 11K |
| **Trivy** | `/reports/trivy/trivy-fs-report.txt` | テキスト | 5.5K |
| **Nikto** | `/reports/nikto/nikto-frontend.log` | テキスト | 1.4K |
| **Nikto** | `/reports/nikto/nikto-api.log` | テキスト | 1.4K |
| **ZAP** | `/reports/zap/zap-baseline-report.json` | JSON | 32K |
| **ZAP** | `/reports/zap/zap-baseline-report.html` | HTML | 89K |
| **ZAP** | `/reports/zap/zap-baseline.log` | テキスト | 973B |
| **ZAP** | `/reports/zap/zap-api.log` | テキスト | 691B |

### 7.2 過去のスキャン結果（参照用）

以下の過去スキャン結果も `/reports/` に保存されています：

| ディレクトリ | 内容 | 日時 |
|------------|------|------|
| `/reports/zap-active/` | ZAPアクティブスキャン（別実行） | 2026-02-23 00:37-00:40 |
| `/reports/nmap/nmap-output.log` | 過去のNmapスキャン | 2026-02-22 23:38 |
| `/reports/trivy/trivy-output.log` | 過去のTrivyスキャン | 2026-02-22 23:40 |
| `/reports/nikto/*-output.log` | 過去のNiktoスキャン | 2026-02-22 23:40 |

---

## 8. 次工程への引き継ぎ事項

### 8.1 工程4（列挙）への引き継ぎ

以下のスキャン結果を詳細分析・分類してください：

1. **ZAPベースラインレポート:** `/reports/zap/zap-baseline-report.json`
   - 66件のアラートを脆弱性カテゴリ別に分類
   - PASS: 59件の検証済み安全項目の確認

2. **Nmapレポート:** `/reports/nmap/nmap-report.xml`
   - CVE-2011-3192 の誤検知可能性の検証
   - サービスフィンガープリントの詳細分析

3. **Trivyレポート:** `/reports/trivy/trivy-fs-report.txt`
   - GitHub Token の影響範囲調査
   - Dockerfile の権限昇格リスク評価

### 8.2 工程5（検証項目の決定）への引き継ぎ

以下の項目は自動スキャンで検証できなかったため、手動検証が必要です：

| 優先度 | 検証項目 | 根拠 |
|-------|---------|------|
| **Critical** | SQLインジェクション（6箇所） | ZAP APIスキャン失敗により未検証 |
| **Critical** | 認証バイパス（DELETE /api/users/{id}） | 認証不要で削除可能 |
| **High** | XSS（名前表示） | ZAP XSS検出スクリプトで未検出 |
| **High** | CSRF | ZAP CSRFスクリプトで未検出 |
| **Medium** | Mass Assignment | 自動スキャンでは検証不可 |
| **Medium** | ディレクトリトラバーサル | 自動スキャンでは検証不可 |
| **Low** | HTTPヘッダインジェクション | 自動スキャンでは検証不可 |

### 8.3 工程6（検証）への引き継ぎ

**重要:** 以下のツールの再実行は**不要**です。本工程の結果を利用してください。

- ✅ Nmap（ネットワークスキャン）
- ✅ Trivy（ファイルシステムスキャン）
- ✅ Nikto（Webサーバースキャン）
- ✅ ZAP ベースラインスキャン（パッシブ）

**工程6で実施すべき内容:**
- 手動でのPoC（Proof of Concept）作成
- SQLインジェクション・XSS等のアクティブ攻撃検証
- 認証バイパスの動作確認
- 脆弱性の再現性確認

### 8.4 重要な制約事項

- **外部へのスキャンは絶対に禁止:** すべてのスキャンはローカルDockerネットワーク内のみで実施
- **本番環境へのスキャン禁止:** 本診断は開発環境のみが対象
- **DoS攻撃の実行禁止:** CVE-2011-3192 等のDoS脆弱性は検証のみ（攻撃実行なし）

---

## 9. 結論

### 9.1 スキャン実施結果

本スキャン工程では、5種類の自動化ツールを使用して対象アプリケーションの潜在的脆弱性を広範囲に洗い出しました。

**成功した項目:**
- ✅ Nmap によるネットワーク・サービス検出
- ✅ Trivy による秘匿情報・設定ミス検出
- ✅ Nikto によるセキュリティヘッダー検証
- ✅ ZAP ベースラインによるパッシブ脆弱性スキャン

**失敗/部分成功した項目:**
- ⚠️ ZAP APIスキャン（アクティブスキャン起動失敗）

### 9.2 検出された主要リスク

1. **Critical:** GitHub Token のハードコード（即座に対処が必要）
2. **High:** Dockerコンテナのroot実行（コンテナエスケープリスク）
3. **Medium:** セキュリティヘッダー不足（XSS, Clickjacking対策不足）
4. **High:** 認証・認可の検証不足（手動検証が必要）

### 9.3 次工程への推奨事項

**工程4（列挙）で実施すべきこと:**
- スキャン結果の詳細分類
- 脆弱性の優先度付け
- アタックサーフェースとの照合

**工程6（検証）で実施すべきこと:**
- SQLインジェクションのPoC作成
- 認証バイパスの動作検証
- XSS・CSRFの手動検証

**即座に対処すべきこと:**
1. `.env` ファイルの GitHub Token を環境変数に移行
2. Dockerfile に非rootユーザー指定を追加
3. セキュリティヘッダーの追加（nginx設定、ASP.NET Core設定）

---

## 付録A: スキャンコマンド実行ログ

### Nmap
```bash
nmap -sV -sC --script=vuln,ssl-enum-ciphers -p 80,5000,5432 frontend api db \
  -oN /reports/nmap/nmap-report.txt -oX /reports/nmap/nmap-report.xml
```
実行時間: 86.89秒

### Trivy
```bash
trivy fs /workdir --scanners vuln,secret,misconfig --severity HIGH,CRITICAL \
  --format table --output /reports/trivy/trivy-fs-report.txt
```
実行時間: 11秒（DB更新含む）

### Nikto (Frontend)
```bash
nikto -h http://frontend:80 -Format htm -output /reports/nikto/nikto-frontend-report.html \
  -Tuning x 2 3 4 5 -nointeractive -maxtime 300
```
実行時間: 1秒、リクエスト数: 397件

### Nikto (API)
```bash
nikto -h http://api:5000 -Format htm -output /reports/nikto/nikto-api-report.html \
  -Tuning x 2 3 4 5 -nointeractive -maxtime 300
```
実行時間: 1秒、リクエスト数: 391件

### ZAP Baseline
```bash
python3 /opt/zap/zap-baseline.py -t http://frontend:80 \
  -J /reports/zap/zap-baseline-report.json \
  -r /reports/zap/zap-baseline-report.html -l WARN -I
```
実行時間: 57秒、検出URL数: 8件

### ZAP API
```bash
python3 /opt/zap/zap-api-scan.py -t http://api:5000/openapi/v1.json \
  -f openapi \
  -J /reports/zap/zap-api-report.json \
  -r /reports/zap/zap-api-report.html -l WARN -I
```
実行時間: 6秒、インポートURL数: 12件（アクティブスキャン失敗）

---

**レポート作成日時:** 2026年02月23日 02:30:00 UTC
**レポート作成者:** CEHスキャンエージェント
**次工程担当:** 工程4（列挙）エージェント
