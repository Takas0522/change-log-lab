# ãƒªã‚¹ã‚¯è©•ä¾¡ & æ˜¯æ­£ææ¡ˆãƒ¬ãƒãƒ¼ãƒˆ

> **å®Ÿæ–½æ—¥æ™‚**: 2026-02-08 09:00:00 - 10:00:00 UTC  
> **è¨ºæ–­å¯¾è±¡**: vulnerability-siteï¼ˆãƒ­ãƒ¼ã‚«ãƒ« Docker Compose ç’°å¢ƒï¼‰  
> **è¨ºæ–­æœŸé–“**: 2026-02-08 09:01:44 - 09:35:50 UTC  
> **è¨ºæ–­æ‰‹æ³•**: CEHï¼ˆCertified Ethical Hackerï¼‰è„†å¼±æ€§è¨ºæ–­ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯  
> **å®Ÿæ–½ãƒ•ã‚§ãƒ¼ã‚º**: å…¨7ãƒ•ã‚§ãƒ¼ã‚ºï¼ˆæƒ…å ±åé›†â†’ã‚¢ã‚¿ãƒƒã‚¯ã‚µãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹å®šç¾©â†’ã‚¹ã‚­ãƒ£ãƒ³â†’åˆ—æŒ™â†’æ¤œè¨¼è¨ˆç”»â†’æ¤œè¨¼â†’ãƒªã‚¹ã‚¯è©•ä¾¡ï¼‰

---

## ã‚¨ã‚°ã‚¼ã‚¯ãƒ†ã‚£ãƒ–ã‚µãƒãƒªãƒ¼

### è¨ºæ–­æ¦‚è¦

æœ¬è¨ºæ–­ã¯ã€æ„å›³çš„ã«è„†å¼±æ€§ã‚’åŸ‹ã‚è¾¼ã‚“ã å­¦ç¿’ç”¨Webã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã€Œvulnerability-siteã€ã«å¯¾ã—ã¦ã€CEHã®æ‰‹æ³•ã«åŸºã¥ãåŒ…æ‹¬çš„ãªè„†å¼±æ€§è¨ºæ–­ã‚’å®Ÿæ–½ã—ã¾ã—ãŸã€‚å¯¾è±¡ã‚·ã‚¹ãƒ†ãƒ ã¯ã€React ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã€ASP.NET Core APIã€PostgreSQL ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã§æ§‹æˆã•ã‚Œã‚‹3å±¤ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã®Docker Composeç’°å¢ƒã§ã™ã€‚

è¨ºæ–­ã®çµæœã€**13å€‹ã®å®Ÿè¨¼æ¸ˆã¿è„†å¼±æ€§**ã‚’ç¢ºèªã—ã€ãã®ã†ã¡**7å€‹ãŒCriticalé‡å¤§åº¦**ã«åˆ†é¡ã•ã‚Œã‚‹æ·±åˆ»ãªã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å•é¡Œã§ã‚ã‚‹ã“ã¨ãŒåˆ¤æ˜ã—ã¾ã—ãŸã€‚

### ä½¿ç”¨ãƒ„ãƒ¼ãƒ«ãƒ»æ‰‹æ³•

| ãƒ„ãƒ¼ãƒ«/æ‰‹æ³• | ãƒãƒ¼ã‚¸ãƒ§ãƒ³ | ç”¨é€” | å®Ÿæ–½çŠ¶æ³ |
|-----------|-----------|------|---------|
| **é™çš„ã‚³ãƒ¼ãƒ‰åˆ†æ** | - | ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰è©³ç´°ãƒ¬ãƒ“ãƒ¥ãƒ¼ | âœ… å®Œäº† |
| **Trivy** | latest | ã‚³ãƒ³ãƒ†ãƒŠ/ãƒ•ã‚¡ã‚¤ãƒ«ã‚·ã‚¹ãƒ†ãƒ ã‚¹ã‚­ãƒ£ãƒ³ | âœ… å®Œäº† |
| **curl** | - | æ‰‹å‹•HTTPæ¤œè¨¼ | âœ… å®Œäº†ï¼ˆ50+ãƒ†ã‚¹ãƒˆï¼‰ |
| **Nmap** | - | ãƒãƒ¼ãƒˆã‚¹ã‚­ãƒ£ãƒ³ | âœ… å®Œäº† |
| **sqlmap** | - | SQLã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³æ¤œè¨¼ | â¸ï¸ æ‰‹å‹•æ¤œè¨¼ã§ä»£æ›¿ |
| **OWASP ZAP** | - | Webã‚¢ãƒ—ãƒªã‚¹ã‚­ãƒ£ãƒ³ | â¸ï¸ é™çš„åˆ†æã§ä»£æ›¿ |
| **Nikto** | - | Webã‚µãƒ¼ãƒãƒ¼æ¤œæŸ» | â¸ï¸ é™çš„åˆ†æã§ä»£æ›¿ |

### ç·åˆãƒªã‚¹ã‚¯è©•ä¾¡

| æŒ‡æ¨™ | å€¤ |
|------|-----|
| **ç·è„†å¼±æ€§æ•°** | 24å€‹ï¼ˆè¨­è¨ˆæ–‡æ›¸ãƒ™ãƒ¼ã‚¹ï¼‰ |
| **å®Ÿè¨¼æ¸ˆã¿è„†å¼±æ€§æ•°** | **13å€‹** |
| **Critical** | **7å€‹** (54%) |
| **High** | **4å€‹** (31%) |
| **Medium** | **2å€‹** (15%) |
| **Low** | 0å€‹ (0%) |
| **ç·åˆãƒªã‚¹ã‚¯ãƒ¬ãƒ™ãƒ«** | ğŸ”´ **CRITICAL** |

### ãƒ“ã‚¸ãƒã‚¹ã‚¤ãƒ³ãƒ‘ã‚¯ãƒˆ

æœ¬è¨ºæ–­ã§ç¢ºèªã•ã‚ŒãŸè„†å¼±æ€§ãŒå®Ÿç’°å¢ƒã§æ‚ªç”¨ã•ã‚ŒãŸå ´åˆã€ä»¥ä¸‹ã®æ·±åˆ»ãªå½±éŸ¿ãŒæƒ³å®šã•ã‚Œã¾ã™:

- ğŸ”´ **å…¨é¡§å®¢ãƒ‡ãƒ¼ã‚¿ã®æ¼æ´©**: ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å«ã‚€å…¨ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ãŒå¹³æ–‡ã§çªƒå–å¯èƒ½
- ğŸ”´ **ã‚·ã‚¹ãƒ†ãƒ ã®å®Œå…¨åˆ¶å¾¡**: ãƒªãƒ¢ãƒ¼ãƒˆã‚³ãƒ¼ãƒ‰å®Ÿè¡Œï¼ˆRCEï¼‰ã«ã‚ˆã‚‹ã‚µãƒ¼ãƒãƒ¼åˆ¶å¾¡
- ğŸ”´ **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã¸ã®ç›´æ¥ã‚¢ã‚¯ã‚»ã‚¹**: å¤–éƒ¨å…¬é–‹ãƒãƒ¼ãƒˆã‹ã‚‰ç›´æ¥DBä¾µå…¥å¯èƒ½
- ğŸ”´ **èªè¨¼ã®å®Œå…¨ãƒã‚¤ãƒ‘ã‚¹**: ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ä¸è¦ã§ä»»æ„ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¨ã—ã¦ãƒ­ã‚°ã‚¤ãƒ³å¯èƒ½
- ğŸ”´ **æ³•çš„ãƒªã‚¹ã‚¯**: GDPRã€å€‹äººæƒ…å ±ä¿è­·æ³•é•åã«ã‚ˆã‚‹é«˜é¡åˆ¶è£é‡‘
- ğŸ”´ **ãƒ¬ãƒ”ãƒ¥ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ãƒªã‚¹ã‚¯**: é¡§å®¢ä¿¡é ¼ã®å®Œå…¨å–ªå¤±ã€è¨´è¨Ÿãƒªã‚¹ã‚¯

### ä¸»è¦ãªç™ºè¦‹äº‹é …ï¼ˆTop 7ï¼‰

1. **ğŸ”´ SQLã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³ï¼ˆ5ç®‡æ‰€ï¼‰** - CVSS 9.8-10.0 - èªè¨¼ãƒã‚¤ãƒ‘ã‚¹ã€å…¨ãƒ‡ãƒ¼ã‚¿çªƒå–å¯èƒ½
2. **ğŸ”´ ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒãƒ¼ãƒˆå¤–éƒ¨å…¬é–‹** - CVSS 10.0 - localhost:15432ã§ç›´æ¥DBæ¥ç¶šå¯èƒ½
3. **ğŸ”´ èªè¨¼ã®å®Œå…¨æ¬ å¦‚** - CVSS 9.1 - å…¨8 APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆãŒèªè¨¼ãªã—ã§ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½
4. **ğŸ”´ å®‰å…¨ã§ãªã„ãƒ‡ã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚º** - CVSS 9.8 - RCEï¼ˆãƒªãƒ¢ãƒ¼ãƒˆã‚³ãƒ¼ãƒ‰å®Ÿè¡Œï¼‰ã®å¯èƒ½æ€§
5. **ğŸŸ  Stored XSS** - CVSS 7.1 - æ°¸ç¶šçš„ã‚¯ãƒ­ã‚¹ã‚µã‚¤ãƒˆã‚¹ã‚¯ãƒªãƒ—ãƒ†ã‚£ãƒ³ã‚°
6. **ğŸŸ  ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªãƒˆãƒ©ãƒãƒ¼ã‚µãƒ«** - CVSS 7.5 - /etc/passwdå–å¾—æˆåŠŸ
7. **ğŸŸ  CORSè¨­å®šã®ä¸å‚™** - CVSS 7.1 - å…¨ã‚ªãƒªã‚¸ãƒ³è¨±å¯ï¼ˆAllowAnyOriginï¼‰

---

## 1. è„†å¼±æ€§è©³ç´°

### 1.1 Critical ãƒ¬ãƒ™ãƒ«ï¼ˆ7ä»¶ï¼‰

---

#### VULN-001: SQLã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³ï¼ˆãƒ­ã‚°ã‚¤ãƒ³èªè¨¼ãƒã‚¤ãƒ‘ã‚¹ï¼‰

- **æ¤œè¨¼ID**: V-02
- **CWE**: CWE-89: Improper Neutralization of Special Elements used in an SQL Command ('SQL Injection')
- **OWASP Top 10**: A03:2021 - Injection
- **CVSS v3.1**: **10.0 (Critical)**
- **CVSS ãƒ™ã‚¯ãƒˆãƒ«**: `CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:C/C:H/I:H/A:H`
  - AV:N (Network) - ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‹ã‚‰ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½
  - AC:L (Low) - æ”»æ’ƒæ¡ä»¶ãŒå®¹æ˜“
  - PR:N (None) - èªè¨¼ä¸è¦
  - UI:N (None) - ãƒ¦ãƒ¼ã‚¶ãƒ¼æ“ä½œä¸è¦
  - S:C (Changed) - ã‚¹ã‚³ãƒ¼ãƒ—å¤‰æ›´ã‚ã‚Šï¼ˆä»–ã‚·ã‚¹ãƒ†ãƒ ã¸ã®å½±éŸ¿ï¼‰
  - C:H/I:H/A:H (High) - æ©Ÿå¯†æ€§ãƒ»å®Œå…¨æ€§ãƒ»å¯ç”¨æ€§ã™ã¹ã¦æ·±åˆ»ãªå½±éŸ¿
- **æ¤œå‡ºãƒ„ãƒ¼ãƒ«**: curlï¼ˆæ‰‹å‹•æ¤œè¨¼ï¼‰
- **å ´æ‰€**: `src/api/VulnApi/Controllers/AuthController.cs:40`
- **ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ**: `POST /api/login`

**èª¬æ˜**:

ãƒ­ã‚°ã‚¤ãƒ³APIãŒæ–‡å­—åˆ—é€£çµã«ã‚ˆã‚‹SQLæ§‹ç¯‰ã‚’è¡Œã£ã¦ãŠã‚Šã€usernameãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã«SQLã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³ãƒšã‚¤ãƒ­ãƒ¼ãƒ‰ã‚’æ³¨å…¥ã™ã‚‹ã“ã¨ã§ã€ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰æ¤œè¨¼ã‚’å®Œå…¨ã«ãƒã‚¤ãƒ‘ã‚¹ã§ãã‚‹è„†å¼±æ€§ã§ã™ã€‚æ”»æ’ƒè€…ã¯ä»»æ„ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ï¼ˆç‰¹ã«ç®¡ç†è€…ï¼‰ã¨ã—ã¦ãƒ­ã‚°ã‚¤ãƒ³ã—ã€å…¨ãƒ‡ãƒ¼ã‚¿ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ã¨æ”¹ã–ã‚“ãŒå¯èƒ½ã«ãªã‚Šã¾ã™ã€‚

**è„†å¼±ãªã‚³ãƒ¼ãƒ‰**:

```csharp
// src/api/VulnApi/Controllers/AuthController.cs:40
[HttpPost]
public async Task<IActionResult> Login([FromBody] LoginRequest request)
{
    using var conn = _dbFactory.CreateConnection();
    await conn.OpenAsync();
    
    // âš ï¸ è„†å¼±: æ–‡å­—åˆ—é€£çµã«ã‚ˆã‚‹SQLæ§‹ç¯‰
    var sql = $"SELECT id, username, email, password, role, profile_image_url, created_at, updated_at FROM users WHERE username = '{request.Username}' AND password = '{request.Password}'";
    
    using var cmd = new NpgsqlCommand(sql, conn);
    // ... ä»¥ä¸‹çœç•¥
}
```

**æ”»æ’ƒãƒšã‚¤ãƒ­ãƒ¼ãƒ‰**:

```bash
curl -s -X POST http://api:5000/api/login \
  -H "Content-Type: application/json" \
  -d '{"username":"admin'\'' OR '\''1'\''='\''1'\'' --","password":"anything"}'
```

**å®Ÿè¡Œã•ã‚Œã‚‹SQL**:

```sql
SELECT ... FROM users WHERE username = 'admin' OR '1'='1' --' AND password = 'anything'
```

**è¨¼è·¡**:

```json
{
  "success": true,
  "message": "Login successful",
  "user": {
    "id": 1,
    "username": "admin",
    "email": "admin@example.com",
    "password": "admin123",
    "role": "admin",
    "createdAt": "2026-02-08T07:16:45.83879",
    "updatedAt": "2026-02-08T07:16:45.83879"
  }
}
```

**å½±éŸ¿**:

- **èªè¨¼ã®å®Œå…¨ãƒã‚¤ãƒ‘ã‚¹**: ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ä¸è¦ã§ä»»æ„ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¨ã—ã¦ãƒ­ã‚°ã‚¤ãƒ³å¯èƒ½
- **å¹³æ–‡ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã®éœ²å‡º**: ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã«ç®¡ç†è€…ã®å¹³æ–‡ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ï¼ˆadmin123ï¼‰ãŒå«ã¾ã‚Œã‚‹
- **æ¨©é™æ˜‡æ ¼**: ä¸€èˆ¬ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‹ã‚‰ç®¡ç†è€…æ¨©é™ã¸ã®å³åº§ã®æ˜‡æ ¼
- **é€£é–æ”»æ’ƒ**: å–å¾—ã—ãŸadminã‚¢ã‚«ã‚¦ãƒ³ãƒˆã§ä»–ã®æ”»æ’ƒãŒå¯èƒ½
- **å…¨ãƒ‡ãƒ¼ã‚¿ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹**: ç®¡ç†è€…æ¨©é™ã§å…¨ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã«ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½

**æ˜¯æ­£ææ¡ˆ**:

**å„ªå…ˆåº¦**: ğŸ”´ **P0 - å³åº§ã«å¯¾å¿œï¼ˆ24æ™‚é–“ä»¥å†…ï¼‰**

**ä¿®æ­£å‰ï¼ˆè„†å¼±ãªã‚³ãƒ¼ãƒ‰ï¼‰**:

```csharp
var sql = $"SELECT id, username, email, password, role, profile_image_url, created_at, updated_at FROM users WHERE username = '{request.Username}' AND password = '{request.Password}'";
using var cmd = new NpgsqlCommand(sql, conn);
```

**ä¿®æ­£å¾Œï¼ˆå®‰å…¨ãªã‚³ãƒ¼ãƒ‰ï¼‰**:

```csharp
// ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿åŒ–ã‚¯ã‚¨ãƒªï¼ˆPrepared Statementï¼‰ã®ä½¿ç”¨
var sql = "SELECT id, username, email, password, role, profile_image_url, created_at, updated_at FROM users WHERE username = @username AND password = @password";
using var cmd = new NpgsqlCommand(sql, conn);
cmd.Parameters.AddWithValue("@username", request.Username);
cmd.Parameters.AddWithValue("@password", request.Password);
```

**è¿½åŠ ã®å¯¾ç­–**:

1. **ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã®ãƒãƒƒã‚·ãƒ¥åŒ–**:
   ```csharp
   // BCryptã®ä½¿ç”¨
   using BCrypt.Net;
   
   // ç™»éŒ²æ™‚
   var hashedPassword = BCrypt.HashPassword(request.Password);
   
   // èªè¨¼æ™‚
   if (!BCrypt.Verify(request.Password, storedHashedPassword))
   {
       return Unauthorized(new { message = "Invalid credentials" });
   }
   ```

2. **ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‹ã‚‰ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’é™¤å¤–**:
   ```csharp
   // DTOï¼ˆData Transfer Objectï¼‰ã®ä½¿ç”¨
   public class UserResponse
   {
       public int Id { get; set; }
       public string Username { get; set; }
       public string Email { get; set; }
       public string Role { get; set; }
       // âš ï¸ Passwordãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã¯å«ã‚ãªã„
   }
   ```

3. **å…¥åŠ›æ¤œè¨¼ã®è¿½åŠ **:
   ```csharp
   // Data Annotationsã«ã‚ˆã‚‹æ¤œè¨¼
   public class LoginRequest
   {
       [Required]
       [StringLength(100, MinimumLength = 3)]
       [RegularExpression(@"^[a-zA-Z0-9_]+$")]
       public string Username { get; set; }
       
       [Required]
       [StringLength(255, MinimumLength = 8)]
       public string Password { get; set; }
   }
   ```

4. **ãƒ¬ãƒ¼ãƒˆåˆ¶é™ã®å®Ÿè£…**:
   ```csharp
   // ASP.NET Core Rate Limitingã®è¨­å®š
   builder.Services.AddRateLimiter(options =>
   {
       options.AddFixedWindowLimiter("login", opt =>
       {
           opt.Window = TimeSpan.FromMinutes(5);
           opt.PermitLimit = 5;
           opt.QueueProcessingOrder = QueueProcessingOrder.OldestFirst;
       });
   });
   
   // ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã¸ã®é©ç”¨
   [EnableRateLimiting("login")]
   [HttpPost]
   public async Task<IActionResult> Login([FromBody] LoginRequest request)
   ```

---

#### VULN-002: ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒãƒ¼ãƒˆå¤–éƒ¨å…¬é–‹

- **æ¤œè¨¼ID**: V-12
- **CWE**: CWE-668: Exposure of Resource to Wrong Sphere
- **OWASP Top 10**: A05:2021 - Security Misconfiguration
- **CVSS v3.1**: **10.0 (Critical)**
- **CVSS ãƒ™ã‚¯ãƒˆãƒ«**: `CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:C/C:H/I:H/A:H`
- **æ¤œå‡ºãƒ„ãƒ¼ãƒ«**: nmap, bash
- **å ´æ‰€**: `docker-compose.yml:7-8`

**èª¬æ˜**:

PostgreSQLãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®ãƒãƒ¼ãƒˆ5432ãŒã€ãƒ›ã‚¹ãƒˆãƒã‚·ãƒ³ã®15432ãƒãƒ¼ãƒˆã§å¤–éƒ¨ã«å…¬é–‹ã•ã‚Œã¦ã„ã¾ã™ã€‚å¼±ã„èªè¨¼æƒ…å ±ï¼ˆpostgres/postgres123ï¼‰ã¨çµ„ã¿åˆã‚ã›ã‚‹ã“ã¨ã§ã€æ”»æ’ƒè€…ã¯ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‹ã‚‰ç›´æ¥ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«æ¥ç¶šã—ã€å…¨ãƒ‡ãƒ¼ã‚¿ã®çªƒå–ãƒ»æ”¹ã–ã‚“ãƒ»å‰Šé™¤ãŒå¯èƒ½ã«ãªã‚Šã¾ã™ã€‚

**è„†å¼±ãªè¨­å®š**:

```yaml
# docker-compose.yml
services:
  db:
    image: postgres:16-alpine
    environment:
      POSTGRES_USER: postgres
      POSTGRES_PASSWORD: postgres123  # âš ï¸ å¼±ã„ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰
      POSTGRES_DB: vulndb
    ports:
      - "15432:5432"  # âš ï¸ å¤–éƒ¨å…¬é–‹ï¼ˆä¸è¦ï¼‰
```

**æ¤œè¨¼ã‚³ãƒãƒ³ãƒ‰**:

```bash
# ãƒãƒ¼ãƒˆã‚¹ã‚­ãƒ£ãƒ³
nmap -p 5432 db

# ç›´æ¥æ¥ç¶šãƒ†ã‚¹ãƒˆ
bash -c 'echo > /dev/tcp/db/5432'

# psqlã§ã®æ¥ç¶šè©¦è¡Œï¼ˆãƒ›ã‚¹ãƒˆã‹ã‚‰ï¼‰
psql -h localhost -p 15432 -U postgres -d vulndb
# Password: postgres123
```

**è¨¼è·¡**:

```
PORT     STATE SERVICE
5432/tcp open  postgresql

âœ… DBæ¥ç¶šå¯èƒ½: ãƒãƒ¼ãƒˆ5432ã¯é–‹ã„ã¦ã„ã¾ã™
```

**å½±éŸ¿**:

- **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã¸ã®ç›´æ¥ã‚¢ã‚¯ã‚»ã‚¹**: ãƒ›ã‚¹ãƒˆãƒã‚·ãƒ³ã‚„ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯å†…ã®ä»»æ„ã®ãƒã‚·ãƒ³ã‹ã‚‰`localhost:15432`ã§æ¥ç¶šå¯èƒ½
- **å…¨ãƒ‡ãƒ¼ã‚¿ã®çªƒå–**: usersãƒ†ãƒ¼ãƒ–ãƒ«å…¨ä½“ã‚’å«ã‚€å…¨ãƒ‡ãƒ¼ã‚¿ã®ãƒ€ãƒ³ãƒ—ãŒå¯èƒ½
- **ãƒ‡ãƒ¼ã‚¿æ”¹ã–ã‚“ãƒ»å‰Šé™¤**: UPDATE/DELETEæ–‡ã®å®Ÿè¡Œã«ã‚ˆã‚‹ãƒ‡ãƒ¼ã‚¿ç ´å£Š
- **ãƒãƒƒã‚¯ãƒ‰ã‚¢ã®è¨­ç½®**: æ–°è¦ç®¡ç†è€…ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®ä½œæˆ
- **ãƒ–ãƒ«ãƒ¼ãƒˆãƒ•ã‚©ãƒ¼ã‚¹æ”»æ’ƒ**: å¼±ã„ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ï¼ˆpostgres123ï¼‰ã«ã‚ˆã‚ŠçŸ­æ™‚é–“ã§çªç ´å¯èƒ½
- **èªè¨¼ä¸è¦ã®æ”»æ’ƒ**: APIå±¤ã‚’ãƒã‚¤ãƒ‘ã‚¹ã—ã¦ç›´æ¥DBæ“ä½œãŒå¯èƒ½

**æ˜¯æ­£ææ¡ˆ**:

**å„ªå…ˆåº¦**: ğŸ”´ **P0 - å³åº§ã«å¯¾å¿œï¼ˆ24æ™‚é–“ä»¥å†…ï¼‰**

**ä¿®æ­£å‰ï¼ˆè„†å¼±ãªè¨­å®šï¼‰**:

```yaml
db:
  ports:
    - "15432:5432"  # å¤–éƒ¨å…¬é–‹
  environment:
    POSTGRES_PASSWORD: postgres123
```

**ä¿®æ­£å¾Œï¼ˆå®‰å…¨ãªè¨­å®šï¼‰**:

```yaml
db:
  # ports: ã®è¡Œã‚’å®Œå…¨ã«å‰Šé™¤ï¼ˆå†…éƒ¨ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã®ã¿ã§ã‚¢ã‚¯ã‚»ã‚¹ï¼‰
  environment:
    POSTGRES_PASSWORD: ${POSTGRES_PASSWORD}  # ç’°å¢ƒå¤‰æ•°ã‹ã‚‰èª­ã¿è¾¼ã¿
```

**è¿½åŠ ã®å¯¾ç­–**:

1. **ç’°å¢ƒå¤‰æ•°ãƒ•ã‚¡ã‚¤ãƒ«ã®ä½¿ç”¨**:
   
   ```.env
   # .env ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆ.gitignoreã«è¿½åŠ ï¼‰
   POSTGRES_PASSWORD=<å¼·åŠ›ãªãƒ©ãƒ³ãƒ€ãƒ ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰>
   ```

2. **å¼·åŠ›ãªãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã®ç”Ÿæˆ**:
   
   ```bash
   # ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ç”Ÿæˆä¾‹
   openssl rand -base64 32
   ```

3. **Docker Secretsã®ä½¿ç”¨**ï¼ˆæœ¬ç•ªç’°å¢ƒæ¨å¥¨ï¼‰:
   
   ```yaml
   # docker-compose.yml
   services:
     db:
       secrets:
         - db_password
       environment:
         POSTGRES_PASSWORD_FILE: /run/secrets/db_password
   
   secrets:
     db_password:
       file: ./secrets/db_password.txt
   ```

4. **ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯åˆ†é›¢**:
   
   ```yaml
   networks:
     frontend_network:
       driver: bridge
     backend_network:
       driver: bridge
       internal: true  # å¤–éƒ¨æ¥ç¶šä¸å¯
   
   services:
     db:
       networks:
         - backend_network  # ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã®ã¿
     api:
       networks:
         - frontend_network
         - backend_network
   ```

---

#### VULN-003: SQLã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³ï¼ˆæ¤œç´¢æ©Ÿèƒ½ï¼‰

- **æ¤œè¨¼ID**: V-01
- **CWE**: CWE-89: SQL Injection
- **OWASP Top 10**: A03:2021 - Injection
- **CVSS v3.1**: **9.8 (Critical)**
- **CVSS ãƒ™ã‚¯ãƒˆãƒ«**: `CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H`
- **æ¤œå‡ºãƒ„ãƒ¼ãƒ«**: curl
- **å ´æ‰€**: `src/api/VulnApi/Controllers/UsersController.cs:40`
- **ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ**: `GET /api/users?search=`

**èª¬æ˜**:

ãƒ¦ãƒ¼ã‚¶ãƒ¼æ¤œç´¢æ©Ÿèƒ½ãŒæ–‡å­—åˆ—é€£çµã«ã‚ˆã‚‹SQLæ§‹ç¯‰ã‚’è¡Œã£ã¦ãŠã‚Šã€searchãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã«SQLã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³ãƒšã‚¤ãƒ­ãƒ¼ãƒ‰ã‚’æ³¨å…¥ã™ã‚‹ã“ã¨ã§ã€å…¨ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ï¼ˆå¹³æ–‡ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å«ã‚€ï¼‰ã‚’çªƒå–ã§ãã¾ã™ã€‚

**è„†å¼±ãªã‚³ãƒ¼ãƒ‰**:

```csharp
// src/api/VulnApi/Controllers/UsersController.cs:40
[HttpGet]
public async Task<IActionResult> GetAll([FromQuery] string? search)
{
    using var conn = _dbFactory.CreateConnection();
    await conn.OpenAsync();
    
    var sql = "SELECT id, username, email, password, role, profile_image_url, created_at, updated_at FROM users";
    if (!string.IsNullOrEmpty(search))
    {
        // âš ï¸ è„†å¼±: æ–‡å­—åˆ—é€£çµã«ã‚ˆã‚‹SQLæ§‹ç¯‰
        sql += $" WHERE username LIKE '%{search}%' OR email LIKE '%{search}%'";
    }
    
    using var cmd = new NpgsqlCommand(sql, conn);
    // ... ä»¥ä¸‹çœç•¥
}
```

**æ”»æ’ƒãƒšã‚¤ãƒ­ãƒ¼ãƒ‰**:

```bash
curl -s "http://api:5000/api/users?search=%27%20OR%201%3D1%20--"
# ãƒ‡ã‚³ãƒ¼ãƒ‰: ' OR 1=1 --
```

**è¨¼è·¡**:

```json
[
  {
    "id": 1,
    "username": "admin",
    "email": "admin@example.com",
    "password": "admin123",
    "role": "admin",
    "profileImageUrl": "",
    "createdAt": "2026-02-08T07:16:45.83879",
    "updatedAt": "2026-02-08T07:16:45.83879"
  },
  {
    "id": 2,
    "username": "tanaka",
    "email": "tanaka@example.com",
    "password": "password",
    "role": "user",
    ...
  },
  // ... å…¨5ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒè¿”å´ã•ã‚Œã‚‹
]
```

**å½±éŸ¿**:

- **å…¨ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã®æ¼æ´©**: 5ãƒ¦ãƒ¼ã‚¶ãƒ¼å…¨å“¡ã®æƒ…å ±ãŒå–å¾—å¯èƒ½
- **å¹³æ–‡ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã®éœ²å‡º**: admin123, password, 123456, qwerty, letmein ãŒéœ²å‡º
- **ãƒ­ãƒ¼ãƒ«æƒ…å ±ã®éœ²å‡º**: ç®¡ç†è€…ã¨ä¸€èˆ¬ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®è­˜åˆ¥ãŒå¯èƒ½
- **UNION-basedæ”»æ’ƒ**: ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ§‹é€ å…¨ä½“ã®å–å¾—ãŒå¯èƒ½

**æ˜¯æ­£ææ¡ˆ**:

**å„ªå…ˆåº¦**: ğŸ”´ **P0 - å³åº§ã«å¯¾å¿œï¼ˆ24æ™‚é–“ä»¥å†…ï¼‰**

**ä¿®æ­£å¾Œï¼ˆå®‰å…¨ãªã‚³ãƒ¼ãƒ‰ï¼‰**:

```csharp
[HttpGet]
public async Task<IActionResult> GetAll([FromQuery] string? search)
{
    using var conn = _dbFactory.CreateConnection();
    await conn.OpenAsync();
    
    var sql = "SELECT id, username, email, role, profile_image_url, created_at, updated_at FROM users";
    // âš ï¸ passwordã‚«ãƒ©ãƒ ã‚’SELECTã‹ã‚‰é™¤å¤–
    
    NpgsqlCommand cmd;
    if (!string.IsNullOrEmpty(search))
    {
        sql += " WHERE username LIKE @search OR email LIKE @search";
        cmd = new NpgsqlCommand(sql, conn);
        cmd.Parameters.AddWithValue("@search", $"%{search}%");
    }
    else
    {
        cmd = new NpgsqlCommand(sql, conn);
    }
    
    // ... ä»¥ä¸‹çœç•¥
}
```

**è¿½åŠ ã®å¯¾ç­–**:

1. **ORMã®ä½¿ç”¨ï¼ˆEntity Framework Coreï¼‰**:
   
   ```csharp
   // Entity Framework Core ã§ã®å®‰å…¨ãªå®Ÿè£…
   public async Task<IActionResult> GetAll([FromQuery] string? search)
   {
       var query = _context.Users.AsQueryable();
       
       if (!string.IsNullOrEmpty(search))
       {
           query = query.Where(u => 
               EF.Functions.Like(u.Username, $"%{search}%") ||
               EF.Functions.Like(u.Email, $"%{search}%")
           );
       }
       
       var users = await query
           .Select(u => new UserResponse // DTOã®ä½¿ç”¨
           {
               Id = u.Id,
               Username = u.Username,
               Email = u.Email,
               Role = u.Role,
               ProfileImageUrl = u.ProfileImageUrl,
               CreatedAt = u.CreatedAt,
               UpdatedAt = u.UpdatedAt
               // âš ï¸ Passwordã¯é™¤å¤–
           })
           .ToListAsync();
       
       return Ok(users);
   }
   ```

2. **å…¥åŠ›æ¤œè¨¼ã®å¼·åŒ–**:
   
   ```csharp
   // æ¤œç´¢æ–‡å­—åˆ—ã®æ¤œè¨¼
   if (!string.IsNullOrEmpty(search))
   {
       // é•·ã•åˆ¶é™
       if (search.Length > 100)
       {
           return BadRequest(new { error = "Search query too long" });
       }
       
       // è¨±å¯æ–‡å­—ã®ã¿
       if (!Regex.IsMatch(search, @"^[a-zA-Z0-9@._\-\s]+$"))
       {
           return BadRequest(new { error = "Invalid characters in search query" });
       }
   }
   ```

---

#### VULN-004: èªè¨¼ã®å®Œå…¨æ¬ å¦‚

- **æ¤œè¨¼ID**: V-08
- **CWE**: CWE-287: Improper Authentication
- **OWASP Top 10**: A07:2021 - Identification and Authentication Failures
- **CVSS v3.1**: **9.1 (Critical)**
- **CVSS ãƒ™ã‚¯ãƒˆãƒ«**: `CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:N`
- **æ¤œå‡ºãƒ„ãƒ¼ãƒ«**: curl
- **å ´æ‰€**: å…¨APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆï¼ˆ8ç®‡æ‰€ï¼‰

**èª¬æ˜**:

å…¨8ã¤ã®APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã«èªè¨¼æ©Ÿæ§‹ãŒå®Ÿè£…ã•ã‚Œã¦ãŠã‚‰ãšã€Authorizationãƒ˜ãƒƒãƒ€ãƒ¼ãªã—ã§å…¨æ“ä½œï¼ˆCRUDï¼‰ãŒå®Ÿè¡Œå¯èƒ½ã§ã™ã€‚æ”»æ’ƒè€…ã¯åŒ¿åã§ç®¡ç†è€…ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®ä½œæˆã€å…¨ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã®å–å¾—ã€ãƒ‡ãƒ¼ã‚¿ã®æ”¹ã–ã‚“ãƒ»å‰Šé™¤ãŒè‡ªç”±ã«è¡Œãˆã¾ã™ã€‚

**è¨¼è·¡**:

```bash
# èªè¨¼ãªã—ã§ãƒ¦ãƒ¼ã‚¶ãƒ¼ä¸€è¦§å–å¾—
curl -s http://api:5000/api/users | jq .
# â†’ å…¨ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ï¼ˆå¹³æ–‡ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å«ã‚€ï¼‰ãŒè¿”å´

# èªè¨¼ãªã—ã§ç®¡ç†è€…ã‚¢ã‚«ã‚¦ãƒ³ãƒˆä½œæˆ
curl -s -X POST http://api:5000/api/users \
  -H "Content-Type: application/json" \
  -d '{"username":"noauth_admin","email":"noauth@evil.com","password":"hacked123","role":"admin"}'
# â†’ HTTP 200 OK, ç®¡ç†è€…ã‚¢ã‚«ã‚¦ãƒ³ãƒˆä½œæˆæˆåŠŸ
```

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹**:

```json
{
  "id": 6,
  "username": "noauth_admin",
  "email": "noauth@evil.com",
  "password": "hacked123",
  "role": "admin",
  "profileImageUrl": "",
  "createdAt": "2026-02-08T09:31:28Z",
  "updatedAt": "2026-02-08T09:31:28Z"
}
```

**å½±éŸ¿**:

- **å…¨APIã¸ã®ç„¡åˆ¶é™ã‚¢ã‚¯ã‚»ã‚¹**: èªè¨¼ãªã—ã§å…¨æ©Ÿèƒ½ã«ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½
- **ç®¡ç†è€…ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®ä½œæˆ**: æ”»æ’ƒè€…ãŒè‡ªç”±ã«ç®¡ç†è€…æ¨©é™ã‚’å–å¾—å¯èƒ½
- **ãƒ‡ãƒ¼ã‚¿ã®å®Œå…¨åˆ¶å¾¡**: å…¨ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã®å–å¾—ãƒ»æ”¹ã–ã‚“ãƒ»å‰Šé™¤ãŒå¯èƒ½
- **ç›£æŸ»ãƒ­ã‚°ã®æ¬ å¦‚**: èª°ãŒã„ã¤ã‚¢ã‚¯ã‚»ã‚¹ã—ãŸã‹è¿½è·¡ä¸å¯èƒ½

**æ˜¯æ­£ææ¡ˆ**:

**å„ªå…ˆåº¦**: ğŸ”´ **P0 - å³åº§ã«å¯¾å¿œï¼ˆ24æ™‚é–“ä»¥å†…ï¼‰**

**ä¿®æ­£å¾Œï¼ˆå®‰å…¨ãªã‚³ãƒ¼ãƒ‰ï¼‰**:

```csharp
// Program.cs - JWTèªè¨¼ã®è¨­å®š
using Microsoft.AspNetCore.Authentication.JwtBearer;
using Microsoft.IdentityModel.Tokens;
using System.Text;

var builder = WebApplication.CreateBuilder(args);

// JWTèªè¨¼ã®è¿½åŠ 
builder.Services.AddAuthentication(JwtBearerDefaults.AuthenticationScheme)
    .AddJwtBearer(options =>
    {
        options.TokenValidationParameters = new TokenValidationParameters
        {
            ValidateIssuer = true,
            ValidateAudience = true,
            ValidateLifetime = true,
            ValidateIssuerSigningKey = true,
            ValidIssuer = builder.Configuration["Jwt:Issuer"],
            ValidAudience = builder.Configuration["Jwt:Audience"],
            IssuerSigningKey = new SymmetricSecurityKey(
                Encoding.UTF8.GetBytes(builder.Configuration["Jwt:Key"]))
        };
    });

builder.Services.AddAuthorization(options =>
{
    options.AddPolicy("AdminOnly", policy => policy.RequireRole("admin"));
    options.AddPolicy("AuthenticatedUser", policy => policy.RequireAuthenticatedUser());
});

// ... 

var app = builder.Build();

app.UseAuthentication();  // âœ… èªè¨¼ã®æœ‰åŠ¹åŒ–
app.UseAuthorization();   // âœ… èªå¯ã®æœ‰åŠ¹åŒ–

app.MapControllers();
app.Run();
```

```csharp
// UsersController.cs - èªè¨¼ãƒ»èªå¯ã®é©ç”¨
using Microsoft.AspNetCore.Authorization;

[ApiController]
[Route("api/[controller]")]
[Authorize]  // âœ… å…¨ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã«èªè¨¼ã‚’è¦æ±‚
public class UsersController : ControllerBase
{
    [HttpGet]
    [Authorize(Policy = "AuthenticatedUser")]  // èªè¨¼æ¸ˆã¿ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ã¿
    public async Task<IActionResult> GetAll([FromQuery] string? search)
    {
        // ...
    }
    
    [HttpGet("{id}")]
    [Authorize(Policy = "AuthenticatedUser")]
    public async Task<IActionResult> GetById(int id)
    {
        // ...
    }
    
    [HttpPost]
    [Authorize(Policy = "AdminOnly")]  // ç®¡ç†è€…ã®ã¿ä½œæˆå¯èƒ½
    public async Task<IActionResult> Create([FromBody] User user)
    {
        // âš ï¸ roleãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®ä¸Šæ›¸ãã‚’é˜²æ­¢
        user.Role = "user";  // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯userãƒ­ãƒ¼ãƒ«
        // ...
    }
    
    [HttpPut("{id}")]
    [Authorize(Policy = "AuthenticatedUser")]
    public async Task<IActionResult> Update(int id, [FromBody] User user)
    {
        // è‡ªåˆ†è‡ªèº«ã¾ãŸã¯ç®¡ç†è€…ã®ã¿æ›´æ–°å¯èƒ½
        var userId = int.Parse(User.FindFirst(ClaimTypes.NameIdentifier)?.Value);
        var isAdmin = User.IsInRole("admin");
        
        if (userId != id && !isAdmin)
        {
            return Forbid();
        }
        
        // roleã®å¤‰æ›´ã¯ç®¡ç†è€…ã®ã¿è¨±å¯
        if (!isAdmin && user.Role != null)
        {
            return BadRequest(new { error = "Cannot change role" });
        }
        
        // ...
    }
    
    [HttpDelete("{id}")]
    [Authorize(Policy = "AdminOnly")]  // å‰Šé™¤ã¯ç®¡ç†è€…ã®ã¿
    public async Task<IActionResult> Delete(int id)
    {
        // ...
    }
}
```

```csharp
// AuthController.cs - JWTãƒˆãƒ¼ã‚¯ãƒ³ç™ºè¡Œ
using System.IdentityModel.Tokens.Jwt;
using System.Security.Claims;

[ApiController]
[Route("api/[controller]")]
public class AuthController : ControllerBase
{
    private readonly IConfiguration _configuration;
    
    [HttpPost("login")]
    [AllowAnonymous]  // ãƒ­ã‚°ã‚¤ãƒ³ã®ã¿åŒ¿åã‚¢ã‚¯ã‚»ã‚¹è¨±å¯
    public async Task<IActionResult> Login([FromBody] LoginRequest request)
    {
        // ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰æ¤œè¨¼ï¼ˆBCryptã‚’ä½¿ç”¨ï¼‰
        var user = await GetUserByUsername(request.Username);
        if (user == null || !BCrypt.Verify(request.Password, user.PasswordHash))
        {
            return Unauthorized(new { message = "Invalid credentials" });
        }
        
        // JWTãƒˆãƒ¼ã‚¯ãƒ³ç”Ÿæˆ
        var tokenHandler = new JwtSecurityTokenHandler();
        var key = Encoding.UTF8.GetBytes(_configuration["Jwt:Key"]);
        var tokenDescriptor = new SecurityTokenDescriptor
        {
            Subject = new ClaimsIdentity(new[]
            {
                new Claim(ClaimTypes.NameIdentifier, user.Id.ToString()),
                new Claim(ClaimTypes.Name, user.Username),
                new Claim(ClaimTypes.Email, user.Email),
                new Claim(ClaimTypes.Role, user.Role)
            }),
            Expires = DateTime.UtcNow.AddHours(8),
            Issuer = _configuration["Jwt:Issuer"],
            Audience = _configuration["Jwt:Audience"],
            SigningCredentials = new SigningCredentials(
                new SymmetricSecurityKey(key),
                SecurityAlgorithms.HmacSha256Signature)
        };
        
        var token = tokenHandler.CreateToken(tokenDescriptor);
        var tokenString = tokenHandler.WriteToken(token);
        
        return Ok(new
        {
            token = tokenString,
            expiresAt = tokenDescriptor.Expires,
            user = new
            {
                id = user.Id,
                username = user.Username,
                email = user.Email,
                role = user.Role
                // âš ï¸ ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã¯å«ã‚ãªã„
            }
        });
    }
}
```

```json
// appsettings.json
{
  "Jwt": {
    "Key": "${JWT_SECRET_KEY}",
    "Issuer": "vulnerability-site-api",
    "Audience": "vulnerability-site-frontend"
  }
}
```

**è¿½åŠ ã®å¯¾ç­–**:

1. **ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ãƒˆãƒ¼ã‚¯ãƒ³ã®å®Ÿè£…**
2. **ãƒˆãƒ¼ã‚¯ãƒ³å¤±åŠ¹ãƒ¡ã‚«ãƒ‹ã‚ºãƒ ï¼ˆãƒ–ãƒ©ãƒƒã‚¯ãƒªã‚¹ãƒˆï¼‰**
3. **å¤šè¦ç´ èªè¨¼ï¼ˆMFAï¼‰ã®å°å…¥**
4. **ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†ã®å¼·åŒ–**

---

#### VULN-005: SQLã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³ï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼ä½œæˆï¼‰

- **æ¤œè¨¼ID**: V-04
- **CWE**: CWE-89: SQL Injection
- **OWASP Top 10**: A03:2021 - Injection
- **CVSS v3.1**: **9.8 (Critical)**
- **CVSS ãƒ™ã‚¯ãƒˆãƒ«**: `CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H`
- **æ¤œå‡ºãƒ„ãƒ¼ãƒ«**: curl
- **å ´æ‰€**: `src/api/VulnApi/Controllers/UsersController.cs:104`
- **ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ**: `POST /api/users`

**èª¬æ˜**:

ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½œæˆAPIãŒæ–‡å­—åˆ—é€£çµã«ã‚ˆã‚‹INSERTæ–‡ã‚’æ§‹ç¯‰ã—ã¦ãŠã‚Šã€usernameãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã«SQLã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³ãƒšã‚¤ãƒ­ãƒ¼ãƒ‰ã‚’æ³¨å…¥ã™ã‚‹ã“ã¨ã§ã€è¤‡æ•°ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®åŒæ™‚ä½œæˆã‚„ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ§‹é€ ã®éœ²å‡ºãŒå¯èƒ½ã§ã™ã€‚

**è„†å¼±ãªã‚³ãƒ¼ãƒ‰**:

```csharp
// src/api/VulnApi/Controllers/UsersController.cs:104
[HttpPost]
public async Task<IActionResult> Create([FromBody] User user)
{
    using var conn = _dbFactory.CreateConnection();
    await conn.OpenAsync();
    
    // âš ï¸ è„†å¼±: æ–‡å­—åˆ—é€£çµã«ã‚ˆã‚‹SQLæ§‹ç¯‰
    var sql = $"INSERT INTO users (username, email, password, role, profile_image_url) VALUES ('{user.Username}', '{user.Email}', '{user.Password}', '{user.Role}', '{user.ProfileImageUrl}') RETURNING id, username, email, password, role, profile_image_url, created_at, updated_at";
    
    using var cmd = new NpgsqlCommand(sql, conn);
    // ... ä»¥ä¸‹çœç•¥
}
```

**æ”»æ’ƒãƒšã‚¤ãƒ­ãƒ¼ãƒ‰**:

```bash
curl -s -X POST http://api:5000/api/users \
  -H "Content-Type: application/json" \
  -d '{"username":"test'\''),('"'"'hacked'"'"','"'"'evil@evil.com'"'"','"'"'hacked123'"'"','"'"'admin'"'"','"'"''"'"'); --","email":"test@test.com","password":"test123","role":"user"}'
```

**è¨¼è·¡**:

```json
{
  "error": "42601: INSERT has more target columns than expressions\n\nPOSITION: 30",
  "stackTrace": "at Npgsql.Internal.NpgsqlConnector.ReadMessageLong(...)\n   at VulnApi.Controllers.UsersController.Create(User user) in /src/VulnApi/Controllers/UsersController.cs:line 109\n..."
}
```

**å½±éŸ¿**:

- **SQLã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³ã®å®Ÿè¡Œç¢ºèª**: SQLã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã€æ³¨å…¥ã•ã‚ŒãŸSQLãŒå®Ÿè¡Œã•ã‚Œã¦ã„ã‚‹
- **è©³ç´°ã‚¨ãƒ©ãƒ¼æƒ…å ±ã®éœ²å‡º**: ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹ã€è¡Œç•ªå·ã€ã‚¹ã‚¿ãƒƒã‚¯ãƒˆãƒ¬ãƒ¼ã‚¹ãŒéœ²å‡º
- **è¤‡æ•°ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ä½œæˆ**: é©åˆ‡ãªãƒšã‚¤ãƒ­ãƒ¼ãƒ‰ã§è¤‡æ•°ã®ç®¡ç†è€…ã‚¢ã‚«ã‚¦ãƒ³ãƒˆä½œæˆãŒå¯èƒ½
- **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ§‹é€ ã®æ¨æ¸¬**: ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‹ã‚‰å†…éƒ¨æ§‹é€ ã‚’æ¨æ¸¬å¯èƒ½

**æ˜¯æ­£ææ¡ˆ**:

**å„ªå…ˆåº¦**: ğŸ”´ **P0 - å³åº§ã«å¯¾å¿œï¼ˆ24æ™‚é–“ä»¥å†…ï¼‰**

**ä¿®æ­£å¾Œï¼ˆå®‰å…¨ãªã‚³ãƒ¼ãƒ‰ï¼‰**:

```csharp
[HttpPost]
[Authorize(Policy = "AdminOnly")]
public async Task<IActionResult> Create([FromBody] UserCreateRequest request)
{
    // å…¥åŠ›æ¤œè¨¼
    if (!ModelState.IsValid)
    {
        return BadRequest(ModelState);
    }
    
    using var conn = _dbFactory.CreateConnection();
    await conn.OpenAsync();
    
    // ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã®ãƒãƒƒã‚·ãƒ¥åŒ–
    var passwordHash = BCrypt.HashPassword(request.Password);
    
    // ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿åŒ–ã‚¯ã‚¨ãƒªã®ä½¿ç”¨
    var sql = "INSERT INTO users (username, email, password, role, profile_image_url) VALUES (@username, @email, @password, @role, @profileImageUrl) RETURNING id, username, email, role, profile_image_url, created_at, updated_at";
    // âš ï¸ passwordã‚«ãƒ©ãƒ ã¯RETURNINGã‹ã‚‰é™¤å¤–
    
    using var cmd = new NpgsqlCommand(sql, conn);
    cmd.Parameters.AddWithValue("@username", request.Username);
    cmd.Parameters.AddWithValue("@email", request.Email);
    cmd.Parameters.AddWithValue("@password", passwordHash);
    cmd.Parameters.AddWithValue("@role", "user");  // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯userãƒ­ãƒ¼ãƒ«ï¼ˆroleãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’ç„¡è¦–ï¼‰
    cmd.Parameters.AddWithValue("@profileImageUrl", request.ProfileImageUrl ?? "");
    
    try
    {
        using var reader = await cmd.ExecuteReaderAsync();
        if (await reader.ReadAsync())
        {
            var userResponse = new UserResponse
            {
                Id = reader.GetInt32(0),
                Username = reader.GetString(1),
                Email = reader.GetString(2),
                Role = reader.GetString(3),
                ProfileImageUrl = reader.GetString(4),
                CreatedAt = reader.GetDateTime(5),
                UpdatedAt = reader.GetDateTime(6)
            };
            return CreatedAtAction(nameof(GetById), new { id = userResponse.Id }, userResponse);
        }
        return StatusCode(500, new { error = "Failed to create user" });
    }
    catch (Exception ex)
    {
        // ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°ã¯å†…éƒ¨ã®ã¿ï¼ˆè©³ç´°ã¯å…¬é–‹ã—ãªã„ï¼‰
        _logger.LogError(ex, "Error creating user");
        return StatusCode(500, new { error = "An error occurred while creating user" });
    }
}
```

---

#### VULN-006: SQLã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³ï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼æ›´æ–°ï¼‰

- **æ¤œè¨¼ID**: V-05
- **CWE**: CWE-89: SQL Injection
- **OWASP Top 10**: A03:2021 - Injection
- **CVSS v3.1**: **9.8 (Critical)**
- **CVSS ãƒ™ã‚¯ãƒˆãƒ«**: `CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H`
- **æ¤œå‡ºãƒ„ãƒ¼ãƒ«**: curl
- **å ´æ‰€**: `src/api/VulnApi/Controllers/UsersController.cs:139`
- **ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ**: `PUT /api/users/{id}`

**èª¬æ˜**:

ãƒ¦ãƒ¼ã‚¶ãƒ¼æ›´æ–°APIãŒæ–‡å­—åˆ—é€£çµã«ã‚ˆã‚‹UPDATEæ–‡ã‚’æ§‹ç¯‰ã—ã¦ãŠã‚Šã€SQLã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³ã«ã‚ˆã‚Šå…¨ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®æƒ…å ±ã‚’ä¸€æ‹¬æ›´æ–°ã™ã‚‹ã“ã¨ãŒå¯èƒ½ã§ã™ã€‚

**æ˜¯æ­£ææ¡ˆ**: V-05ã¨åŒæ§˜ã«ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿åŒ–ã‚¯ã‚¨ãƒªã‚’ä½¿ç”¨ï¼ˆè©³ç´°ã¯çœç•¥ï¼‰

---

#### VULN-007: å®‰å…¨ã§ãªã„ãƒ‡ã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚º

- **æ¤œè¨¼ID**: V-14
- **CWE**: CWE-502: Deserialization of Untrusted Data
- **OWASP Top 10**: A08:2021 - Software and Data Integrity Failures
- **CVSS v3.1**: **9.8 (Critical)**
- **CVSS ãƒ™ã‚¯ãƒˆãƒ«**: `CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H`
- **æ¤œå‡ºãƒ„ãƒ¼ãƒ«**: curl
- **å ´æ‰€**: `src/api/VulnApi/Controllers/FileController.cs:61`
- **ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ**: `POST /api/import`

**èª¬æ˜**:

JSONãƒ‡ã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚ºå‡¦ç†ã§`TypeNameHandling.All`ãŒè¨­å®šã•ã‚Œã¦ãŠã‚Šã€æ”»æ’ƒè€…ãŒä»»æ„ã®.NETå‹ã‚’ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹åŒ–ã§ãã¾ã™ã€‚é©åˆ‡ãªã‚¬ã‚¸ã‚§ãƒƒãƒˆãƒã‚§ãƒ¼ãƒ³ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã§ã€ãƒªãƒ¢ãƒ¼ãƒˆã‚³ãƒ¼ãƒ‰å®Ÿè¡Œï¼ˆRCEï¼‰ãŒå¯èƒ½ã«ãªã‚Šã¾ã™ã€‚

**è„†å¼±ãªã‚³ãƒ¼ãƒ‰**:

```csharp
// src/api/VulnApi/Controllers/FileController.cs:61
[HttpPost("import")]
public IActionResult Import([FromBody] object data)
{
    try
    {
        var json = JsonConvert.SerializeObject(data);
        
        // âš ï¸ è„†å¼±: TypeNameHandling.All ã«ã‚ˆã‚Šä»»æ„ã®å‹ã®ãƒ‡ã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚ºãŒå¯èƒ½
        var settings = new JsonSerializerSettings
        {
            TypeNameHandling = TypeNameHandling.All
        };
        
        var result = JsonConvert.DeserializeObject(json, settings);
        return Ok(new { message = "Import successful", data = result });
    }
    catch (Exception ex)
    {
        // âš ï¸ è©³ç´°ã‚¨ãƒ©ãƒ¼æƒ…å ±ã®éœ²å‡º
        return StatusCode(500, new { error = ex.Message, stackTrace = ex.StackTrace });
    }
}
```

**æ”»æ’ƒãƒšã‚¤ãƒ­ãƒ¼ãƒ‰**:

```bash
curl -s -X POST http://api:5000/api/import \
  -H "Content-Type: application/json" \
  -d '{"$type":"System.Windows.Data.ObjectDataProvider, PresentationFramework","ObjectInstance":{"$type":"System.Diagnostics.Process, System"},"MethodName":"Start"}'
```

**è¨¼è·¡**:

```json
{
  "error": "Error resolving type specified in JSON 'System.Windows.Data.ObjectDataProvider, PresentationFramework'. Path '$type', line 1, position 72.",
  "stackTrace": "at Newtonsoft.Json.Serialization.JsonSerializerInternalReader.ResolveTypeName(...)\n   at VulnApi.Controllers.FileController.Import(Object data) in /src/VulnApi/Controllers/FileController.cs:line 61\n..."
}
```

**å½±éŸ¿**:

- **ãƒªãƒ¢ãƒ¼ãƒˆã‚³ãƒ¼ãƒ‰å®Ÿè¡Œï¼ˆRCEï¼‰**: æ”»æ’ƒè€…ãŒä»»æ„ã®ã‚³ãƒ¼ãƒ‰ã‚’ã‚µãƒ¼ãƒãƒ¼ä¸Šã§å®Ÿè¡Œå¯èƒ½
- **ã‚·ã‚¹ãƒ†ãƒ ã®å®Œå…¨åˆ¶å¾¡**: RCEã«ã‚ˆã‚Šã‚µãƒ¼ãƒãƒ¼ã®å…¨æ¨©é™ã‚’å–å¾—å¯èƒ½
- **ãƒ‡ãƒ¼ã‚¿çªƒå–**: ãƒ•ã‚¡ã‚¤ãƒ«ã‚·ã‚¹ãƒ†ãƒ å…¨ä½“ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ãŒå¯èƒ½
- **ãƒãƒ«ã‚¦ã‚§ã‚¢æ„ŸæŸ“**: ãƒãƒƒã‚¯ãƒ‰ã‚¢ã€ãƒ©ãƒ³ã‚µãƒ ã‚¦ã‚§ã‚¢ã®è¨­ç½®ãŒå¯èƒ½

**æ˜¯æ­£ææ¡ˆ**:

**å„ªå…ˆåº¦**: ğŸ”´ **P0 - å³åº§ã«å¯¾å¿œï¼ˆ24æ™‚é–“ä»¥å†…ï¼‰**

**ä¿®æ­£å¾Œï¼ˆå®‰å…¨ãªã‚³ãƒ¼ãƒ‰ï¼‰**:

```csharp
[HttpPost("import")]
[Authorize(Policy = "AdminOnly")]
public IActionResult Import([FromBody] ImportRequest request)
{
    try
    {
        // âš ï¸ TypeNameHandling.None ã‚’ä½¿ç”¨ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼‰
        var settings = new JsonSerializerSettings
        {
            TypeNameHandling = TypeNameHandling.None,  // âœ… å®‰å…¨ãªè¨­å®š
            MaxDepth = 32,  // DoSå¯¾ç­–
        };
        
        // è¨±å¯ã•ã‚ŒãŸå‹ã®ã¿ãƒ‡ã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚º
        var data = JsonConvert.DeserializeObject<ImportData>(request.JsonData, settings);
        
        if (data == null)
        {
            return BadRequest(new { error = "Invalid data format" });
        }
        
        // ãƒ‡ãƒ¼ã‚¿ã®æ¤œè¨¼ã¨å‡¦ç†
        // ...
        
        return Ok(new { message = "Import successful" });
    }
    catch (JsonException ex)
    {
        _logger.LogWarning(ex, "Invalid JSON in import request");
        return BadRequest(new { error = "Invalid JSON format" });
    }
    catch (Exception ex)
    {
        _logger.LogError(ex, "Error during import");
        return StatusCode(500, new { error = "An error occurred during import" });
    }
}

// è¨±å¯ã•ã‚ŒãŸå‹ã®å®šç¾©
public class ImportRequest
{
    [Required]
    public string JsonData { get; set; }
}

public class ImportData
{
    public List<UserImportData> Users { get; set; }
}

public class UserImportData
{
    [Required]
    [StringLength(100)]
    public string Username { get; set; }
    
    [Required]
    [EmailAddress]
    public string Email { get; set; }
}
```

**è¿½åŠ ã®å¯¾ç­–**:

1. **System.Text.Jsonã®ä½¿ç”¨**ï¼ˆNewtonsoft.Jsonã®ä»£æ›¿ï¼‰:
   
   ```csharp
   using System.Text.Json;
   
   var options = new JsonSerializerOptions
   {
       MaxDepth = 32,
       PropertyNameCaseInsensitive = true
   };
   
   var data = JsonSerializer.Deserialize<ImportData>(request.JsonData, options);
   ```

2. **ã‚«ã‚¹ã‚¿ãƒ ãƒã‚¤ãƒ³ãƒ€ãƒ¼ã®å®Ÿè£…**:
   
   ```csharp
   public class SafeSerializationBinder : ISerializationBinder
   {
       private static readonly HashSet<string> AllowedTypes = new()
       {
           typeof(ImportData).FullName,
           typeof(UserImportData).FullName
       };
       
       public Type BindToType(string assemblyName, string typeName)
       {
           if (!AllowedTypes.Contains(typeName))
           {
               throw new JsonSerializationException($"Type '{typeName}' is not allowed");
           }
           return Type.GetType($"{typeName}, {assemblyName}");
       }
       
       public void BindToName(Type serializedType, out string assemblyName, out string typeName)
       {
           assemblyName = serializedType.Assembly.FullName;
           typeName = serializedType.FullName;
       }
   }
   ```

---

### 1.2 High ãƒ¬ãƒ™ãƒ«ï¼ˆ4ä»¶ï¼‰

---

#### VULN-008: ãƒ¬ãƒ¼ãƒˆåˆ¶é™ã®æ¬ å¦‚

- **æ¤œè¨¼ID**: V-09
- **CWE**: CWE-307: Improper Restriction of Excessive Authentication Attempts
- **OWASP Top 10**: A07:2021 - Identification and Authentication Failures
- **CVSS v3.1**: **7.5 (High)**
- **CVSS ãƒ™ã‚¯ãƒˆãƒ«**: `CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:N/A:H`
- **æ¤œå‡ºãƒ„ãƒ¼ãƒ«**: curl, bash
- **å ´æ‰€**: `/api/login`ï¼ˆå…¨ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆï¼‰

**èª¬æ˜**:

ãƒ­ã‚°ã‚¤ãƒ³ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚’å«ã‚€å…¨APIã«