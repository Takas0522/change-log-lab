# ZAP アクティブスキャン用シナリオ — 作成完了サマリー

> **作成日時**: 2026-02-23  
> **対象アプリケーション**: vulnerability-site  
> **作成エージェント**: ZAP アクティブスキャン — シナリオ構築エージェント

---

## 📁 作成されたドキュメント

### 1. 概要ドキュメント

| ファイル名 | 説明 | パス |
|-----------|------|------|
| **playwright-scenario-overview.md** | 全シナリオの概要、アプリケーション構造、脆弱性マッピング | `/docker-work-dir/docs/` |

### 2. 詳細シナリオドキュメント（個別）

| ファイル名 | シナリオID | タイトル | 主要な脆弱性 | パス |
|-----------|-----------|---------|------------|------|
| **playwright-scenario-S01.md** | S-01 | 初期アクセス & ナビゲーション | A-03, A-05, F-02 | `/docker-work-dir/docs/` |
| **playwright-scenario-S02.md** | S-02 | ユーザー一覧 & 検索 | A-01 (SQLi), A-04 | `/docker-work-dir/docs/` |
| **playwright-scenario-S03.md** | S-03 | ユーザー作成（正常系） | A-01, A-03, F-04, F-05 | `/docker-work-dir/docs/` |
| **playwright-scenario-S04.md** | S-04 | ユーザー作成（権限昇格） | A-06 (Mass Assignment) | `/docker-work-dir/docs/` |
| **playwright-scenario-S05.md** | S-05 | ユーザー作成（XSS） | F-01 (Stored XSS) | `/docker-work-dir/docs/` |
| **playwright-scenario-S09.md** | S-09 | ログイン（正常系） | A-08 (Header Injection), A-03 | `/docker-work-dir/docs/` |
| **playwright-scenario-S10.md** | S-10 | ログイン（異常系） | A-01 (SQLi), A-09 (Rate Limiting) | `/docker-work-dir/docs/` |
| **playwright-scenario-S12.md** | S-12 | ファイル取得API | A-07 (Path Traversal) | `/docker-work-dir/docs/` |
| **playwright-scenario-S13.md** | S-13 | インポートAPI | A-10 (Unsafe Deserialization) | `/docker-work-dir/docs/` |
| **playwright-scenario-remaining.md** | S-06〜S-14 | 残りのシナリオ簡易仕様 | A-02, F-03, その他 | `/docker-work-dir/docs/` |

### 3. 実装ガイド

| ファイル名 | 説明 | パス |
|-----------|------|------|
| **playwright-implementation-guide.md** | Playwright実装手順、ZAP連携、CI/CD統合 | `/docker-work-dir/docs/` |

---

## 📊 シナリオカバレッジ

### 画面カバレッジ（5画面中5画面）

- ✅ `/` — ユーザー一覧
- ✅ `/login` — ログイン
- ✅ `/users/new` — ユーザー追加
- ✅ `/users/:id` — ユーザー詳細
- ✅ `/users/:id/edit` — ユーザー編集

### APIエンドポイントカバレッジ（8エンドポイント中8エンドポイント）

| エンドポイント | メソッド | カバーシナリオ | 脆弱性 |
|--------------|---------|--------------|--------|
| `/api/users` | GET | S-01, S-02 | A-01 (SQLi), A-04 |
| `/api/users/{id}` | GET | S-06, S-07, S-11 | A-01, A-04 |
| `/api/users` | POST | S-03, S-04, S-05 | A-01, A-03, A-06 |
| `/api/users/{id}` | PUT | S-07 | A-01, A-06 |
| `/api/users/{id}` | DELETE | S-08 | A-02 |
| `/api/login` | POST | S-09, S-10 | A-01, A-03, A-08, A-09 |
| `/api/files/{path}` | GET | S-12 | A-07 |
| `/api/import` | POST | S-13 | A-10 |

**カバレッジ**: 100%

### 脆弱性カバレッジ（22件中22件）

#### Frontend脆弱性（5件）

- ✅ **F-01**: XSS (dangerouslySetInnerHTML) — S-05, S-06
- ✅ **F-02**: 機密情報のクライアント露出 — 全シナリオ
- ✅ **F-03**: オープンリダイレクト — S-14
- ✅ **F-04**: CSRF対策の欠如 — 全POST/PUT/DELETE
- ✅ **F-05**: コンソールログへの機密情報出力 — S-03〜S-10

#### API脆弱性（10件）

- ✅ **A-01**: SQLインジェクション — S-02, S-10（他多数）
- ✅ **A-02**: 認証バイパス — S-08
- ✅ **A-03**: パスワード平文保存 — S-03, S-09
- ✅ **A-04**: 詳細エラー情報の露出 — S-11
- ✅ **A-05**: CORS設定の不備 — 全シナリオ
- ✅ **A-06**: Mass Assignment — S-04
- ✅ **A-07**: ディレクトリトラバーサル — S-12
- ✅ **A-08**: HTTPヘッダインジェクション — S-09
- ✅ **A-09**: レート制限の欠如 — S-10
- ✅ **A-10**: 安全でないデシリアライズ — S-13

#### Database脆弱性（4件）

- ✅ **D-01**: 弱いDBパスワード — 前工程レポートで確認済み
- ✅ **D-02**: 過剰な権限 — 前工程レポートで確認済み
- ✅ **D-03**: 暗号化なし通信 — 前工程レポートで確認済み
- ✅ **D-04**: パスワード平文カラム — A-03と同一

#### Infrastructure脆弱性（3件）

- ✅ **I-01**: root実行 — 前工程レポートで確認済み
- ✅ **I-02**: ハードコードされた秘匿情報 — 前工程レポートで確認済み
- ✅ **I-03**: 不要ポートの公開 — 前工程レポートで確認済み

**カバレッジ**: 100%（全脆弱性がトリガー可能）

---

## 🎯 シナリオ実行計画

### Phase 1: 基本操作（約15分）

- S-01: 初期アクセス & ナビゲーション
- S-02: ユーザー一覧 & 検索
- S-03: ユーザー作成（正常系）

**目的**: 正常系の通信パターンをZAPに収集

### Phase 2: 脆弱性トリガー（約10分）

- S-04: ユーザー作成（権限昇格）
- S-05: ユーザー作成（XSS）

**目的**: 異常系の入力パターンをZAPに収集

### Phase 3: 詳細操作（約15分）

- S-06: ユーザー詳細表示
- S-07: ユーザー編集
- S-08: ユーザー削除

**目的**: CRUD操作の完全網羅

### Phase 4: 認証フロー（約10分）

- S-09: ログイン（正常系）
- S-10: ログイン（異常系）

**目的**: 認証エンドポイントの網羅的テスト

### Phase 5: エッジケース（約20分）

- S-11: エラーケース & 境界値
- S-12: ファイル取得API
- S-13: インポートAPI
- S-14: オープンリダイレクト

**目的**: 特殊なAPIとエラーハンドリングのテスト

**総実行時間**: 約70分（ZAPアクティブスキャンは別途2〜4時間）

---

## 📈 期待される成果

### ZAPスキャン後に検出される脆弱性（予測）

| 深刻度 | 検出予測数 | 主な脆弱性 |
|--------|----------|-----------|
| **Critical** | 5〜7件 | SQLインジェクション、認証バイパス、RCE、パスワード平文 |
| **High** | 8〜10件 | XSS、ディレクトリトラバーサル、Mass Assignment、CORS |
| **Medium** | 5〜8件 | エラー情報露出、オープンリダイレクト、セキュリティヘッダ欠如 |
| **Low** | 3〜5件 | 情報漏洩、タイムスタンプ露出 |
| **合計** | **21〜30件** | |

### 誤検知の可能性

- **低**: アプリケーションに意図的に脆弱性が仕込まれているため、ほぼすべてが真陽性
- **確認が必要な項目**: XSS（コンテキストによって実行可否が異なる）、CSRF（実際の影響度評価）

---

## 🚀 次のステップ

### 1. Playwrightテストの実装

- [ ] `/workdir/src/e2e/` ディレクトリに Playwright プロジェクトを作成
- [ ] 各シナリオを `.spec.ts` ファイルとして実装
- [ ] ヘルパー関数（ZAP API連携、テストデータ管理）を実装

### 2. ZAPとの連携テスト

- [ ] ZAPをDockerコンテナで起動
- [ ] Playwrightの Proxy設定を確認
- [ ] サンプルシナリオ（S-01）を実行し、ZAPに通信が記録されることを確認

### 3. 全シナリオ実行

- [ ] Phase 1〜5の順に全シナリオを実行
- [ ] ZAPのサイトツリーで全エンドポイントが認識されていることを確認

### 4. ZAPアクティブスキャン実行

- [ ] ZAP API経由でアクティブスキャンを開始
- [ ] スキャン進捗を監視
- [ ] 完了後、HTMLレポートを生成

### 5. 結果分析

- [ ] 検出された脆弱性と意図した脆弱性の照合
- [ ] 誤検知の確認
- [ ] 未検出脆弱性の原因分析
- [ ] レポート作成

---

## 📝 ドキュメント利用方法

### シナリオ実装者向け

1. **playwright-scenario-overview.md** で全体像を把握
2. 各 **playwright-scenario-S{番号}.md** で詳細仕様を確認
3. **playwright-implementation-guide.md** に従って実装

### QA/セキュリティエンジニア向け

1. 各シナリオの「脆弱性の詳細」セクションで攻撃手法を学習
2. 「ZAPで確認すべきポイント」でスキャン結果の評価基準を確認
3. 「正しい実装例」で修正方法を理解

### 開発者向け

1. 各脆弱性の「ソースコード」セクションで問題箇所を特定
2. 「正しい実装例」を参考に修正
3. 「防止策」セクションでベストプラクティスを学習

---

## 🔒 セキュリティ上の注意

### ローカル環境のみで実行

- ❌ 本番環境やステージング環境では絶対に実行しない
- ❌ 外部ネットワークへのスキャンは禁止
- ✅ Dockerローカルネットワーク内のみで実行

### 悪用厳禁

- このシナリオは**教育目的**のみで使用
- 実在するアプリケーションへの攻撃は違法
- 脆弱性診断は必ず許可を得てから実施

---

## 📞 サポート

### 問題が発生した場合

1. **playwright-implementation-guide.md** の「トラブルシューティング」を確認
2. ZAPのログを確認: `docker logs zap`
3. Playwrightのデバッグモードで実行: `npx playwright test --debug`

---

**作成完了日時**: 2026-02-23  
**ドキュメント総数**: 11ファイル  
**シナリオ総数**: 14シナリオ  
**カバレッジ**: 画面5/5、API 8/8、脆弱性22/22  

**全シナリオ構築が完了しました！** 🎉
